<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Allink: src/ElPoly/ElPolyMeasure.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Allink
   &#160;<span id="projectnumber">v0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_8e9a8b7e3c72bcc96dd64e909190dc02.html">src</a>      </li>
      <li class="navelem"><a class="el" href="dir_1bb97581e94de66daf7acda7f0e3ec00.html">ElPoly</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">ElPolyMeasure.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;ElPoly.h&quot;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a><a class="code" href="classElPoly.html#a2f4aa8dc1e4dce0dc8fcb1d4b161757b">00003</a> <span class="keywordtype">int</span> <a class="code" href="classElPoly.html#a2f4aa8dc1e4dce0dc8fcb1d4b161757b" title="Diffusivity coefficient of the chains  diff.">ElPoly::Diffusivity</a>(){
<a name="l00004"></a>00004   <span class="keywordtype">int</span> NDim = 2;
<a name="l00005"></a>00005   <a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a> = <a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1] - <a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];
<a name="l00006"></a>00006   <span class="keywordtype">int</span> NChain = 0;
<a name="l00007"></a>00007   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0;b&lt;<a class="code" href="classVarData.html#a474ffd5306304ac53eb7ef48a18e511d" title="Number of blocks.">pNBlock</a>();b++){
<a name="l00008"></a>00008     <span class="keywordflow">if</span>(!strcmp(<a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[b].Name,<span class="stringliteral">&quot;ADDED&quot;</span>)) <span class="keywordflow">continue</span>;
<a name="l00009"></a>00009     <span class="keywordflow">if</span>(!strcmp(<a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[b].Name,<span class="stringliteral">&quot;CHOL&quot;</span>)) <span class="keywordflow">continue</span>;
<a name="l00010"></a>00010     NChain += <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[b].<a class="code" href="structBLOCK.html#aa49e4d7af0d71e79524ef6fb081707b5" title="# chains">NChain</a>;
<a name="l00011"></a>00011   }
<a name="l00012"></a>00012   <span class="keywordtype">double</span> *FileAverage = (<span class="keywordtype">double</span> *)calloc(NDim*NChain*<a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00013"></a>00013   <span class="keywordtype">double</span> *ChainDiff = (<span class="keywordtype">double</span> *)calloc(NFileTot,<span class="keyword">sizeof</span>(*ChainDiff));
<a name="l00014"></a>00014   <span class="keywordtype">double</span> *ChainOrigin = (<span class="keywordtype">double</span> *)calloc(NFileTot,<span class="keyword">sizeof</span>(*ChainDiff));
<a name="l00015"></a>00015   <span class="keywordtype">double</span> *Count = (<span class="keywordtype">double</span> *)calloc(NFileTot,<span class="keyword">sizeof</span>(*Count));
<a name="l00016"></a>00016   <span class="keywordtype">double</span> *Time = (<span class="keywordtype">double</span> *)calloc(NFileTot,<span class="keyword">sizeof</span>(*Time));
<a name="l00017"></a>00017   <span class="keywordtype">double</span> CmInit[3] = {<a class="code" href="classVarData.html#adfa118e0505b98efdcaf18dbd72cc11e" title="Center of mass of the system.">pCm</a>(0),<a class="code" href="classVarData.html#adfa118e0505b98efdcaf18dbd72cc11e" title="Center of mass of the system.">pCm</a>(1),<a class="code" href="classVarData.html#adfa118e0505b98efdcaf18dbd72cc11e" title="Center of mass of the system.">pCm</a>(2)};
<a name="l00018"></a>00018   <span class="keywordtype">double</span> InitTime = <a class="code" href="classVarData.html#ad5bf6099846e677cae330617688069c8" title="Total time.">pTime</a>();
<a name="l00019"></a>00019   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=NFile[0];f&lt;NFile[1];f++){
<a name="l00020"></a>00020     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00021"></a>00021     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_NO))<span class="keywordflow">return</span> 1;
<a name="l00022"></a>00022     <a class="code" href="classVarData.html#a0826d64fb693577d667b53d50e53abb5" title="Definition of the chain.">BfDefChain</a>();
<a name="l00023"></a>00023     Time[f] = <a class="code" href="classVarData.html#ad5bf6099846e677cae330617688069c8" title="Total time.">pTime</a>() - InitTime;
<a name="l00024"></a>00024     <span class="keywordflow">if</span>(Time[f]&lt;=0.) Time[f] = (double)f;
<a name="l00025"></a>00025     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;NChain;c++){
<a name="l00026"></a>00026       <span class="keywordtype">int</span> ff = f - NFile[0];
<a name="l00027"></a>00027       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;NDim;d++){
<a name="l00028"></a>00028    FileAverage[(c*NFileTot+ff)*NDim+d] = <a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[c].Pos[d];
<a name="l00029"></a>00029       }
<a name="l00030"></a>00030     }
<a name="l00031"></a>00031   }
<a name="l00032"></a>00032   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00033"></a>00033 <span class="preprocessor">#ifdef OMPI_MPI_H</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>  MPI_Allreduce(MPI_IN_PLACE,FileAverage,NDim*NChain*NFileTot, MPI_DOUBLE, MPI_SUM, Proc-&gt;CommGrid);
<a name="l00035"></a>00035   <span class="keywordtype">int</span> Rank=0;
<a name="l00036"></a>00036   MPI_Comm_rank(Proc-&gt;CommGrid, &amp;Rank);
<a name="l00037"></a>00037   <span class="keywordflow">if</span>(Rank==0){
<a name="l00038"></a>00038 <span class="preprocessor">#endif</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=0;f&lt;<a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a>;f++){
<a name="l00040"></a>00040       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;NChain;c++){
<a name="l00041"></a>00041    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;NDim;d++){
<a name="l00042"></a>00042      ChainOrigin[f] += 
<a name="l00043"></a>00043        SQR((FileAverage[(c*NFileTot)*NDim+d]-FileAverage[(c*NFileTot+f)*NDim+d]));<span class="comment">//-(pCm(d)-CmInit[d]) );</span>
<a name="l00044"></a>00044    }
<a name="l00045"></a>00045       }
<a name="l00046"></a>00046     }
<a name="l00047"></a>00047     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=0;f&lt;<a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a>;f++){
<a name="l00048"></a>00048       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ff = f; ff&lt;<a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a>;ff++){
<a name="l00049"></a>00049    <span class="keywordtype">int</span> fff = ff - f;
<a name="l00050"></a>00050    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;NChain;c++){
<a name="l00051"></a>00051      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;NDim;d++){
<a name="l00052"></a>00052        ChainDiff[fff] += 
<a name="l00053"></a>00053          SQR((FileAverage[(c*NFileTot+ff)*NDim+d]-FileAverage[(c*NFileTot+f)*NDim+d]));<span class="comment">//-(pCm(d)-CmInit[d]) );</span>
<a name="l00054"></a>00054      }
<a name="l00055"></a>00055      Count[fff] += 1.;
<a name="l00056"></a>00056    }
<a name="l00057"></a>00057    <span class="comment">//printf(&quot;%d %d %d %lf\n&quot;,f,ff,fff,ChainDiff[fff]);</span>
<a name="l00058"></a>00058       }
<a name="l00059"></a>00059     }
<a name="l00060"></a>00060     <span class="keywordtype">char</span> FileName[60];
<a name="l00061"></a>00061     sprintf(FileName,<span class="stringliteral">&quot;Diffusivity.dat&quot;</span>);
<a name="l00062"></a>00062     FILE *FileToWrite = fopen(FileName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00063"></a>00063     <span class="keywordtype">char</span> cSystem[STRSIZE];
<a name="l00064"></a>00064     <a class="code" href="classVarData.html#aa415b42b89dfba2ab8189be4e86b41ad" title="Print a string with the system definitions.">SysDef</a>(cSystem);
<a name="l00065"></a>00065     fprintf(FileToWrite,<span class="stringliteral">&quot;%s&quot;</span>,cSystem);
<a name="l00066"></a>00066     fprintf(FileToWrite,<span class="stringliteral">&quot;#Time ChainOrigin OriginSum DiffSum ChainDiff Count\n&quot;</span>);
<a name="l00067"></a>00067     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=0;f&lt;<a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a>;f++){
<a name="l00068"></a>00068       <span class="keywordtype">double</span> Inv = Count[f] &gt; 0. ? Count[f] : 1.;
<a name="l00069"></a>00069       fprintf(FileToWrite,<span class="stringliteral">&quot;%lf %.5g %.5g %.5g\n&quot;</span>,Time[f],ChainOrigin[f]/(<span class="keywordtype">double</span>)(NChain),ChainDiff[f]/Inv,ChainDiff[f]/(Inv*Time[f]) );
<a name="l00070"></a>00070     }
<a name="l00071"></a>00071 <span class="preprocessor">#ifdef OMPI_MPI_H</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>  }
<a name="l00073"></a>00073 <span class="preprocessor">#endif</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>  free(FileAverage);
<a name="l00075"></a>00075   free(ChainDiff);
<a name="l00076"></a>00076   free(ChainOrigin);
<a name="l00077"></a>00077   free(Count);
<a name="l00078"></a>00078   free(Time);
<a name="l00079"></a>00079   <span class="keywordflow">return</span> 0;
<a name="l00080"></a>00080 }
<a name="l00081"></a><a class="code" href="classElPoly.html#abf879a7d0b86a5eed8a5be87dc741200">00081</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#abf879a7d0b86a5eed8a5be87dc741200" title="Diffusivity of particles starting from an initial slab.">ElPoly::DiffSlab</a>(<span class="keywordtype">int</span> NSlab){
<a name="l00082"></a>00082   <span class="keywordtype">int</span> NBin = <a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1] - <a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];
<a name="l00083"></a>00083   <span class="keywordtype">double</span> Volume1 = 0.;
<a name="l00084"></a>00084   <span class="keywordtype">double</span> HeightCyl = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);
<a name="l00085"></a>00085   <span class="keywordtype">double</span> LenMin = MIN(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>));
<a name="l00086"></a>00086   <span class="keywordtype">double</span> LenMax = MAX(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>));
<a name="l00087"></a>00087   <span class="keywordtype">double</span> BoxRad = .5*MIN(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>));
<a name="l00088"></a>00088   <span class="keywordtype">double</span> InvBoxRad = 1./BoxRad;
<a name="l00089"></a>00089   <span class="keywordtype">double</span> *OldPos = (<span class="keywordtype">double</span> *)calloc(3*<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>(),<span class="keyword">sizeof</span>(double));
<a name="l00090"></a>00090   <span class="keywordtype">double</span> *Diff = (<span class="keywordtype">double</span> *)calloc(NBin*<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>(),<span class="keyword">sizeof</span>(double));
<a name="l00091"></a>00091   <span class="keywordtype">double</span> *Count = (<span class="keywordtype">double</span> *)calloc(NSlab,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00092"></a>00092   <span class="keywordtype">int</span> *PartOr = (<span class="keywordtype">int</span> *)calloc(<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>(),<span class="keyword">sizeof</span>(int));
<a name="l00093"></a>00093   <span class="keywordtype">double</span> dr[3];
<a name="l00094"></a>00094   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p = 0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00095"></a>00095     <span class="keywordtype">double</span> dr2 = 0.;
<a name="l00096"></a>00096     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00097"></a>00097       OldPos[3*p+d] = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d];
<a name="l00098"></a>00098       dr[d] = <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[d] - <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d];
<a name="l00099"></a>00099       dr[d] -= floor(dr[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d);
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101     dr2 = sqrt(SQR(dr[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]) + SQR(dr[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]));
<a name="l00102"></a>00102     <span class="keywordtype">int</span> vr = (int)(dr2/BoxRad*NSlab);
<a name="l00103"></a>00103     PartOr[p] = vr;
<a name="l00104"></a>00104     <span class="keywordflow">if</span>(vr &lt; 0 || vr &gt;= NSlab) <span class="keywordflow">continue</span>;
<a name="l00105"></a>00105     Count[vr] += 1.;
<a name="l00106"></a>00106   }
<a name="l00107"></a>00107   <span class="keywordtype">char</span> FName[60];
<a name="l00108"></a>00108   <span class="keywordflow">if</span>(1==1){<span class="comment">//particles position and slab circles</span>
<a name="l00109"></a>00109     FILE *FRepr = fopen(<span class="stringliteral">&quot;SystemSlab.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00110"></a>00110     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00111"></a>00111       fprintf(FRepr,<span class="stringliteral">&quot;%lf %lf %lf 0\n&quot;</span>,<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Pos[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>],<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Pos[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>],.5);
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0;v&lt;NSlab;v++){
<a name="l00114"></a>00114       <span class="keywordtype">double</span> Dist = v*BoxRad/(double)NSlab;
<a name="l00115"></a>00115       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;100;i++){
<a name="l00116"></a>00116    <span class="keywordtype">double</span> ang = i*.01*2.*M_PI;
<a name="l00117"></a>00117    <span class="keywordtype">double</span> x = Dist*cos(ang) + <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>];
<a name="l00118"></a>00118    <span class="keywordtype">double</span> y = Dist*sin(ang) + <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>];
<a name="l00119"></a>00119    fprintf(FRepr,<span class="stringliteral">&quot;%lf %lf %lf 2\n&quot;</span>,x,y,.51);
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122     fclose(FRepr);
<a name="l00123"></a>00123     <span class="keywordtype">double</span> Norm = 1./(double)<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();
<a name="l00124"></a>00124     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0;v&lt;NSlab;v++){
<a name="l00125"></a>00125       <span class="keywordtype">double</span> Dist = v*BoxRad/(double)NSlab;
<a name="l00126"></a>00126       sprintf(FName,<span class="stringliteral">&quot;MeanSqDispl%.3f.dat&quot;</span>,Dist);
<a name="l00127"></a>00127       FILE *FWrite = fopen(FName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00128"></a>00128       fclose(FWrite);
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130   }
<a name="l00131"></a>00131   <span class="keywordtype">int</span> NOut = 0;
<a name="l00132"></a>00132   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=NFile[0];f&lt;NFile[1];f++){
<a name="l00133"></a>00133     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00134"></a>00134     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_PART));
<a name="l00135"></a>00135     <span class="keywordtype">double</span> OutRatio = 100.*NOut/(double)(f*<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>());
<a name="l00136"></a>00136     fprintf(stderr,<span class="stringliteral">&quot;step %d)/%d fraction of number of beads out of the slab %lf %%\r&quot;</span>,f,NBin,OutRatio);
<a name="l00137"></a>00137     <span class="keywordtype">double</span> Rad2Mean = 0.;
<a name="l00138"></a>00138     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p = 0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00139"></a>00139       <span class="keywordtype">int</span> vr1 = PartOr[p];
<a name="l00140"></a>00140       <span class="keywordflow">if</span>(vr1 &lt; 0 || vr1 &gt;= NSlab) <span class="keywordflow">continue</span>;
<a name="l00141"></a>00141       <span class="keywordtype">double</span> dr2 = 0.;
<a name="l00142"></a>00142       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00143"></a>00143    dr[d] = <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[d] - <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d];
<a name="l00144"></a>00144    dr[d] -= floor(dr[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d);
<a name="l00145"></a>00145       }
<a name="l00146"></a>00146       dr2 = sqrt(SQR(dr[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]) + SQR(dr[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]));
<a name="l00147"></a>00147       <span class="keywordtype">int</span> vr = (int)(dr2*InvBoxRad*NSlab);
<a name="l00148"></a>00148       <span class="keywordflow">if</span>(vr != vr1){
<a name="l00149"></a>00149    NOut++;
<a name="l00150"></a>00150       }
<a name="l00151"></a>00151       <span class="keywordtype">double</span> Rad2 = 0.;
<a name="l00152"></a>00152       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;2;d++){
<a name="l00153"></a>00153    <span class="keywordtype">double</span> Dist = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d] - OldPos[3*p+d];
<a name="l00154"></a>00154    Dist -= floor(Dist*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d);
<a name="l00155"></a>00155    Rad2 += SQR(Dist);
<a name="l00156"></a>00156       }
<a name="l00157"></a>00157       <span class="comment">// vr or vr1?</span>
<a name="l00158"></a>00158       Diff[f*NSlab+vr1] += Rad2;
<a name="l00159"></a>00159       Rad2Mean += Rad2;
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161     <span class="keywordflow">if</span>(1==1){<span class="comment">//particle position and mean displacement</span>
<a name="l00162"></a>00162       Rad2Mean = <a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>()/Rad2Mean;
<a name="l00163"></a>00163       sprintf(FName,<span class="stringliteral">&quot;DisplPos%05d.dat&quot;</span>,f);
<a name="l00164"></a>00164       FILE *FWrite = fopen(FName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00165"></a>00165       fprintf(FWrite,<span class="stringliteral">&quot;# l(%lf %lf %lf) d[part]\n&quot;</span>,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>),.5);
<a name="l00166"></a>00166       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00167"></a>00167    <span class="keywordtype">double</span> Rad2 = 0.;
<a name="l00168"></a>00168    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;2;d++){
<a name="l00169"></a>00169      <span class="keywordtype">double</span> Dist = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d] - OldPos[3*p+d];
<a name="l00170"></a>00170      Dist -= floor(Dist*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d);
<a name="l00171"></a>00171      Rad2 += SQR(Dist);
<a name="l00172"></a>00172    }
<a name="l00173"></a>00173    <span class="keywordtype">int</span> vr1 = PartOr[p];
<a name="l00174"></a>00174    <span class="keywordtype">double</span> Vel = Rad2*Rad2Mean;
<a name="l00175"></a>00175    fprintf(FWrite,<span class="stringliteral">&quot;{x(%lf %lf %lf) v(%lf %lf %lf)\n&quot;</span>,<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Pos[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>],<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Pos[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>],Vel,Vel,Vel,Vel);
<a name="l00176"></a>00176       }
<a name="l00177"></a>00177       fclose(FWrite);
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00181"></a>00181   <span class="keywordtype">double</span> DisplMean = 0.;
<a name="l00182"></a>00182   <span class="comment">//normalize</span>
<a name="l00183"></a>00183   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0;v&lt;NSlab;v++){
<a name="l00184"></a>00184     Count[v] = Count[v] &gt; 0. ? 1./Count[v] : 1.;
<a name="l00185"></a>00185     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0;b&lt;NBin;b++){
<a name="l00186"></a>00186       Diff[b*NSlab+v] *= Count[v];
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0;v&lt;NSlab;v++){
<a name="l00190"></a>00190     DisplMean += Diff[(NBin-1)*NSlab+v] ;
<a name="l00191"></a>00191     <span class="keywordtype">double</span> Dist = v*BoxRad/(double)NSlab;
<a name="l00192"></a>00192     sprintf(FName,<span class="stringliteral">&quot;MeanSqDispl%.3f.dat&quot;</span>,Dist);
<a name="l00193"></a>00193     FILE *FWrite = fopen(FName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00194"></a>00194     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=1;b&lt;NBin;b++){
<a name="l00195"></a>00195       fprintf(FWrite,<span class="stringliteral">&quot;%d %lf\n&quot;</span>,b,Diff[b*NSlab+v]);
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197     fclose(FWrite);
<a name="l00198"></a>00198   }
<a name="l00199"></a>00199   DisplMean /= (double) NSlab;
<a name="l00200"></a>00200   <span class="keywordflow">if</span>(1==1){<span class="comment">//slab mean displ</span>
<a name="l00201"></a>00201     sprintf(FName,<span class="stringliteral">&quot;SlabMeadDispl.dat&quot;</span>);
<a name="l00202"></a>00202     FILE *FWrite = fopen(FName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00203"></a>00203     fprintf(FWrite,<span class="stringliteral">&quot;# l(%lf %lf %lf) d[part]\n&quot;</span>,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>),.5);
<a name="l00204"></a>00204     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;100;sx++){
<a name="l00205"></a>00205       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;100;sy++){
<a name="l00206"></a>00206    <span class="keywordtype">double</span> x = sx*.01*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>);
<a name="l00207"></a>00207    <span class="keywordtype">double</span> y = sy*.01*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00208"></a>00208    <span class="keywordtype">double</span> Rad2 = sqrt(SQR(x-<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>])+SQR(y-<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]));
<a name="l00209"></a>00209    <span class="keywordtype">int</span> vr = (int)(Rad2*InvBoxRad*NSlab);
<a name="l00210"></a>00210    <span class="keywordflow">if</span>(vr &lt; 0 || vr &gt;= NSlab) <span class="keywordflow">continue</span>;
<a name="l00211"></a>00211    <span class="keywordtype">double</span> Vel = Diff[(NBin-1)*NSlab+vr];
<a name="l00212"></a>00212    fprintf(FWrite,<span class="stringliteral">&quot;{x(%lf %lf %lf) v(%lf %lf %lf)\n&quot;</span>,x,y,Vel,Vel,Vel,Vel);
<a name="l00213"></a>00213       }
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215     fclose(FWrite);
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217   free(OldPos);
<a name="l00218"></a>00218   free(Diff);
<a name="l00219"></a>00219   free(Count);
<a name="l00220"></a>00220   free(PartOr);
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222 <span class="preprocessor">#include &lt;Cubo.h&gt;</span>
<a name="l00223"></a>00223 <span class="keyword">typedef</span> <a class="code" href="classDdLinkedList.html" title="Domain decomposition as pointer to linked particles.">DdLinkedList</a> <a class="code" href="classDdLinkedList.html" title="Domain decomposition as pointer to linked particles.">DomDec</a>;
<a name="l00224"></a><a class="code" href="classElPoly.html#a56b4b9780b4f84eb1713ca48b49fbbb2">00224</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a56b4b9780b4f84eb1713ca48b49fbbb2" title="1d pair correlation">ElPoly::PairCorr</a>(<span class="keywordtype">int</span> NBin,<span class="keywordtype">int</span> NDim){
<a name="l00225"></a>00225   <span class="keywordtype">int</span> NAlloc = NBin;
<a name="l00226"></a>00226   <span class="keywordtype">double</span> CutOff = 4.;
<a name="l00227"></a>00227   <span class="keywordflow">if</span>(NDim == 2) NAlloc = NBin*NBin;
<a name="l00228"></a>00228   <span class="keywordtype">double</span> *Prob = (<span class="keywordtype">double</span> *)calloc(NAlloc,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00229"></a>00229   <span class="keywordtype">double</span> Edge[3] = {<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(0),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(1),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(2)};
<a name="l00230"></a>00230   <span class="keywordtype">double</span> Norm = 0.;
<a name="l00231"></a>00231   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l00232"></a>00232     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00233"></a>00233     <span class="comment">// DomDec *Pc = new DomDec(Edge,pNPart(),1.);</span>
<a name="l00234"></a>00234     <span class="comment">// for(int p=0;p&lt;pNPart();p++) Pc-&gt;AddPart(p,Pm[p].Pos);</span>
<a name="l00235"></a>00235     <span class="comment">// int NeiList[27];</span>
<a name="l00236"></a>00236     <span class="keywordtype">double</span> DistRel[4];
<a name="l00237"></a>00237     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p1=0;p1&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p1++){
<a name="l00238"></a>00238       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p2=p1+1;p2&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p2++){
<a name="l00239"></a>00239    <span class="comment">// int NNei = Pc-&gt;GetNei(Pm[p1].Pos,NeiList);</span>
<a name="l00240"></a>00240    <span class="comment">// for(int i=0;i&lt;NNei;i++){</span>
<a name="l00241"></a>00241    <span class="comment">//   int c1 = NeiList[i];</span>
<a name="l00242"></a>00242    <span class="comment">//   for(Pc-&gt;SetCounters(c1);Pc-&gt;IfItCell(c1);Pc-&gt;IncrCurr(c1)){</span>
<a name="l00243"></a>00243    <span class="comment">//    int p2 = Pc-&gt;ItCell(c1);</span>
<a name="l00244"></a>00244    <span class="comment">//    if(p2 &lt; p1) continue;</span>
<a name="l00245"></a>00245    <span class="keywordflow">if</span>(!<a class="code" href="classVarData.html#a19886baf2914ac46bc50f333254a4e57" title="Return the relative distance between two particles (wrapped)">TwoPartDist</a>(p1,p2,DistRel,CutOff)) <span class="keywordflow">continue</span>;
<a name="l00246"></a>00246    <span class="keywordtype">int</span> r = (int)(DistRel[3]/CutOff*NBin);
<a name="l00247"></a>00247    <span class="keywordflow">if</span>(r &lt; 0 || r &gt;= NBin) <span class="keywordflow">continue</span>;
<a name="l00248"></a>00248    Prob[r] += 1.;
<a name="l00249"></a>00249    Norm += 1.;
<a name="l00250"></a>00250       }
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252     <span class="comment">// }</span>
<a name="l00253"></a>00253     <span class="comment">// delete Pc;</span>
<a name="l00254"></a>00254   }
<a name="l00255"></a>00255   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00256"></a>00256   Norm *= NFile[1] - NFile[0];
<a name="l00257"></a>00257   <span class="keywordtype">double</span> rInv = 1.*CutOff/(double)NBin;
<a name="l00258"></a>00258   FILE *FPair = fopen(<span class="stringliteral">&quot;PairCorrelation.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00259"></a>00259   fprintf(FPair,<span class="stringliteral">&quot;%lf %lf \n&quot;</span>,0.,Prob[0]/Norm);
<a name="l00260"></a>00260   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> r=1;r&lt;NBin;r++){
<a name="l00261"></a>00261     <span class="keywordtype">double</span> rr = r*CutOff/(double)NBin;
<a name="l00262"></a>00262     Prob[r] /= Norm*(CUBE(rr)-CUBE(rr-rInv));
<a name="l00263"></a>00263     fprintf(FPair,<span class="stringliteral">&quot;%lf %lf \n&quot;</span>,rr,Prob[r]);
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265   fclose(FPair);
<a name="l00266"></a>00266   free(Prob);
<a name="l00267"></a>00267 }
<a name="l00268"></a><a class="code" href="classElPoly.html#a7a3305d9ff38757faf367ced9abf89f0">00268</a> <span class="keywordtype">int</span> <a class="code" href="classElPoly.html#a7a3305d9ff38757faf367ced9abf89f0" title="1d, 2d pair correlation of the chains  pairRound pairSquare (obsolete)">ElPoly::PairCorrelationF</a>(<span class="keywordtype">int</span> NBin,<span class="keywordtype">int</span> How){
<a name="l00269"></a>00269   <span class="keywordtype">double</span> **Plot;
<a name="l00270"></a>00270   Plot = (<span class="keywordtype">double</span> **)calloc(NBin,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00271"></a>00271   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;NBin;i++){
<a name="l00272"></a>00272     *(Plot+i) = (<span class="keywordtype">double</span> *)calloc(NBin,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00273"></a>00273   }
<a name="l00274"></a>00274   <span class="keywordtype">double</span> *dDensity;
<a name="l00275"></a>00275   dDensity = (<span class="keywordtype">double</span> *)calloc(NBin,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00276"></a>00276   <span class="keywordtype">double</span> *dDensity1;
<a name="l00277"></a>00277   dDensity1 = (<span class="keywordtype">double</span> *)calloc(NBin,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00278"></a>00278   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l00279"></a>00279     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00280"></a>00280     <span class="comment">//printf(&quot;Opening: %s\n&quot;,cFile[f]);</span>
<a name="l00281"></a>00281     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_CHAIN))<span class="keywordflow">return</span> 1;
<a name="l00282"></a>00282     <span class="keywordflow">if</span>(How == 0 || How == 1)
<a name="l00283"></a>00283       <a class="code" href="classVarData.html#a510c054d13fe1a0f08ce51e357943a83" title="1-d pair correlation">PairCorrelation</a>(dDensity,NBin,How,<a class="code" href="classVarData.html#ab414e7210af332040754fc1daaa67509" title="Type of chain selected.">NChType</a>);
<a name="l00284"></a>00284     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (How == 2)
<a name="l00285"></a>00285       <a class="code" href="classVarData.html#a8e19dbeb530f71fe335e0c0e4dc461c7" title="Circular 2-d pair correlation.">PairCorrelationRound</a>(Plot,NBin,<a class="code" href="classVarData.html#ab414e7210af332040754fc1daaa67509" title="Type of chain selected.">NChType</a>);
<a name="l00286"></a>00286     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (How == 3)
<a name="l00287"></a>00287       <a class="code" href="classVarData.html#ac6d1ad4d99c748934659e3023246e766" title="2-d pair correlation on a square">PairCorrelationSquare</a>(Plot,NBin,<a class="code" href="classVarData.html#ab414e7210af332040754fc1daaa67509" title="Type of chain selected.">NChType</a>);
<a name="l00288"></a>00288     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (How == 4)
<a name="l00289"></a>00289       <a class="code" href="classVarData.html#a4b5e0c5a85245095780f116b7432df5b" title="2-d pair correlation on a square fererring to the pep position">PairCorrelationPep</a>(Plot,NBin,<a class="code" href="classVarData.html#ab414e7210af332040754fc1daaa67509" title="Type of chain selected.">NChType</a>);
<a name="l00290"></a>00290     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0;v&lt;NBin;v++){
<a name="l00291"></a>00291       <span class="comment">//printf(&quot;%d %lf\n&quot;,v,dDensity[v]);</span>
<a name="l00292"></a>00292       dDensity1[v] += dDensity[v];
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00296"></a>00296   <span class="keywordflow">if</span>(How == 0 || How == 1){
<a name="l00297"></a>00297     FILE *FileToWrite = fopen(<span class="stringliteral">&quot;PairCorrelation.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00298"></a>00298     fprintf(FileToWrite,<span class="stringliteral">&quot;# RadDist Density \n&quot;</span>);
<a name="l00299"></a>00299     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0;v&lt;NBin;v++){
<a name="l00300"></a>00300       dDensity1[v] /= NFile[1] - NFile[0];
<a name="l00301"></a>00301       fprintf(FileToWrite,<span class="stringliteral">&quot;%lf %lf\n&quot;</span>,(<span class="keywordtype">double</span>)v/(<span class="keywordtype">double</span>)NBin*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3),dDensity1[v]);
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303     fclose(FileToWrite);
<a name="l00304"></a>00304   }
<a name="l00305"></a>00305   <span class="keywordflow">else</span> {
<a name="l00306"></a>00306     <span class="keywordtype">double</span> Max=0.;
<a name="l00307"></a>00307     <span class="keywordtype">double</span> InvNBin=1./(double)NBin;
<a name="l00308"></a>00308     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0;v&lt;NBin;v++){
<a name="l00309"></a>00309       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> vv=0;vv&lt;NBin;vv++){
<a name="l00310"></a>00310    <span class="comment">// Plot[v][vv] /= DUE_PI*( QUAD((Gen-&gt;Edge[3]/InvNBin))*(QUAD((v+1)) - QUAD(v)) );</span>
<a name="l00311"></a>00311    <span class="keywordflow">if</span>(Max &lt; Plot[v][vv])
<a name="l00312"></a>00312      Max = Plot[v][vv];
<a name="l00313"></a>00313       }
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315     FILE *FileToWrite = fopen(<span class="stringliteral">&quot;PairCorrelation.xvl&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00316"></a>00316     fprintf(FileToWrite,<span class="stringliteral">&quot;#l(%lf %lf %lf) v[%d] d[%s]\n&quot;</span>,2.*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3),2.*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3),NBin,<a class="code" href="classElPoly.html#a86e52eb42d4ead5eb6b800ab1fd3a4d2" title="Convert the internal definition for the menu of ElPoly in string.">ChooseDraw</a>(EL_QUAD1));
<a name="l00317"></a>00317     <span class="keywordtype">int</span> vRef = (int)(NBin/2.);
<a name="l00318"></a>00318     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0;v&lt;NBin;v++){
<a name="l00319"></a>00319       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> vv=0;vv&lt;NBin;vv++){
<a name="l00320"></a>00320    <span class="keywordflow">if</span>(Plot[v][vv] &gt; 0.){
<a name="l00321"></a>00321      <span class="keywordflow">if</span>(How == 2){
<a name="l00322"></a>00322        <span class="keywordtype">double</span> PosX = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3) + InvNBin*(double)v*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3)*cos((<span class="keywordtype">double</span>)vv*InvNBin*DUE_PI);
<a name="l00323"></a>00323        <span class="keywordtype">double</span> PosY = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3) + InvNBin*(double)v*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3)*sin((<span class="keywordtype">double</span>)vv*InvNBin*DUE_PI);
<a name="l00324"></a>00324        fprintf(FileToWrite,<span class="stringliteral">&quot;{x(%lf %lf %lf)}\n&quot;</span>,
<a name="l00325"></a>00325           PosX,PosY,Plot[v][vv]/Max*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3));
<a name="l00326"></a>00326      }
<a name="l00327"></a>00327      <span class="keywordflow">else</span>{
<a name="l00328"></a>00328        <span class="keywordtype">double</span> PosX = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*.5 + (v - vRef)*InvNBin*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>);
<a name="l00329"></a>00329        <span class="keywordtype">double</span> PosY = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*.5 + (vv - vRef)*InvNBin*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00330"></a>00330        fprintf(FileToWrite,<span class="stringliteral">&quot;{x(%lf %lf %lf)}\n&quot;</span>,
<a name="l00331"></a>00331           PosX,PosY,Plot[v][vv]/Max*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3));
<a name="l00332"></a>00332      }
<a name="l00333"></a>00333      <span class="comment">//printf(&quot;%d %d %lf %lf %lf\n&quot;,v,vv,PosX,PosY,Plot[v][vv]);</span>
<a name="l00334"></a>00334    }
<a name="l00335"></a>00335       }
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337     fclose(FileToWrite);
<a name="l00338"></a>00338   }
<a name="l00339"></a>00339   free(Plot);
<a name="l00340"></a>00340   free(dDensity);
<a name="l00341"></a>00341   free(dDensity1);
<a name="l00342"></a>00342   <span class="keywordflow">return</span> 0;
<a name="l00343"></a>00343 }
<a name="l00344"></a><a class="code" href="classElPoly.html#a1aa4889418bf8c589875e1c77b5262d2">00344</a> <span class="keywordtype">int</span> <a class="code" href="classElPoly.html#a1aa4889418bf8c589875e1c77b5262d2" title="2d Scattering  scatt scatt2">ElPoly::ScatteringF</a>(<span class="keywordtype">int</span> NBin,<span class="keywordtype">int</span> How){
<a name="l00345"></a>00345   <span class="keywordtype">double</span> **Plot;
<a name="l00346"></a>00346   Plot = (<span class="keywordtype">double</span> **)calloc(NBin,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00347"></a>00347   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;NBin;i++){
<a name="l00348"></a>00348     *(Plot+i) = (<span class="keywordtype">double</span> *)calloc(NBin,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00349"></a>00349   }
<a name="l00350"></a>00350   <a class="code" href="classVarData.html#ac659e9234deb7729483b32fd9d6b5b30" title="Set Edge.">SetEdge</a>(.5*MIN(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)),3);
<a name="l00351"></a>00351   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l00352"></a>00352     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00353"></a>00353     <span class="comment">//printf(&quot;Opening: %s\n&quot;,cFile[f]);</span>
<a name="l00354"></a>00354     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_CHAIN))<span class="keywordflow">return</span> 1;
<a name="l00355"></a>00355     <a class="code" href="classVarData.html#a6499011573215b41c430029fddef1c97" title="2-d Scattering">Scattering2d</a>(Plot,NBin,<a class="code" href="classVarData.html#ab414e7210af332040754fc1daaa67509" title="Type of chain selected.">NChType</a>);
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00358"></a>00358   <span class="keywordtype">double</span> Max=0.;
<a name="l00359"></a>00359   <span class="keywordtype">double</span> InvNBin=1./(double)NBin;
<a name="l00360"></a>00360   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0;v&lt;NBin;v++){
<a name="l00361"></a>00361     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> vv=0;vv&lt;NBin;vv++){
<a name="l00362"></a>00362       Plot[v][vv] = POS(Plot[v][vv]);
<a name="l00363"></a>00363       <span class="keywordflow">if</span>(Max &lt; Plot[v][vv])
<a name="l00364"></a>00364    Max = Plot[v][vv];
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366   }
<a name="l00367"></a>00367   Max = 1./Max;
<a name="l00368"></a>00368   FILE *FileToWrite = NULL;
<a name="l00369"></a>00369   <span class="keywordflow">if</span>(How == 0)
<a name="l00370"></a>00370     FileToWrite = fopen(<span class="stringliteral">&quot;Scattering.xvl&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00371"></a>00371   <span class="keywordflow">else</span> 
<a name="l00372"></a>00372     FileToWrite = fopen(<span class="stringliteral">&quot;Scattering2.xvl&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);    
<a name="l00373"></a>00373   fprintf(FileToWrite,<span class="stringliteral">&quot;#l(%lf %lf %lf) v(%d) d[%s]\n&quot;</span>,2.*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3),2.*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(3),NBin,<a class="code" href="classElPoly.html#a86e52eb42d4ead5eb6b800ab1fd3a4d2" title="Convert the internal definition for the menu of ElPoly in string.">ChooseDraw</a>(EL_QUAD));
<a name="l00374"></a>00374   <span class="keywordtype">int</span> vRef = NBin/2;
<a name="l00375"></a>00375   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> q=0;q&lt;4;q++){
<a name="l00376"></a>00376     <span class="keywordtype">double</span> Signx = !(q%2) ? 1. : -1.;
<a name="l00377"></a>00377     <span class="keywordtype">double</span> Signy =  q &gt; 1 ? 1. : -1.;
<a name="l00378"></a>00378     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> vx=0;vx&lt;NBin;vx++){
<a name="l00379"></a>00379       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> vy=0;vy&lt;NBin;vy++){
<a name="l00380"></a>00380    <span class="comment">//if(Plot[v][vv] &gt; 0.)</span>
<a name="l00381"></a>00381    {
<a name="l00382"></a>00382      <span class="keywordtype">double</span> PosX = Signx*vx*InvNBin*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>);
<a name="l00383"></a>00383      <span class="keywordtype">double</span> PosY = Signy*vy*InvNBin*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00384"></a>00384      <span class="comment">//printf(&quot;%d %d %lf %lf %lf\n&quot;,v,vv,PosX,PosY,Plot[v][vv]);</span>
<a name="l00385"></a>00385      fprintf(FileToWrite,<span class="stringliteral">&quot;{x(%lf %lf %lf) v(%lf %lf %lf)}\n&quot;</span>,
<a name="l00386"></a>00386         PosX,PosY,Plot[vx][vy]*.001,Plot[vx][vy],0.,0.);
<a name="l00387"></a>00387    }
<a name="l00388"></a>00388       } 
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390   }
<a name="l00391"></a>00391   fclose(FileToWrite);
<a name="l00392"></a>00392   free(Plot);
<a name="l00393"></a>00393   <span class="keywordflow">return</span> 0;
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 <span class="comment">//obsolete?</span>
<a name="l00396"></a><a class="code" href="classElPoly.html#afe2c794cc4f62f2e547526f63e82acfe">00396</a> <span class="keywordtype">int</span> <a class="code" href="classElPoly.html#afe2c794cc4f62f2e547526f63e82acfe" title="Calculates the number of chain per area  area.">ElPoly::NChainPSquareF</a>(){
<a name="l00397"></a>00397   <span class="keywordtype">int</span> NTimes = 20;
<a name="l00398"></a>00398   <span class="keywordtype">double</span> *ChainPArea = (<span class="keywordtype">double</span> *)calloc(3*NTimes,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00399"></a>00399   <span class="keywordtype">double</span> MeanSigma = 0.;
<a name="l00400"></a>00400   <span class="keywordtype">int</span> SubDiv[3] = {NTimes,NTimes,1};
<a name="l00401"></a>00401   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l00402"></a>00402     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00403"></a>00403     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_PART))<span class="keywordflow">return</span> 1;
<a name="l00404"></a>00404     <span class="comment">//    OrderPos();</span>
<a name="l00405"></a>00405     SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>] = 1;
<a name="l00406"></a>00406     SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>] = 1;
<a name="l00407"></a>00407     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;NTimes;t++){
<a name="l00408"></a>00408       <span class="keywordflow">if</span>( (t%2)==0) 
<a name="l00409"></a>00409    SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>] += 1;
<a name="l00410"></a>00410       <span class="keywordflow">if</span>( (t%2-1)==0)
<a name="l00411"></a>00411    SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>] += 1;
<a name="l00412"></a>00412       <span class="keywordtype">double</span> <a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a> = (double)(SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]);
<a name="l00413"></a>00413       <span class="keywordtype">double</span> *Plot = (<span class="keywordtype">double</span> *)calloc((<span class="keywordtype">int</span>)<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>,<span class="keyword">sizeof</span>(double));
<a name="l00414"></a>00414       <span class="keywordtype">double</span> Area = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(CLat2)/<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>;
<a name="l00415"></a>00415       <span class="keywordtype">double</span> SumX = 0.;
<a name="l00416"></a>00416       <span class="keywordtype">double</span> SumX2 = 0.;
<a name="l00417"></a>00417       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00418"></a>00418    <span class="keywordtype">int</span> vx = (int)(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]);
<a name="l00419"></a>00419    <span class="keywordflow">if</span>(vx &gt; SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]) <span class="keywordflow">continue</span>;
<a name="l00420"></a>00420    <span class="keywordtype">int</span> vy = (int)(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,CLat2)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(CLat2)*SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]);
<a name="l00421"></a>00421    <span class="keywordflow">if</span>(vy &gt; SubDiv[CLat2]) <span class="keywordflow">continue</span>;
<a name="l00422"></a>00422    Plot[vx*SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>] + vy] += 1.;
<a name="l00423"></a>00423       }
<a name="l00424"></a>00424       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;n&lt;<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>;n++){
<a name="l00425"></a>00425    SumX += Plot[n]/Area;
<a name="l00426"></a>00426    SumX2 += QUAD((Plot[n]/Area));
<a name="l00427"></a>00427    Plot[n] /= Area;
<a name="l00428"></a>00428       }
<a name="l00429"></a>00429       <span class="keywordtype">int</span> Valori = 20;
<a name="l00430"></a>00430       <span class="keywordtype">double</span> *Intervalli = (<span class="keywordtype">double</span> *)calloc(Valori,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00431"></a>00431       <span class="keywordtype">int</span> IfNorm = 0;
<a name="l00432"></a>00432       <a class="code" href="structMOMENTI.html" title="Moments of a distribution.">MOMENTI</a> m1 = <a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#a39b05b88f4b8ec478bd4da89c0e469d0" title="Moments of a signal.">Distribuzione</a>(Plot,(<span class="keywordtype">int</span>)NEdge,Intervalli,Valori,IfNorm);
<a name="l00433"></a>00433       ChainPArea[3*t+0] = <a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>;
<a name="l00434"></a>00434       MeanSigma += m1.<a class="code" href="structMOMENTI.html#ace35fa89d42816a5d3c59ff882b65e4c" title="First moment.">Uno</a>;
<a name="l00435"></a>00435       <span class="keywordtype">double</span> Media = SumX/<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>;
<a name="l00436"></a>00436       ChainPArea[3*t+1] = sqrt((SumX2 - Media*Media*NEdge)/(NEdge-1));
<a name="l00437"></a>00437       printf(<span class="stringliteral">&quot;%lf  %lf-%lf\n&quot;</span>,m1.<a class="code" href="structMOMENTI.html#ace35fa89d42816a5d3c59ff882b65e4c" title="First moment.">Uno</a>,ChainPArea[3*t+1],m1.<a class="code" href="structMOMENTI.html#a15d9d06c593c6771637966bd64f78b6f" title="Second moment.">Due</a>);
<a name="l00438"></a>00438       ChainPArea[3*t+2] = Area*QUAD(m1.<a class="code" href="structMOMENTI.html#a15d9d06c593c6771637966bd64f78b6f" title="Second moment.">Due</a>)/QUAD(m1.<a class="code" href="structMOMENTI.html#ace35fa89d42816a5d3c59ff882b65e4c" title="First moment.">Uno</a>);
<a name="l00439"></a>00439       <span class="comment">//QUAD(Area)*ChainPArea[4*t+2]/QUAD(ChainPArea[4*t+1]);</span>
<a name="l00440"></a>00440       free(Plot);
<a name="l00441"></a>00441       free(Intervalli);
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443   }
<a name="l00444"></a>00444   <span class="keywordtype">char</span> *FileName = (<span class="keywordtype">char</span> *)calloc(60,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00445"></a>00445   sprintf(FileName,<span class="stringliteral">&quot;ChainPArea%.0fKappa%.0fRho%.0f.dat&quot;</span>,<a class="code" href="classVarData.html#a8def89edf23019d700fdbadb476e4c0a" title="Incompatibility.">pchiN</a>(),<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>(),<a class="code" href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9" title="Density coexistence.">prho</a>());
<a name="l00446"></a>00446   FILE *FileToWrite = fopen(FileName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00447"></a>00447   <span class="keywordtype">char</span> cSystem[STRSIZE];
<a name="l00448"></a>00448   <a class="code" href="classVarData.html#aa415b42b89dfba2ab8189be4e86b41ad" title="Print a string with the system definitions.">SysDef</a>(cSystem);
<a name="l00449"></a>00449   fprintf(FileToWrite,<span class="stringliteral">&quot;# %s&quot;</span>,cSystem);
<a name="l00450"></a>00450   fprintf(FileToWrite,<span class="stringliteral">&quot;#%lf\n&quot;</span>,MeanSigma/(<span class="keywordtype">double</span>)(NFile[1]-NFile[0]));
<a name="l00451"></a>00451   fprintf(FileToWrite,<span class="stringliteral">&quot;# NEdge SDeviation Area*Dev/NEdge\n&quot;</span>);
<a name="l00452"></a>00452   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;NTimes;t++)
<a name="l00453"></a>00453     fprintf(FileToWrite,<span class="stringliteral">&quot;%lf %lf %lf\n&quot;</span>,ChainPArea[3*t+0],ChainPArea[3*t+1],ChainPArea[3*t+2]);
<a name="l00454"></a>00454   fclose(FileToWrite);
<a name="l00455"></a>00455   free(FileName);
<a name="l00456"></a>00456   free(ChainPArea);
<a name="l00457"></a>00457   <span class="keywordflow">return</span> 0;
<a name="l00458"></a>00458 }
<a name="l00459"></a><a class="code" href="classElPoly.html#ada953db0b772595339ef925b5dbd8c62">00459</a> <span class="keywordtype">int</span> <a class="code" href="classElPoly.html#ada953db0b772595339ef925b5dbd8c62" title="Calculates the 1d, 2d spectrum  spe.">ElPoly::SpectrumF</a>(<span class="keywordtype">int</span> NSample){
<a name="l00460"></a>00460   <span class="keywordtype">int</span> NHalf = NSample/2;
<a name="l00461"></a>00461   <span class="keywordtype">double</span> InvNFile = 1./(double)(<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1]-<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0]);
<a name="l00462"></a>00462   <span class="keywordtype">double</span> InvNSample = 1./(double)NSample;
<a name="l00463"></a>00463   <span class="keywordtype">double</span> InvNSample2 = 1./(double)SQR(NSample);
<a name="l00464"></a>00464   <span class="keywordtype">double</span> *Plot = (<span class="keywordtype">double</span> *) calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l00465"></a>00465   <span class="keywordtype">double</span> *PlotUp = (<span class="keywordtype">double</span> *) calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l00466"></a>00466   <span class="keywordtype">double</span> *PlotDown = (<span class="keywordtype">double</span> *) calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l00467"></a>00467   <span class="keywordtype">double</span> *CountUp = (<span class="keywordtype">double</span> *) calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l00468"></a>00468   <span class="keywordtype">double</span> *CountDown = (<span class="keywordtype">double</span> *) calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l00469"></a>00469   <span class="keywordtype">double</span> *PlotBS = (<span class="keywordtype">double</span> *) calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l00470"></a>00470   <span class="keywordtype">double</span> *PlotA = (<span class="keywordtype">double</span> *)calloc(SQR(NSample), <span class="keyword">sizeof</span>(double));
<a name="l00471"></a>00471   <span class="keywordtype">double</span> *PlotAUp = (<span class="keywordtype">double</span> *)calloc(SQR(NSample), <span class="keyword">sizeof</span>(double));
<a name="l00472"></a>00472   <span class="keywordtype">double</span> *PlotADown = (<span class="keywordtype">double</span> *)calloc(SQR(NSample), <span class="keyword">sizeof</span>(double));
<a name="l00473"></a>00473   <span class="keywordtype">double</span> *PlotThin = (<span class="keywordtype">double</span> *)calloc(SQR(NSample), <span class="keyword">sizeof</span>(double));
<a name="l00474"></a>00474   <span class="keywordtype">double</span> *Count = (<span class="keywordtype">double</span> *) calloc(NSample*NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00475"></a>00475 <span class="preprocessor">#ifdef  USE_FFTW</span>
<a name="l00476"></a>00476 <span class="preprocessor"></span>  fftw_complex *out = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00477"></a>00477   fftw_complex *in = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00478"></a>00478   fftw_plan plan = fftw_plan_dft_2d(NSample,NSample,
<a name="l00479"></a>00479                  in, out,FFTW_FORWARD,FFTW_PATIENT);
<a name="l00480"></a>00480   fftw_complex *outUp = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00481"></a>00481   fftw_complex *inUp = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00482"></a>00482   fftw_plan planUp = fftw_plan_dft_2d(NSample,NSample,
<a name="l00483"></a>00483                  inUp, outUp,FFTW_FORWARD,FFTW_PATIENT);
<a name="l00484"></a>00484   fftw_complex *outDown = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00485"></a>00485   fftw_complex *inDown = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00486"></a>00486   fftw_plan planDown = fftw_plan_dft_2d(NSample,NSample,
<a name="l00487"></a>00487                  inDown, outDown,FFTW_FORWARD,FFTW_PATIENT);
<a name="l00488"></a>00488                <span class="comment">//FFTW_MEASURE);</span>
<a name="l00489"></a>00489   fftw_complex *outThin = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00490"></a>00490   fftw_complex *inThin = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00491"></a>00491   fftw_plan planThin = fftw_plan_dft_2d(NSample,NSample,
<a name="l00492"></a>00492                  inThin, outThin,FFTW_FORWARD,FFTW_PATIENT);
<a name="l00493"></a>00493                <span class="comment">//FFTW_MEASURE);</span>
<a name="l00494"></a>00494 <span class="preprocessor">#endif</span>
<a name="l00495"></a>00495 <span class="preprocessor"></span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l00496"></a>00496     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00497"></a>00497     <span class="comment">// memset(Plot,0.,NSample*NSample*sizeof(double));</span>
<a name="l00498"></a>00498     <span class="comment">// memset(Count,0.,NSample*NSample*sizeof(double));</span>
<a name="l00499"></a>00499     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0;s&lt;SQR(NSample);s++){
<a name="l00500"></a>00500       Plot[s] = 0.;
<a name="l00501"></a>00501       Count[s] = 0.;
<a name="l00502"></a>00502       PlotUp[s] = 0.;
<a name="l00503"></a>00503       CountUp[s] = 0.;
<a name="l00504"></a>00504       PlotDown[s] = 0.;
<a name="l00505"></a>00505       CountDown[s] = 0.;
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_CHAIN))<span class="keywordflow">return</span> 0;
<a name="l00508"></a>00508     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00509"></a>00509       <span class="keywordtype">int</span> sx = (int)(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*NSample);
<a name="l00510"></a>00510       <span class="keywordtype">int</span> sy = (int)(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*NSample);
<a name="l00511"></a>00511       <span class="keywordflow">if</span>(sx &lt; 0 || sx &gt;= NSample) <span class="keywordflow">continue</span>;
<a name="l00512"></a>00512       <span class="keywordflow">if</span>(sy &lt; 0 || sy &gt;= NSample) <span class="keywordflow">continue</span>;
<a name="l00513"></a>00513       Plot[sx*NSample+sy] += <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);<span class="comment">// - pCm(CNorm);</span>
<a name="l00514"></a>00514       Count[sx*NSample+sy] += 1.;
<a name="l00515"></a>00515       <span class="comment">//if(Pm[p].Typ != 1) continue;</span>
<a name="l00516"></a>00516       <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[<a class="code" href="classVarData.html#ab7c7c0a0081da25f3d4624ae61dc9d68" title="Return the chain.">pChain</a>(p)].Type,CHAIN_UP)){
<a name="l00517"></a>00517    PlotUp[sx*NSample+sy] += <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);
<a name="l00518"></a>00518    CountUp[sx*NSample+sy] += 1.;
<a name="l00519"></a>00519       }
<a name="l00520"></a>00520       <span class="keywordflow">else</span> {
<a name="l00521"></a>00521    PlotDown[sx*NSample+sy] += <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);
<a name="l00522"></a>00522    CountDown[sx*NSample+sy] += 1.;
<a name="l00523"></a>00523       }
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525     <span class="keywordtype">double</span> MeanThick = 0.;
<a name="l00526"></a>00526     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0;s&lt;SQR(NSample);s++){
<a name="l00527"></a>00527       Plot[s] /= Count[s] &gt; 0. ? Count[s] : 1.;
<a name="l00528"></a>00528       PlotUp[s] /= CountUp[s] &gt; 0. ? CountUp[s] : 1.;
<a name="l00529"></a>00529       PlotDown[s] /= CountDown[s] &gt; 0. ? CountDown[s] : 1.;
<a name="l00530"></a>00530       MeanThick += CountUp[s] - CountDown[s];
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532     MeanThick /= (double)SQR(NSample);
<a name="l00533"></a>00533     <span class="comment">//InterBSpline2D(Plot,PlotBS,NSample,NSample);</span>
<a name="l00534"></a>00534     <span class="comment">//InterBSpline2D(PlotBS,Plot,NSample,NSample);</span>
<a name="l00535"></a>00535 <span class="preprocessor">#ifdef USE_FFTW</span>
<a name="l00536"></a>00536 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(1==1){
<a name="l00537"></a>00537       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0;s&lt;SQR(NSample);s++){
<a name="l00538"></a>00538    in[s][0] = Plot[s];
<a name="l00539"></a>00539    in[s][1] = 0.;
<a name="l00540"></a>00540    inThin[s][0] = PlotUp[s]-PlotDown[s];
<a name="l00541"></a>00541    inThin[s][1] = 0.;
<a name="l00542"></a>00542    inUp[s][0] = PlotUp[s];
<a name="l00543"></a>00543    inUp[s][1] = 0.;
<a name="l00544"></a>00544    inDown[s][0] = PlotDown[s];
<a name="l00545"></a>00545    inDown[s][1] = 0.;
<a name="l00546"></a>00546       }
<a name="l00547"></a>00547       fftw_execute(plan);
<a name="l00548"></a>00548       fftw_execute(planThin);
<a name="l00549"></a>00549       fftw_execute(planUp);
<a name="l00550"></a>00550       fftw_execute(planDown);
<a name="l00551"></a>00551       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00552"></a>00552    <span class="keywordtype">int</span> ssx = sx &lt; NHalf ? sx + NHalf : sx - NHalf;
<a name="l00553"></a>00553    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00554"></a>00554      <span class="keywordtype">int</span> ssy = sy &lt; NHalf ? sy + NHalf : sy - NHalf;
<a name="l00555"></a>00555      PlotA[ssx*NSample+ssy] += (SQR(out[sx*NSample+sy][0])+SQR(out[sx*NSample+sy][1]))*SQR(InvNSample2);
<a name="l00556"></a>00556      PlotThin[ssx*NSample+ssy] += (SQR(outThin[sx*NSample+sy][0])+SQR(outThin[sx*NSample+sy][1]))*SQR(InvNSample2);
<a name="l00557"></a>00557      PlotAUp[ssx*NSample+ssy] += (SQR(outUp[sx*NSample+sy][0])+SQR(outUp[sx*NSample+sy][1]))*SQR(InvNSample2);
<a name="l00558"></a>00558      PlotADown[ssx*NSample+ssy] += (SQR(outDown[sx*NSample+sy][0])+SQR(outDown[sx*NSample+sy][1]))*SQR(InvNSample2);
<a name="l00559"></a>00559    }
<a name="l00560"></a>00560       }
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562     <span class="keywordflow">else</span> {
<a name="l00563"></a>00563       <span class="keywordtype">int</span> NMax = NSample;
<a name="l00564"></a>00564       <span class="keywordtype">double</span> *st = Plot;
<a name="l00565"></a>00565       <span class="keywordtype">double</span> *sw = PlotA;
<a name="l00566"></a>00566       <span class="keywordtype">double</span> dNMax = 1./(double)NMax;
<a name="l00567"></a>00567       <span class="keywordtype">int</span> NHalf = (int)(NMax/2.);
<a name="l00568"></a>00568       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> kx=-NHalf;kx&lt;NHalf;kx++){
<a name="l00569"></a>00569    <span class="keywordtype">double</span> qx = kx*dNMax;
<a name="l00570"></a>00570    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ky=-NHalf;ky&lt;NHalf;ky++){
<a name="l00571"></a>00571      <span class="keywordtype">double</span> qy = ky*dNMax;
<a name="l00572"></a>00572      <span class="keywordtype">double</span> Re2=0.,Im2=0.;
<a name="l00573"></a>00573      <span class="keywordtype">double</span> Re1=0.,Im1=0.;
<a name="l00574"></a>00574      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lx=0;lx&lt;NMax;lx++){
<a name="l00575"></a>00575        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ly=0;ly&lt;NMax;ly++){
<a name="l00576"></a>00576          <span class="keywordtype">double</span> Arg = 2.*M_PI*(lx*qx + ly*qy);
<a name="l00577"></a>00577          <span class="keywordtype">double</span> cy = cos(Arg);
<a name="l00578"></a>00578          <span class="keywordtype">double</span> sy = sin(Arg);
<a name="l00579"></a>00579          Re1 += st[lx*NMax+ly]*cy;
<a name="l00580"></a>00580          Im1 += st[lx*NMax+ly]*sy;
<a name="l00581"></a>00581        }
<a name="l00582"></a>00582      }
<a name="l00583"></a>00583      <span class="keywordtype">int</span> kkx = kx + NHalf;
<a name="l00584"></a>00584      <span class="keywordtype">int</span> kky = ky + NHalf;
<a name="l00585"></a>00585      sw[kkx*NMax+kky] += SQR(Re1*dNMax) + SQR(Im1*dNMax);
<a name="l00586"></a>00586    }
<a name="l00587"></a>00587       }
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589     <span class="keywordflow">if</span>(1==0){
<a name="l00590"></a>00590       FILE *FMidplane = fopen(<span class="stringliteral">&quot;Midplane.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00591"></a>00591       FILE *FThickness = fopen(<span class="stringliteral">&quot;Thickness.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00592"></a>00592       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00593"></a>00593    <span class="keywordtype">double</span> x = sx*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*InvNSample;
<a name="l00594"></a>00594    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00595"></a>00595      <span class="keywordtype">double</span> y = sy*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*InvNSample;
<a name="l00596"></a>00596      fprintf(FMidplane,<span class="stringliteral">&quot;%lf %lf %lf \n&quot;</span>,x,y, Plot[sx*NSample+sy]);
<a name="l00597"></a>00597      fprintf(FThickness,<span class="stringliteral">&quot;%lf %lf %lf \n&quot;</span>,x,y,PlotUp[sx*NSample+sy]-PlotDown[sx*NSample+sy]);
<a name="l00598"></a>00598    }
<a name="l00599"></a>00599       }
<a name="l00600"></a>00600       fclose(FMidplane);
<a name="l00601"></a>00601       fclose(FThickness);
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603 <span class="preprocessor">#else</span>
<a name="l00604"></a>00604 <span class="preprocessor"></span>    <a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#a817fad189f184396efc334a2429fdf7a" title="Compute the 2d spectrum of.">Spettro2d</a>(Plot,PlotA,NSample);
<a name="l00605"></a>00605 <span class="preprocessor">#endif //FFTW3_H</span>
<a name="l00606"></a>00606 <span class="preprocessor"></span>  }
<a name="l00607"></a>00607   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00608"></a>00608 <span class="preprocessor">#ifdef OMPI_MPI_H</span>
<a name="l00609"></a>00609 <span class="preprocessor"></span>  MPI_Allreduce(MPI_IN_PLACE,PlotA,NSample*NSample, MPI_DOUBLE, MPI_SUM, Proc-&gt;CommGrid);
<a name="l00610"></a>00610   <span class="keywordtype">int</span> Rank=0;
<a name="l00611"></a>00611   MPI_Comm_rank(Proc-&gt;CommGrid, &amp;Rank);
<a name="l00612"></a>00612   <span class="keywordflow">if</span>(Rank==0){
<a name="l00613"></a>00613 <span class="preprocessor">#endif</span>
<a name="l00614"></a>00614 <span class="preprocessor"></span>    <span class="keywordtype">char</span> *NomeFile = (<span class="keywordtype">char</span>*)calloc(60,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00615"></a>00615     sprintf(NomeFile,<span class="stringliteral">&quot;Spectrum.xvl&quot;</span>,<a class="code" href="classVarData.html#a8def89edf23019d700fdbadb476e4c0a" title="Incompatibility.">pchiN</a>(),<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>(),<a class="code" href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9" title="Density coexistence.">prho</a>());
<a name="l00616"></a>00616     FILE *FileToWrite = fopen(NomeFile,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00617"></a>00617     fprintf(FileToWrite,<span class="stringliteral">&quot;#l(%lf %lf %lf) v[%d] d[squaremesh]\n&quot;</span>,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>),NSample);
<a name="l00618"></a>00618     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00619"></a>00619       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00620"></a>00620    <span class="keywordtype">double</span> x = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*sx*InvNSample;
<a name="l00621"></a>00621    <span class="keywordtype">double</span> y = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*sy*InvNSample;
<a name="l00622"></a>00622    fprintf(FileToWrite,<span class="stringliteral">&quot;{x(%lf %lf %lf) v(%lf %lf %lf)}\n&quot;</span>,x,y,PlotA[sx*NSample+sy]*InvNFile,fabs(log10(PlotA[sx*NSample+sy]*InvNFile)),0.,0.);
<a name="l00623"></a>00623       }
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625     printf(<span class="stringliteral">&quot;Write\n&quot;</span>);
<a name="l00626"></a>00626     fclose(FileToWrite);
<a name="l00627"></a>00627     sprintf(NomeFile,<span class="stringliteral">&quot;Spectrum.dat&quot;</span>,<a class="code" href="classVarData.html#a8def89edf23019d700fdbadb476e4c0a" title="Incompatibility.">pchiN</a>(),<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>(),<a class="code" href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9" title="Density coexistence.">prho</a>());
<a name="l00628"></a>00628     FileToWrite = fopen(NomeFile,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00629"></a>00629     fprintf(FileToWrite,<span class="stringliteral">&quot;# 1) q^2 2) h(q)^2*L_xL_y | q_x=s2pi/(L_x) NSample %d\n&quot;</span>,NSample);
<a name="l00630"></a>00630     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> kx=0;kx&lt;NSample;kx++){
<a name="l00631"></a>00631       <span class="keywordtype">int</span> kx1 = kx - NSample/2;
<a name="l00632"></a>00632       <span class="keywordtype">double</span> qx  = 2.*M_PI*kx*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>);
<a name="l00633"></a>00633       <span class="keywordtype">double</span> qxt = 2.*M_PI*kx1*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>);
<a name="l00634"></a>00634       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ky=0;ky&lt;NSample;ky++){
<a name="l00635"></a>00635    <span class="keywordtype">int</span> ky1 = ky - NSample/2;
<a name="l00636"></a>00636    <span class="keywordtype">double</span> qy  = 2.*M_PI*ky*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00637"></a>00637    <span class="keywordtype">double</span> qyt = 2.*M_PI*ky1*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00638"></a>00638    <span class="keywordtype">double</span> qq = SQR(qxt) + SQR(qyt);
<a name="l00639"></a>00639    <span class="keywordtype">double</span> Spe = PlotA[kx*NSample+ky]*InvNFile*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00640"></a>00640    <span class="keywordtype">double</span> SpeUp = PlotAUp[kx*NSample+ky]*InvNFile*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00641"></a>00641    <span class="keywordtype">double</span> SpeDown = PlotADown[kx*NSample+ky]*InvNFile*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00642"></a>00642    <span class="keywordtype">double</span> SpeThin = PlotThin[kx*NSample+ky]*InvNFile*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00643"></a>00643    fprintf(FileToWrite,<span class="stringliteral">&quot;%lf %g %g %g %g\n&quot;</span>,qq,Spe,SpeUp,SpeDown,SpeThin);
<a name="l00644"></a>00644       }
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646     fclose(FileToWrite);
<a name="l00647"></a>00647     free(NomeFile);
<a name="l00648"></a>00648 <span class="preprocessor">#ifdef OMPI_MPI_H</span>
<a name="l00649"></a>00649 <span class="preprocessor"></span>  }
<a name="l00650"></a>00650 <span class="preprocessor">#endif</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>  free(Plot);
<a name="l00652"></a>00652   free(PlotA);
<a name="l00653"></a>00653   free(PlotBS);
<a name="l00654"></a>00654   free(Count);
<a name="l00655"></a>00655 <span class="preprocessor">#ifdef USE_FFTW</span>
<a name="l00656"></a>00656 <span class="preprocessor"></span>  fftw_destroy_plan(plan);
<a name="l00657"></a>00657 <span class="preprocessor">#endif</span>
<a name="l00658"></a>00658 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 0;
<a name="l00659"></a>00659 }
<a name="l00660"></a><a class="code" href="classElPoly.html#a16156b6e530ecc6df93b6ffd3c229f1b">00660</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a16156b6e530ecc6df93b6ffd3c229f1b" title="Midplanes for a sequence of snapshots.">ElPoly::Midplane</a>(<span class="keywordtype">int</span> NSample){
<a name="l00661"></a>00661   <span class="keywordtype">int</span> NHalf = NSample/2;
<a name="l00662"></a>00662   <span class="keywordtype">double</span> InvNFile = 1./(double)(<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1]-<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0]);
<a name="l00663"></a>00663   <span class="keywordtype">double</span> InvNSample = 1./(double)NSample;
<a name="l00664"></a>00664   <span class="keywordtype">double</span> *PlotBS  = (<span class="keywordtype">double</span> *) calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l00665"></a>00665   <span class="keywordtype">double</span> *Count = (<span class="keywordtype">double</span> *) calloc(NSample*NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00666"></a>00666   <span class="keywordtype">double</span> *Plot  = (<span class="keywordtype">double</span> *) calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l00667"></a>00667   <span class="keywordtype">double</span> *PlotA  = (<span class="keywordtype">double</span> *) calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l00668"></a>00668   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l00669"></a>00669     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00670"></a>00670     <span class="comment">// memset(Plot,0.,NSample*NSample*sizeof(double));</span>
<a name="l00671"></a>00671     <span class="comment">// memset(Count,0.,NSample*NSample*sizeof(double));</span>
<a name="l00672"></a>00672     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00673"></a>00673       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00674"></a>00674       Plot[sx*NSample+sy] = 0.;
<a name="l00675"></a>00675       }
<a name="l00676"></a>00676     }
<a name="l00677"></a>00677     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],<a class="code" href="classElPoly.html#a051cdcf73b2b4af010122eed5c23c59d" title="Type of backfold.">NBackFold</a>))<span class="keywordflow">return</span>;
<a name="l00678"></a>00678     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00679"></a>00679       <span class="keywordtype">int</span> sx = (int)(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*NSample);
<a name="l00680"></a>00680       <span class="keywordtype">int</span> sy = (int)(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*NSample);
<a name="l00681"></a>00681       <span class="keywordflow">if</span>(sx &lt; 0 || sx &gt;= NSample) <span class="keywordflow">continue</span>;
<a name="l00682"></a>00682       <span class="keywordflow">if</span>(sy &lt; 0 || sy &gt;= NSample) <span class="keywordflow">continue</span>;
<a name="l00683"></a>00683       Plot[sx*NSample+sy] += <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);<span class="comment">// - pCm(CNorm);</span>
<a name="l00684"></a>00684       Count[sx*NSample+sy] += 1.;
<a name="l00685"></a>00685     }
<a name="l00686"></a>00686     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00687"></a>00687       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00688"></a>00688    Plot[sx*NSample+sy] /= Count[sx*NSample+sy] &gt; 0. ? Count[sx*NSample+sy] : 1.;
<a name="l00689"></a>00689    PlotA[sx*NSample+sy] += Plot[sx*NSample+sy];
<a name="l00690"></a>00690       }
<a name="l00691"></a>00691     }
<a name="l00692"></a>00692     <span class="comment">// InterBSpline2D(Plot,PlotBS,NSample,NSample);</span>
<a name="l00693"></a>00693     <span class="comment">// InterBSpline2D(PlotBS,Plot,NSample,NSample);</span>
<a name="l00694"></a>00694     <span class="keywordtype">char</span> FName[60];
<a name="l00695"></a>00695     sprintf(FName,<span class="stringliteral">&quot;Midplane%05d.dat&quot;</span>,f);
<a name="l00696"></a>00696     FILE *FMid = fopen(FName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00697"></a>00697     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00698"></a>00698       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00699"></a>00699    <span class="keywordtype">double</span> x = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*sx*InvNSample;
<a name="l00700"></a>00700    <span class="keywordtype">double</span> y = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*sy*InvNSample;
<a name="l00701"></a>00701    fprintf(FMid,<span class="stringliteral">&quot;%lf %lf %lf\n&quot;</span>,x,y,Plot[sx*NSample+sy]);
<a name="l00702"></a>00702       }
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704     fclose(FMid);
<a name="l00705"></a>00705   }
<a name="l00706"></a>00706   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00707"></a>00707   FILE *FMid = fopen(<span class="stringliteral">&quot;average_middplane.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00708"></a>00708   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00709"></a>00709     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00710"></a>00710       <span class="keywordtype">double</span> x = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*sx*InvNSample;
<a name="l00711"></a>00711       <span class="keywordtype">double</span> y = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*sy*InvNSample;
<a name="l00712"></a>00712       fprintf(FMid,<span class="stringliteral">&quot;%lf %lf %lf\n&quot;</span>,x,y,PlotA[sx*NSample+sy]*InvNFile);
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714   }
<a name="l00715"></a>00715   fclose(FMid);
<a name="l00716"></a>00716   free(Plot);
<a name="l00717"></a>00717   free(Count);
<a name="l00718"></a>00718   free(PlotBS);
<a name="l00719"></a>00719 }
<a name="l00720"></a><a class="code" href="classElPoly.html#a669491e5e5c66f665694c9d8908d3109">00720</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a669491e5e5c66f665694c9d8908d3109" title="Calculates the 1d, 2d spectrum  spe.">ElPoly::SpectrumMidplane</a>(<span class="keywordtype">int</span> NSample){
<a name="l00721"></a>00721   <span class="comment">// FILE *Ciccia = fopen(&quot;Ciccia.dat&quot;,&quot;w&quot;);</span>
<a name="l00722"></a>00722   <span class="comment">// for(int p=0;p&lt;pNPart();p++){</span>
<a name="l00723"></a>00723   <span class="comment">//   fprintf(Ciccia,&quot;%lf %lf\n&quot;,SQR(pPos(p,0)-.5*pEdge(0))+SQR(pPos(p,1)-.5*pEdge(1)),pPos(p,2));</span>
<a name="l00724"></a>00724   <span class="comment">// }</span>
<a name="l00725"></a>00725   <span class="comment">// fclose(Ciccia);</span>
<a name="l00726"></a>00726   <span class="comment">// return;</span>
<a name="l00727"></a>00727   <span class="keywordtype">int</span> NHalf = NSample/2;
<a name="l00728"></a>00728   <span class="keywordtype">double</span> InvNSample = 1./(double)NSample;
<a name="l00729"></a>00729   <span class="keywordtype">double</span> *Plot = (<span class="keywordtype">double</span> *) calloc(NSample*NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00730"></a>00730   <span class="keywordtype">double</span> *Count = (<span class="keywordtype">double</span> *) calloc(NSample*NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00731"></a>00731   <span class="keywordtype">double</span> *PlotA = (<span class="keywordtype">double</span> *) calloc(NSample*NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00732"></a>00732   <span class="keywordtype">int</span> NPoint = (int)(NSample*sqrt(2.));
<a name="l00733"></a>00733   <span class="keywordtype">double</span> *Density = (<span class="keywordtype">double</span> *) calloc(NPoint,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00734"></a>00734 <span class="preprocessor">#ifdef  USE_FFTW</span>
<a name="l00735"></a>00735 <span class="preprocessor"></span>  fftw_complex *out = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00736"></a>00736   fftw_complex *in = (fftw_complex *)fftw_malloc(SQR(NSample)*<span class="keyword">sizeof</span>(fftw_complex));
<a name="l00737"></a>00737   fftw_plan plan1 = fftw_plan_dft_2d(NSample,NSample,
<a name="l00738"></a>00738                  in, out,FFTW_FORWARD,FFTW_PATIENT);
<a name="l00739"></a>00739   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l00740"></a>00740     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00741"></a>00741     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00742"></a>00742       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00743"></a>00743       Plot[sx*NSample+sy] = 0.;
<a name="l00744"></a>00744       Count[sx*NSample+sy] = 0.;
<a name="l00745"></a>00745       }
<a name="l00746"></a>00746     }
<a name="l00747"></a>00747     FILE *Ciccia = fopen(cFile[f],<span class="stringliteral">&quot;r&quot;</span>);
<a name="l00748"></a>00748     <span class="keywordtype">char</span> cLine[256];
<a name="l00749"></a>00749     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;!(fgets(cLine,STRSIZE,Ciccia)==NULL);p++){
<a name="l00750"></a>00750       <span class="keywordtype">double</span> x = 0., y = 0., z = 0.;
<a name="l00751"></a>00751       sscanf(cLine,<span class="stringliteral">&quot;%lf %lf %lf\n&quot;</span>,&amp;x,&amp;y,&amp;z);
<a name="l00752"></a>00752       <span class="keywordtype">int</span> v  = (int)(x*NSample*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>));<span class="comment">//(pEdge(0)+.4));</span>
<a name="l00753"></a>00753       <span class="keywordtype">int</span> vv = (int)(y*NSample*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>));<span class="comment">//(pEdge(1)+.4));</span>
<a name="l00754"></a>00754       <span class="keywordflow">if</span>(v  &lt; 0 || v  &gt;= NSample) <span class="keywordflow">continue</span>;
<a name="l00755"></a>00755       <span class="keywordflow">if</span>(vv &lt; 0 || vv &gt;= NSample) <span class="keywordflow">continue</span>;
<a name="l00756"></a>00756       Plot[v*NSample+vv] += z;
<a name="l00757"></a>00757       Count[v*NSample+vv] += 1.;
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0;s&lt;NSample;s++){
<a name="l00760"></a>00760       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ss=0;ss&lt;NSample;ss++){
<a name="l00761"></a>00761    Plot[s*NSample+ss] /= Count[s*NSample+ss] &gt; 0. ? Count[s*NSample+ss] : 1.;
<a name="l00762"></a>00762       }
<a name="l00763"></a>00763     }    
<a name="l00764"></a>00764     fclose(Ciccia);
<a name="l00765"></a>00765     <span class="keywordflow">if</span>(1==0){
<a name="l00766"></a>00766       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00767"></a>00767    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00768"></a>00768      in[sx*NSample+sy][0] = Plot[sx*NSample+sy];
<a name="l00769"></a>00769      in[sx*NSample+sy][1] = 0.;
<a name="l00770"></a>00770    }
<a name="l00771"></a>00771       }
<a name="l00772"></a>00772       fftw_execute(plan1);
<a name="l00773"></a>00773       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;NSample;sx++){
<a name="l00774"></a>00774    <span class="keywordtype">int</span> sx1 = sx + NHalf;
<a name="l00775"></a>00775    <span class="keywordflow">if</span>(sx1 &gt;= NSample) sx1 -= NSample;
<a name="l00776"></a>00776    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;NSample;sy++){
<a name="l00777"></a>00777      <span class="keywordtype">int</span> sy1 = sy + NHalf;
<a name="l00778"></a>00778      <span class="keywordflow">if</span>(sy1 &gt;= NSample) sy1 -= NSample;
<a name="l00779"></a>00779      PlotA[sx*NSample+sy] += (SQR(out[sx*NSample+sy][0])+SQR(out[sx*NSample+sy][1]))*SQR(InvNSample);
<a name="l00780"></a>00780      <span class="comment">//PlotA[sx*NSample+sy] += Plot[sx][sy];</span>
<a name="l00781"></a>00781    }
<a name="l00782"></a>00782       }
<a name="l00783"></a>00783     }    
<a name="l00784"></a>00784     <span class="keywordflow">else</span> {
<a name="l00785"></a>00785       <span class="keywordtype">int</span> NMax = NSample;
<a name="l00786"></a>00786       <span class="keywordtype">double</span> *st = Plot;
<a name="l00787"></a>00787       <span class="keywordtype">double</span> *sw = PlotA;
<a name="l00788"></a>00788       <span class="keywordtype">double</span> dNMax = 1./(double)NMax;
<a name="l00789"></a>00789       <span class="keywordtype">int</span> NHalf = (int)(NMax/2.);
<a name="l00790"></a>00790       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> kx=-NHalf;kx&lt;NHalf;kx++){
<a name="l00791"></a>00791    <span class="keywordtype">double</span> qx = kx*dNMax;
<a name="l00792"></a>00792    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ky=-NHalf;ky&lt;NHalf;ky++){
<a name="l00793"></a>00793      <span class="keywordtype">double</span> qy = ky*dNMax;
<a name="l00794"></a>00794      <span class="keywordtype">double</span> Re2=0.,Im2=0.;
<a name="l00795"></a>00795      <span class="keywordtype">double</span> Re1=0.,Im1=0.;
<a name="l00796"></a>00796      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lx=0;lx&lt;NMax;lx++){
<a name="l00797"></a>00797        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ly=0;ly&lt;NMax;ly++){
<a name="l00798"></a>00798          <span class="keywordtype">double</span> Arg = 2.*M_PI*(lx*qx + ly*qy);
<a name="l00799"></a>00799          <span class="keywordtype">double</span> cy = cos(Arg);
<a name="l00800"></a>00800          <span class="keywordtype">double</span> sy = sin(Arg);
<a name="l00801"></a>00801          Re1 += st[lx*NMax+ly]*cy;
<a name="l00802"></a>00802          Im1 += st[lx*NMax+ly]*sy;
<a name="l00803"></a>00803        }
<a name="l00804"></a>00804      }
<a name="l00805"></a>00805      <span class="keywordtype">int</span> kkx = kx + NMax/2;
<a name="l00806"></a>00806      <span class="keywordtype">int</span> kky = ky + NMax/2;
<a name="l00807"></a>00807      sw[kkx*NMax+kky] += SQR(Re1*dNMax) + SQR(Im1*dNMax);
<a name="l00808"></a>00808    }
<a name="l00809"></a>00809       }
<a name="l00810"></a>00810     }
<a name="l00811"></a>00811   }
<a name="l00812"></a>00812 <span class="preprocessor">#endif // USE_FFTW</span>
<a name="l00813"></a>00813 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00814"></a>00814 <span class="preprocessor">#ifdef OMPI_MPI_H</span>
<a name="l00815"></a>00815 <span class="preprocessor"></span>  MPI_Allreduce(MPI_IN_PLACE,PlotA,NSample*NSample, MPI_DOUBLE, MPI_SUM, Proc-&gt;CommGrid);
<a name="l00816"></a>00816   <span class="keywordtype">int</span> Rank=0;
<a name="l00817"></a>00817   MPI_Comm_rank(Proc-&gt;CommGrid, &amp;Rank);
<a name="l00818"></a>00818   <span class="keywordflow">if</span>(Rank==0){
<a name="l00819"></a>00819 <span class="preprocessor">#endif</span>
<a name="l00820"></a>00820 <span class="preprocessor"></span>    <span class="keywordtype">char</span> *NomeFile = (<span class="keywordtype">char</span>*)calloc(60,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00821"></a>00821     sprintf(NomeFile,<span class="stringliteral">&quot;SpectrumChi%.0fKappa%.0fRho%.0f.xvl&quot;</span>,<a class="code" href="classVarData.html#a8def89edf23019d700fdbadb476e4c0a" title="Incompatibility.">pchiN</a>(),<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>(),<a class="code" href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9" title="Density coexistence.">prho</a>());
<a name="l00822"></a>00822     FILE *FileToWrite = fopen(NomeFile,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00823"></a>00823     <span class="comment">// fprintf(FileToWrite,&quot;#l(%lf %lf %lf) v[%d] d[squaremesh]\n&quot;,pEdge(CLat1),pEdge(CLat2),pEdge(CNorm),NSample);</span>
<a name="l00824"></a>00824     <span class="keywordtype">double</span> DivInv = 1./(double)(NFile[1]-NFile[0]);
<a name="l00825"></a>00825     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0;s&lt;NSample;s++){
<a name="l00826"></a>00826       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ss=0;ss&lt;NSample;ss++){
<a name="l00827"></a>00827    fprintf(FileToWrite,<span class="stringliteral">&quot;%lf %lf %lf\n&quot;</span>,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*s*InvNSample,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*ss*InvNSample,PlotA[s*NSample+ss]*DivInv);
<a name="l00828"></a>00828    <span class="comment">// fprintf(FileToWrite,&quot;{x(%lf %lf %lf) v(%lf %lf %lf)}\n&quot;,pEdge(CLat1)*s*InvNSample,pEdge(CLat2)*ss*InvNSample,PlotA[s*NSample+ss]*DivInv,0.,0.,log10(PlotA[s*NSample+ss]*DivInv));</span>
<a name="l00829"></a>00829       }
<a name="l00830"></a>00830     }
<a name="l00831"></a>00831     fclose(FileToWrite);
<a name="l00832"></a>00832     sprintf(NomeFile,<span class="stringliteral">&quot;SpectrumChi%.0fKappa%.0fRho%.0f.dat&quot;</span>,<a class="code" href="classVarData.html#a8def89edf23019d700fdbadb476e4c0a" title="Incompatibility.">pchiN</a>(),<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>(),<a class="code" href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9" title="Density coexistence.">prho</a>());
<a name="l00833"></a>00833     FileToWrite = fopen(NomeFile,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00834"></a>00834     <span class="keywordtype">double</span> qHalf = QUAD(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*(NHalf)*InvNSample)+QUAD(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*(NHalf)*InvNSample);
<a name="l00835"></a>00835     <span class="keywordtype">double</span> dx = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*InvNSample;
<a name="l00836"></a>00836     <span class="keywordtype">double</span> dy = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*InvNSample;
<a name="l00837"></a>00837     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> kx=0;kx&lt;NSample;kx++){
<a name="l00838"></a>00838       <span class="keywordtype">int</span> kx1 = kx - NSample/2;
<a name="l00839"></a>00839       <span class="keywordtype">double</span> qx = kx*InvNSample;
<a name="l00840"></a>00840       <span class="keywordtype">double</span> qxt = kx1*InvNSample;
<a name="l00841"></a>00841       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ky=0;ky&lt;NSample;ky++){
<a name="l00842"></a>00842    <span class="keywordtype">int</span> ky1 = ky - NSample/2;
<a name="l00843"></a>00843    <span class="keywordtype">double</span> qy = ky*InvNSample;
<a name="l00844"></a>00844    <span class="keywordtype">double</span> qyt = ky1*InvNSample;
<a name="l00845"></a>00845    <span class="keywordtype">double</span> qq = SQR(qx/dx - .5/dx) + SQR(qy/dy - .5/dy);
<a name="l00846"></a>00846    <span class="comment">//double qq = SQR(qx) + SQR(qy);</span>
<a name="l00847"></a>00847    fprintf(FileToWrite,<span class="stringliteral">&quot;%lf %g\n&quot;</span>,qq,PlotA[kx*NSample+ky]*DivInv);
<a name="l00848"></a>00848    <span class="comment">//fprintf(FileToWrite,&quot;%lf %g\n&quot;,QUAD(pEdge(CLat1)*(s-NHalf)*InvSample)+QUAD(pEdge(CLat2)*(ss-NHalf)*InvSample),PlotA[s*NSample+ss]*DivInv);</span>
<a name="l00849"></a>00849       }
<a name="l00850"></a>00850     }
<a name="l00851"></a>00851     <span class="comment">// for(int p=1;p&lt;NPoint;p++)</span>
<a name="l00852"></a>00852     <span class="comment">//   fprintf(FileToWrite,&quot;%d %lf\n&quot;,p,Density[p]*DivInv);</span>
<a name="l00853"></a>00853     fclose(FileToWrite);
<a name="l00854"></a>00854     free(NomeFile);
<a name="l00855"></a>00855 <span class="preprocessor">#ifdef OMPI_MPI_H</span>
<a name="l00856"></a>00856 <span class="preprocessor"></span>  }
<a name="l00857"></a>00857 <span class="preprocessor">#endif</span>
<a name="l00858"></a>00858 <span class="preprocessor"></span>  free(Density);
<a name="l00859"></a>00859   free(PlotA);
<a name="l00860"></a>00860   free(Plot);
<a name="l00861"></a>00861 }
<a name="l00862"></a><a class="code" href="classElPoly.html#a2eab2da94941b822d51d4e21bfe64aef">00862</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a2eab2da94941b822d51d4e21bfe64aef" title="Read the header and average the information.">ElPoly::HeaderAverage</a>(<span class="keywordtype">int</span> nNano){
<a name="l00863"></a>00863   <span class="keywordflow">if</span>(nNano &gt;= <a class="code" href="classVarData.html#aef94681f570cacf1a76aac1512563f17" title="Number of nanoparticles.">pNNano</a>()){
<a name="l00864"></a>00864     printf(<span class="stringliteral">&quot;The specified nanoparticle doesn&#39;t exist\n&quot;</span>);
<a name="l00865"></a>00865     nNano = 0;
<a name="l00866"></a>00866     <span class="comment">// return;</span>
<a name="l00867"></a>00867   }
<a name="l00868"></a>00868   <span class="keywordtype">int</span> NDim = 2;
<a name="l00869"></a>00869   <span class="keywordtype">int</span> NumFile = <a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1]-<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];
<a name="l00870"></a>00870   <span class="keywordtype">double</span> *Area = (<span class="keywordtype">double</span> *)calloc(NumFile,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00871"></a>00871   <span class="keywordtype">double</span> *NanoPos = (<span class="keywordtype">double</span> *)calloc(6*NumFile,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00872"></a>00872   <span class="keywordtype">double</span> *NanoDiff = (<span class="keywordtype">double</span> *)calloc(2*NumFile,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00873"></a>00873   <span class="keywordtype">double</span> *NanoCount = (<span class="keywordtype">double</span> *)calloc(NumFile,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00874"></a>00874   <span class="keywordtype">double</span> *NanoDist = (<span class="keywordtype">double</span> *)calloc(2*NumFile,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00875"></a>00875   <span class="keywordtype">double</span> *Time = (<span class="keywordtype">double</span> *)calloc(NumFile,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00876"></a>00876   <span class="keywordtype">double</span> NanoInit[3] = {<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[0],<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[1],<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[2]};
<a name="l00877"></a>00877   <span class="keywordtype">double</span> AreaAv = 0.;
<a name="l00878"></a>00878   <span class="keywordtype">double</span> AreaErr = 0.;
<a name="l00879"></a>00879   <span class="keywordtype">double</span> InitTime = <a class="code" href="classVarData.html#ad5bf6099846e677cae330617688069c8" title="Total time.">pTime</a>();
<a name="l00880"></a>00880   <span class="comment">//indentation</span>
<a name="l00881"></a>00881   <span class="keywordtype">double</span> InitPos = <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(0,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>) - <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(1,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>) - MAX(<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[0].Rad,<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[0].Height);
<a name="l00882"></a>00882   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=NFile[0];f&lt;NFile[1];f++){
<a name="l00883"></a>00883     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l00884"></a>00884     FILE *File2Read;
<a name="l00885"></a>00885     <span class="keywordflow">if</span>((File2Read = fopen(cFile[f],<span class="stringliteral">&quot;r&quot;</span>))==0){
<a name="l00886"></a>00886       printf(<span class="stringliteral">&quot;The file is missing\n&quot;</span>);
<a name="l00887"></a>00887       return ;
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889     <a class="code" href="classVarData.html#a736de4373227d565d6f180ab22d2d0b6" title="Reads a header.">ReadHeader</a>(File2Read);
<a name="l00890"></a>00890     fclose(File2Read);
<a name="l00891"></a>00891     AreaAv  += <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00892"></a>00892     AreaErr += SQR(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>));
<a name="l00893"></a>00893     Area[f] = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l00894"></a>00894     Time[f] = <a class="code" href="classVarData.html#ad5bf6099846e677cae330617688069c8" title="Total time.">pTime</a>() - InitTime;
<a name="l00895"></a>00895     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++) NanoPos[f*6+d] = <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[nNano].Pos[d];
<a name="l00896"></a>00896     NanoPos[f*6+3] = <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[nNano].<a class="code" href="structNANO.html#a860bef50013f57ab1a6437b7986a9487" title="Size.">Rad</a>;
<a name="l00897"></a>00897     NanoPos[f*6+4] = <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[nNano].<a class="code" href="structNANO.html#a18ece2127f70c26ead73bc24856a5c57" title="Height of the cylinder.">Height</a>;
<a name="l00898"></a>00898     NanoPos[f*6+5] = <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[nNano].<a class="code" href="structNANO.html#acedb30173c5224396eb7a95709f5c619" title="Area of a pore or a stalk.">Area</a>;
<a name="l00899"></a>00899     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ff=f;ff&gt;=0;ff--){
<a name="l00900"></a>00900       <span class="keywordtype">int</span> fff = f-ff;
<a name="l00901"></a>00901       NanoDiff[fff*2] += SQR(NanoPos[f*6+0]-NanoPos[ff*6+0]) + SQR(NanoPos[f*6+1]-NanoPos[ff*6+1]);
<a name="l00902"></a>00902       NanoCount[fff] += 1.;
<a name="l00903"></a>00903     }
<a name="l00904"></a>00904     NanoDiff[f*2+1] = SQR(NanoPos[f*6+0]-NanoInit[0]) + SQR(NanoPos[f*6+1]-NanoInit[1]);
<a name="l00905"></a>00905     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#aef94681f570cacf1a76aac1512563f17" title="Number of nanoparticles.">pNNano</a>() &gt; 1){
<a name="l00906"></a>00906       <span class="comment">//indentation</span>
<a name="l00907"></a>00907       NanoDist[f*2] = InitPos - <a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(0,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>) + <a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(1,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>) + MAX(<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[nNano].Rad,<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[nNano].Height);
<a name="l00908"></a>00908       <span class="keywordtype">double</span> Dist = 0.;
<a name="l00909"></a>00909       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00910"></a>00910    <span class="keywordtype">double</span> Pos1 = <a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(0,d) - floor(<a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(0,d)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d);
<a name="l00911"></a>00911    Dist += SQR(<a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(0,d)-<a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(1,d));
<a name="l00912"></a>00912       }
<a name="l00913"></a>00913       Dist = sqrt(Dist);
<a name="l00914"></a>00914       <span class="comment">//two np dist</span>
<a name="l00915"></a>00915       NanoDist[f*2+1] = Dist;
<a name="l00916"></a>00916     }
<a name="l00917"></a>00917   }
<a name="l00918"></a>00918   AreaAv /= (double)(NFile[1] - NFile[0]);
<a name="l00919"></a>00919   AreaErr = sqrt( AreaErr - (NFile[1] - NFile[0])*SQR(AreaAv))/(double)(NFile[1] - NFile[0]);
<a name="l00920"></a>00920   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00921"></a>00921   printf(<span class="stringliteral">&quot;Area %lf \\pm %lf\n&quot;</span>,AreaAv,AreaErr);
<a name="l00922"></a>00922   FILE *File2Write = fopen(<span class="stringliteral">&quot;AreaTime.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00923"></a>00923   fprintf(File2Write,<span class="stringliteral">&quot;# Time Area %lf pm %lf\n&quot;</span>,AreaAv,AreaErr);
<a name="l00924"></a>00924   <span class="keywordtype">char</span> FName[120];
<a name="l00925"></a>00925   sprintf(FName,<span class="stringliteral">&quot;NanoDiffR%.1fS%.1fH%.1f.dat&quot;</span>,<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[nNano].Rad,<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[nNano].Hamaker,<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[nNano].Height);
<a name="l00926"></a>00926   FILE *FNano = fopen(FName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00927"></a>00927   fprintf(FNano,<span class="stringliteral">&quot;# t &lt;msd&gt; msd Dz NpDist rad hei\n&quot;</span>);
<a name="l00928"></a>00928   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=0;f&lt;NumFile;f++){
<a name="l00929"></a>00929     NanoDiff[f*2] /= NanoCount[f] &gt; 0. ? NanoCount[f] : 1.;
<a name="l00930"></a>00930     fprintf(File2Write,<span class="stringliteral">&quot;%lf %lf\n&quot;</span>,Time[f],Area[f]);
<a name="l00931"></a>00931     fprintf(FNano,<span class="stringliteral">&quot;%lf %lf %lf %lf %lf %lf %lf\n&quot;</span>,Time[f],NanoDiff[f*2  ],NanoDiff[f*2+1],NanoDist[f*2],NanoDist[f*2+1],NanoPos[f*6+3],NanoPos[f*6+4]);
<a name="l00932"></a>00932   }
<a name="l00933"></a>00933   fclose(File2Write);
<a name="l00934"></a>00934   fclose(FNano);
<a name="l00935"></a>00935   free(NanoDiff);
<a name="l00936"></a>00936   free(NanoDist);
<a name="l00937"></a>00937   free(Area);
<a name="l00938"></a>00938   free(Time);
<a name="l00939"></a>00939 }
<a name="l00940"></a>00940 <span class="comment">//only one block</span>
<a name="l00941"></a><a class="code" href="classElPoly.html#aa7a92147aff6a466398908e0f92ca139">00941</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#ab6f6a1fc647dcd4684fcaa667d612099" title="Create NCh systems with a chain less.">ElPoly::WidomOut</a>(<span class="keywordtype">char</span> *NrgFile,<span class="keywordtype">int</span> NBin){
<a name="l00942"></a>00942   <span class="keywordtype">int</span> NChains = 1;
<a name="l00943"></a>00943   <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].<a class="code" href="structBLOCK.html#aa49e4d7af0d71e79524ef6fb081707b5" title="# chains">NChain</a> -= NChains;
<a name="l00944"></a>00944   <a class="code" href="classVarData.html#a4bed1297ee4f1c6966e1f8389e3b34c8" title="Writes a &quot;system-file&quot; or a &quot;x y z&quot; file".">WriteXvt</a>(<span class="stringliteral">&quot;SnapOut.dat&quot;</span>);
<a name="l00945"></a>00945   FILE *FileLast = fopen(<span class="stringliteral">&quot;LastChain.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00946"></a>00946   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>()-(NChains)*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00947"></a>00947     fprintf(FileLast,<span class="stringliteral">&quot;%lf %lf %lf %lf %lf %lf %d\n&quot;</span>,<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,0),<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,1),<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,2),<a class="code" href="classVarData.html#af437e6050bc54d9934ce8e41d4e14af0" title="Return the velocity.">pVel</a>(p,0),<a class="code" href="classVarData.html#af437e6050bc54d9934ce8e41d4e14af0" title="Return the velocity.">pVel</a>(p,1),<a class="code" href="classVarData.html#af437e6050bc54d9934ce8e41d4e14af0" title="Return the velocity.">pVel</a>(p,2),<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c" title="Return the type.">pType</a>(p));
<a name="l00948"></a>00948   }
<a name="l00949"></a>00949   fclose(FileLast);
<a name="l00950"></a>00950 }
<a name="l00951"></a>00951 <span class="comment">//only one block</span>
<a name="l00952"></a><a class="code" href="classElPoly.html#ab6f6a1fc647dcd4684fcaa667d612099">00952</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#ab6f6a1fc647dcd4684fcaa667d612099" title="Create NCh systems with a chain less.">ElPoly::WidomOut</a>(){
<a name="l00953"></a>00953   <span class="keywordtype">int</span> NChains = 1;
<a name="l00954"></a>00954   <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].<a class="code" href="structBLOCK.html#aa49e4d7af0d71e79524ef6fb081707b5" title="# chains">NChain</a> -= NChains;
<a name="l00955"></a>00955   <span class="keywordtype">char</span> FileName[60];
<a name="l00956"></a>00956   sprintf(FileName,<span class="stringliteral">&quot;SnapOut%05d.dat&quot;</span>,<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()-1);
<a name="l00957"></a>00957   <a class="code" href="classVarData.html#a4bed1297ee4f1c6966e1f8389e3b34c8" title="Writes a &quot;system-file&quot; or a &quot;x y z&quot; file".">WriteXvt</a>(FileName);
<a name="l00958"></a>00958   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()-1;c++){
<a name="l00959"></a>00959     <a class="code" href="classVarData.html#a9b8f7a0f3ed7c785a4da59c58781d050" title="Swap two chains.">SwapChain</a>(c,<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()-1);
<a name="l00960"></a>00960     sprintf(FileName,<span class="stringliteral">&quot;SnapOut%05d.dat&quot;</span>,c);
<a name="l00961"></a>00961     <a class="code" href="classVarData.html#a4bed1297ee4f1c6966e1f8389e3b34c8" title="Writes a &quot;system-file&quot; or a &quot;x y z&quot; file".">WriteXvt</a>(FileName);
<a name="l00962"></a>00962   }
<a name="l00963"></a>00963 }
<a name="l00964"></a>00964 <span class="comment">//the system has an additional fake chain</span>
<a name="l00965"></a><a class="code" href="classElPoly.html#a2fbe8fbc91f83f0ac7a947965a3c38b8">00965</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a2fbe8fbc91f83f0ac7a947965a3c38b8" title="Create a set of files with a chain more.">ElPoly::WidomIn</a>(){
<a name="l00966"></a>00966   <span class="keywordtype">int</span> <a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a> = 1000;
<a name="l00967"></a>00967   <span class="keywordtype">char</span> FileName[60];
<a name="l00968"></a>00968   <a class="code" href="classVarData.html#a2e0b2cd0414a0994122e1dfae41e57b8" title="Set and reallocate the number of particles.">SetNPart</a>(<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>()+<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>());
<a name="l00969"></a>00969   <a class="code" href="classVarData.html#a868e00b8cdabb8ea14fcec15942725ae" title="Set and reallocate the number of chains.">SetNChain</a>(<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+1);
<a name="l00970"></a>00970   <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].<a class="code" href="structBLOCK.html#aa49e4d7af0d71e79524ef6fb081707b5" title="# chains">NChain</a> += 1;
<a name="l00971"></a>00971   <span class="keywordtype">int</span> p1 = <a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>()*(<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()-1);
<a name="l00972"></a>00972   <span class="keywordtype">double</span> Var = sqrt(SQR(<a class="code" href="classVarData.html#a71e85d43bc5bd1fcb6563c91a67576b2" title="Re/CutOff.">pReOverCutOff</a>())/(<span class="keywordtype">double</span>)(<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>()-1)/3.)/2.;
<a name="l00973"></a>00973   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=0;f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>;f++){
<a name="l00974"></a>00974     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00975"></a>00975       <a class="code" href="classVarData.html#a5b8f787336ad1a776f82be0a59c9f570" title="Set the particle position.">SetPos</a>(p1,d,<a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#a953e8be14f6a9c259f192683f3a5a970" title="Random uniform number.">Casuale</a>()*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d));
<a name="l00976"></a>00976     }
<a name="l00977"></a>00977     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=p1+1;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00978"></a>00978       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00979"></a>00979    <a class="code" href="classVarData.html#a5b8f787336ad1a776f82be0a59c9f570" title="Set the particle position.">SetPos</a>(p1,d,<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p-1,d) + <a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#ad14013038c5963ed49ca1236e681db10" title="Gaussian random number.">Gaussiano</a>(0.,Var));
<a name="l00980"></a>00980       }
<a name="l00981"></a>00981       <span class="keywordflow">if</span>( p%<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>() &gt;= <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].<a class="code" href="structBLOCK.html#af914cf19bda574d081fa0a7b243bf7dc" title="Diblock limit of the chain.">Asym</a> )
<a name="l00982"></a>00982    <a class="code" href="classVarData.html#a54f680d04a52452baf2d8e9852c425cd" title="Set the particle type.">SetType</a>(p,1);
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984     sprintf(FileName,<span class="stringliteral">&quot;SnapIn%05d.dat&quot;</span>,f);
<a name="l00985"></a>00985     <a class="code" href="classVarData.html#a054aab836dcf7735720ef32e0b8f7ecb" title="Writes a &quot;system-file&quot; or a &quot;x y z&quot; file".">Write</a>(FileName);
<a name="l00986"></a>00986   }
<a name="l00987"></a>00987 }
<a name="l00988"></a>00988 <span class="comment">//the system has an additional fake chain</span>
<a name="l00989"></a><a class="code" href="classElPoly.html#a3e5c7ada1f6d5a2d37b23a9fb12771f9">00989</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a2fbe8fbc91f83f0ac7a947965a3c38b8" title="Create a set of files with a chain more.">ElPoly::WidomIn</a>(<span class="keywordtype">char</span> *NrgFile,<span class="keywordtype">int</span> NBin){
<a name="l00990"></a>00990   <span class="keywordtype">int</span> NChains = 1;
<a name="l00991"></a>00991   <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].<a class="code" href="structBLOCK.html#aa49e4d7af0d71e79524ef6fb081707b5" title="# chains">NChain</a> += NChains;
<a name="l00992"></a>00992   <a class="code" href="classVarData.html#a4bed1297ee4f1c6966e1f8389e3b34c8" title="Writes a &quot;system-file&quot; or a &quot;x y z&quot; file".">WriteXvt</a>(<span class="stringliteral">&quot;SnapIn.dat&quot;</span>);
<a name="l00993"></a>00993   <span class="keywordtype">int</span> NAddPart = NChains*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();
<a name="l00994"></a>00994   FILE *FileLast = fopen(<span class="stringliteral">&quot;SnapIn.dat&quot;</span>,<span class="stringliteral">&quot;a&quot;</span>);
<a name="l00995"></a>00995   <a class="code" href="structPART.html" title="Information of every particle.">PART</a> *Pn = (<a class="code" href="structPART.html" title="Information of every particle.">PART</a> *)calloc(NAddPart,<span class="keyword">sizeof</span>(<a class="code" href="structPART.html" title="Information of every particle.">PART</a>));
<a name="l00996"></a>00996   <span class="keywordtype">double</span> GaussVar = sqrt(SQR(<a class="code" href="classVarData.html#a71e85d43bc5bd1fcb6563c91a67576b2" title="Re/CutOff.">pReOverCutOff</a>())/(<span class="keywordtype">double</span>)(<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>()-1)/3.)*2./3.;
<a name="l00997"></a>00997   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;NChains;c++){
<a name="l00998"></a>00998     <span class="keywordtype">int</span> p1 = c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();
<a name="l00999"></a>00999     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l01000"></a>01000       <a class="code" href="classVarData.html#a5b8f787336ad1a776f82be0a59c9f570" title="Set the particle position.">SetPos</a>(p1,d,<a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#a953e8be14f6a9c259f192683f3a5a970" title="Random uniform number.">Casuale</a>()*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d));
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=1;p&lt;<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();p++){
<a name="l01003"></a>01003       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l01004"></a>01004    Pn[p+p1].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d] = Pn[p-1+p1].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d] + <a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#ad14013038c5963ed49ca1236e681db10" title="Gaussian random number.">Gaussiano</a>(0,GaussVar);
<a name="l01005"></a>01005       }
<a name="l01006"></a>01006       Pn[p+p1].<a class="code" href="structPART.html#a6365019ac3c6ee60c2db6a3674f35614" title="Type.">Typ</a> = 0;
<a name="l01007"></a>01007       <span class="keywordflow">if</span>(p &gt;= <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].Asym){
<a name="l01008"></a>01008    Pn[p+p1].<a class="code" href="structPART.html#a6365019ac3c6ee60c2db6a3674f35614" title="Type.">Typ</a> = 1;
<a name="l01009"></a>01009       }
<a name="l01010"></a>01010     }
<a name="l01011"></a>01011   }
<a name="l01012"></a>01012   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;NAddPart;p++){
<a name="l01013"></a>01013     fprintf(FileLast,<span class="stringliteral">&quot;%lf %lf %lf %lf %lf %lf %d\n&quot;</span>,Pn[p].Pos[0],Pn[p].Pos[1],Pn[p].Pos[2],Pn[p].Vel[0],Pn[p].Vel[1],Pn[p].Vel[2],Pn[p].Typ);
<a name="l01014"></a>01014   }
<a name="l01015"></a>01015   free(Pn);
<a name="l01016"></a>01016   fclose(FileLast);
<a name="l01017"></a>01017 }
<a name="l01018"></a><a class="code" href="classElPoly.html#a15ee2b235143aabc133fe974aa3258a2">01018</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a15ee2b235143aabc133fe974aa3258a2" title="Write the end to end distance of the chains.">ElPoly::End2EndDistr</a>(<span class="keywordtype">char</span> *OutFile){
<a name="l01019"></a>01019   <span class="keywordtype">char</span> FileName[256];
<a name="l01020"></a>01020   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l01021"></a>01021     sprintf(FileName,<span class="stringliteral">&quot;%s%04d.dat&quot;</span>,OutFile,f);
<a name="l01022"></a>01022     FILE *File2Write = fopen(FileName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01023"></a>01023     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l01024"></a>01024     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_NO))<span class="keywordflow">return</span>;
<a name="l01025"></a>01025     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++){
<a name="l01026"></a>01026       <span class="keywordtype">int</span> p1 = c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();
<a name="l01027"></a>01027       <span class="keywordtype">int</span> p2 = c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>() + <a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>() - 1;
<a name="l01028"></a>01028       <span class="keywordtype">double</span> End2End = 0.;
<a name="l01029"></a>01029       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l01030"></a>01030    End2End += SQR(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p1,d) - <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p2,d));
<a name="l01031"></a>01031       }
<a name="l01032"></a>01032       fprintf(File2Write,<span class="stringliteral">&quot;%lf &quot;</span>,End2End);
<a name="l01033"></a>01033       fprintf(File2Write,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01034"></a>01034     }
<a name="l01035"></a>01035     fclose(File2Write);
<a name="l01036"></a>01036   }
<a name="l01037"></a>01037 }
<a name="l01038"></a><a class="code" href="classElPoly.html#a44e20767e332d941b94906f1a8e60e24">01038</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a44e20767e332d941b94906f1a8e60e24" title="Decoupling of the direction/end to end distance of the chains.">ElPoly::Decoupling</a>(<span class="keywordtype">int</span> What){
<a name="l01039"></a>01039   <a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a> = <a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1] - <a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];
<a name="l01040"></a>01040   <span class="keywordtype">double</span> *Angles = (<span class="keywordtype">double</span> *)calloc((NFile[1]-NFile[0])*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>(),<span class="keyword">sizeof</span>(double));
<a name="l01041"></a>01041   <span class="keywordtype">double</span> *Count = (<span class="keywordtype">double</span> *)calloc((NFile[1]-NFile[0]),<span class="keyword">sizeof</span>(double));
<a name="l01042"></a>01042   <span class="keywordtype">double</span> *AnglesNano = (<span class="keywordtype">double</span> *)calloc((NFile[1]-NFile[0])*<a class="code" href="classVarData.html#aef94681f570cacf1a76aac1512563f17" title="Number of nanoparticles.">pNNano</a>(),<span class="keyword">sizeof</span>(double));
<a name="l01043"></a>01043   <span class="keywordtype">double</span> *Time = (<span class="keywordtype">double</span> *)calloc((NFile[1]-NFile[0]),<span class="keyword">sizeof</span>(double));
<a name="l01044"></a>01044   <span class="keywordtype">double</span> *AngleDiff = (<span class="keywordtype">double</span> *)calloc(<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>(),<span class="keyword">sizeof</span>(double));
<a name="l01045"></a>01045   <span class="keywordtype">double</span> *AngleDiff2 = (<span class="keywordtype">double</span> *)calloc(<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>(),<span class="keyword">sizeof</span>(double));
<a name="l01046"></a>01046   <a class="code" href="classVettore.html" title="Geometrical operations on vectors.">Vettore</a> Ax0(1.,0.,0.);
<a name="l01047"></a>01047   <a class="code" href="classVettore.html" title="Geometrical operations on vectors.">Vettore</a> Ax2(0.,0.,1.);
<a name="l01048"></a>01048   <span class="keywordtype">double</span> InvPhob = <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].<a class="code" href="structBLOCK.html#af914cf19bda574d081fa0a7b243bf7dc" title="Diblock limit of the chain.">Asym</a> &gt; 0 ? 1./(double)<a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].Asym : 1.;
<a name="l01049"></a>01049   <span class="keywordtype">double</span> InvPhil = <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].<a class="code" href="structBLOCK.html#af914cf19bda574d081fa0a7b243bf7dc" title="Diblock limit of the chain.">Asym</a> &gt; 0 ? 1./(double)(<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>() - <a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[0].<a class="code" href="structBLOCK.html#af914cf19bda574d081fa0a7b243bf7dc" title="Diblock limit of the chain.">Asym</a>) : 1.;
<a name="l01050"></a>01050   <span class="keywordtype">double</span> DistRel[4];
<a name="l01051"></a>01051   <a class="code" href="classVettore.html" title="Geometrical operations on vectors.">Vettore</a> ChDir(0.,0.,0.);
<a name="l01052"></a>01052   <a class="code" href="classVettore.html" title="Geometrical operations on vectors.">Vettore</a> NanoAx(0.,0.,0.);
<a name="l01053"></a>01053   <span class="keywordtype">double</span> Average = 0.;
<a name="l01054"></a>01054   <span class="keywordtype">double</span> Variance = 0.;
<a name="l01055"></a>01055   <span class="keywordtype">double</span> InitTime = <a class="code" href="classVarData.html#ad5bf6099846e677cae330617688069c8" title="Total time.">pTime</a>();
<a name="l01056"></a>01056   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=NFile[0];f&lt;NFile[1];f++){
<a name="l01057"></a>01057     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l01058"></a>01058     <span class="keywordtype">int</span> ff = f - NFile[0];
<a name="l01059"></a>01059     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_CHAIN))return ;
<a name="l01060"></a>01060     Time[f] = <a class="code" href="classVarData.html#ad5bf6099846e677cae330617688069c8" title="Total time.">pTime</a>() - InitTime;
<a name="l01061"></a>01061     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;n&lt;<a class="code" href="classVarData.html#aef94681f570cacf1a76aac1512563f17" title="Number of nanoparticles.">pNNano</a>();n++){
<a name="l01062"></a>01062       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l01063"></a>01063    NanoAx.<a class="code" href="classVettore.html#af865716b201375aaca7c880377aa2426" title="Set the N column.">Set</a>(<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[n].Axis[d],d);
<a name="l01064"></a>01064       }
<a name="l01065"></a>01065       NanoAx.<a class="code" href="classVettore.html#af865716b201375aaca7c880377aa2426" title="Set the N column.">Set</a>(0.,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);
<a name="l01066"></a>01066       AnglesNano[ff*<a class="code" href="classVarData.html#aef94681f570cacf1a76aac1512563f17" title="Number of nanoparticles.">pNNano</a>()+n] = Ax0.<a class="code" href="classVettore.html#a936e4b859237ce1643e932504dde2f22" title="Computes the angle between two Vetttore.">Angle</a>(&amp;NanoAx);
<a name="l01067"></a>01067     }
<a name="l01068"></a>01068     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0,b=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++){
<a name="l01069"></a>01069       <span class="keywordflow">if</span>(What == 0){
<a name="l01070"></a>01070    ChDir.<a class="code" href="classVettore.html#af865716b201375aaca7c880377aa2426" title="Set the N column.">Set</a>(<a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[c].Dir[0],0);
<a name="l01071"></a>01071    ChDir.<a class="code" href="classVettore.html#af865716b201375aaca7c880377aa2426" title="Set the N column.">Set</a>(<a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[c].Dir[1],1);
<a name="l01072"></a>01072    <span class="keywordtype">double</span> <a class="code" href="classElPoly.html#ae3aab8086f988eecdd12b8f29f45a56a" title="Calculation of the contact angle  angle Boh?">Angle</a> = Ax0.<a class="code" href="classVettore.html#a936e4b859237ce1643e932504dde2f22" title="Computes the angle between two Vetttore.">Angle</a>(&amp;ChDir);
<a name="l01073"></a>01073    <span class="keywordflow">if</span>(isnan(Angle)) Angles[ff*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c] = Angles[(ff-1)*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c];
<a name="l01074"></a>01074    <span class="keywordflow">else</span> Angles[ff*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c] = Ax0.<a class="code" href="classVettore.html#a936e4b859237ce1643e932504dde2f22" title="Computes the angle between two Vetttore.">Angle</a>(&amp;ChDir);
<a name="l01075"></a>01075       }
<a name="l01076"></a>01076       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(What == 1){
<a name="l01077"></a>01077    Angles[ff*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c] = <a class="code" href="classVarData.html#a19886baf2914ac46bc50f333254a4e57" title="Return the relative distance between two particles (wrapped)">TwoPartDist</a>(c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>(),(c+1)*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>()-1,DistRel);
<a name="l01078"></a>01078       }
<a name="l01079"></a>01079       Average += Angles[ff*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c];
<a name="l01080"></a>01080       Variance += SQR(Angles[ff*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c]);
<a name="l01081"></a>01081     }
<a name="l01082"></a>01082   }
<a name="l01083"></a>01083   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01084"></a>01084   <span class="keywordtype">double</span> NTot = (double)(<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()*(NFile[1]-NFile[0]));
<a name="l01085"></a>01085   Average /= NTot &gt; 0. ? NTot : 1.;
<a name="l01086"></a>01086   <span class="keywordtype">double</span> PreVar = Variance;
<a name="l01087"></a>01087   Variance = (Variance - SQR(Average)*NTot)/(NTot-1);
<a name="l01088"></a>01088   <span class="keywordflow">if</span>(isnan(Variance)){
<a name="l01089"></a>01089     printf(<span class="stringliteral">&quot;Variance is not a number %lf %lf %lf\n&quot;</span>,PreVar,Average,NTot);
<a name="l01090"></a>01090     Variance = 1.;
<a name="l01091"></a>01091   }
<a name="l01092"></a>01092   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=0;f&lt;<a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a>;f++){
<a name="l01093"></a>01093     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++){
<a name="l01094"></a>01094       AngleDiff2[f] += (Angles[f*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c]-Average)*(Angles[0*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c]-Average);
<a name="l01095"></a>01095     }
<a name="l01096"></a>01096     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ff = f+1; ff&lt;<a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a>;ff++){
<a name="l01097"></a>01097       <span class="keywordtype">int</span> fff = ff - f;
<a name="l01098"></a>01098       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++){
<a name="l01099"></a>01099    AngleDiff[fff]  += (Angles[ff*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c]-Average)*(Angles[f*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()+c]-Average);
<a name="l01100"></a>01100    Count[fff] += 1.;
<a name="l01101"></a>01101       }
<a name="l01102"></a>01102     }
<a name="l01103"></a>01103   }
<a name="l01104"></a>01104   <span class="keywordtype">char</span> FileName[256];
<a name="l01105"></a>01105   <span class="keywordflow">if</span>(What == 0)
<a name="l01106"></a>01106     sprintf(FileName,<span class="stringliteral">&quot;DirDecoupling.dat&quot;</span>);
<a name="l01107"></a>01107   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(What == 1)
<a name="l01108"></a>01108     sprintf(FileName,<span class="stringliteral">&quot;E2EDecoupling.dat&quot;</span>);    
<a name="l01109"></a>01109   FILE *FileToWrite = fopen(FileName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01110"></a>01110   <span class="keywordtype">char</span> cSystem[STRSIZE];
<a name="l01111"></a>01111   <a class="code" href="classVarData.html#aa415b42b89dfba2ab8189be4e86b41ad" title="Print a string with the system definitions.">SysDef</a>(cSystem);
<a name="l01112"></a>01112   <span class="comment">//  fprintf(FileToWrite,&quot;%s&quot;,cSystem);</span>
<a name="l01113"></a>01113   fprintf(FileToWrite,<span class="stringliteral">&quot;#Time AngleProd\n&quot;</span>);
<a name="l01114"></a>01114   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=1;f&lt;<a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a>;f++){
<a name="l01115"></a>01115     <span class="keywordtype">double</span> Inv = Count[f] &gt; 0. ? Count[f] : 1.;
<a name="l01116"></a>01116     fprintf(FileToWrite,<span class="stringliteral">&quot;%lf %lf %lf\n&quot;</span>,Time[f],AngleDiff[f]/(Inv*Variance),AngleDiff2[f]/(Variance*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>()) );
<a name="l01117"></a>01117   }
<a name="l01118"></a>01118   fclose(FileToWrite);
<a name="l01119"></a>01119   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;n&lt;<a class="code" href="classVarData.html#aef94681f570cacf1a76aac1512563f17" title="Number of nanoparticles.">pNNano</a>();n++){
<a name="l01120"></a>01120     sprintf(FileName,<span class="stringliteral">&quot;NanoAngles%d.dat&quot;</span>,n);
<a name="l01121"></a>01121     FILE *FNanoAng = fopen(FileName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01122"></a>01122     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=0;f&lt;<a class="code" href="classElPoly.html#ad7dff49d260c06459abb507a09fa932d" title="Total number of file.">NFileTot</a>;f++)
<a name="l01123"></a>01123       fprintf(FNanoAng,<span class="stringliteral">&quot;%lf %lf \n&quot;</span>,Time[f],AnglesNano[f*<a class="code" href="classVarData.html#aef94681f570cacf1a76aac1512563f17" title="Number of nanoparticles.">pNNano</a>()+n]*360./DUE_PI);
<a name="l01124"></a>01124     fclose(FNanoAng);
<a name="l01125"></a>01125   }
<a name="l01126"></a>01126   <span class="comment">// FileToWrite = fopen(&quot;RawAngles.dat&quot;,&quot;w&quot;);</span>
<a name="l01127"></a>01127   <span class="comment">// for(int f=0;f&lt;NFileTot;f++){</span>
<a name="l01128"></a>01128   <span class="comment">//   for(int c=0;c&lt;pNChain();c++){</span>
<a name="l01129"></a>01129   <span class="comment">//     fprintf(FileToWrite,&quot;%lf\n&quot;,Angles[f*pNChain()+c]);</span>
<a name="l01130"></a>01130   <span class="comment">//   }</span>
<a name="l01131"></a>01131   <span class="comment">// }</span>
<a name="l01132"></a>01132   <span class="comment">// fclose(FileToWrite);</span>
<a name="l01133"></a>01133   free(Count);
<a name="l01134"></a>01134   free(Time);
<a name="l01135"></a>01135   free(Angles);
<a name="l01136"></a>01136   free(AngleDiff);
<a name="l01137"></a>01137   free(AngleDiff2);
<a name="l01138"></a>01138 }
<a name="l01146"></a><a class="code" href="classElPoly.html#afbe805e551084aebeee2c673c9b3937a">01146</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#afbe805e551084aebeee2c673c9b3937a" title="Calculates the number of chain per area  area.">ElPoly::AreaCompr</a>(<span class="keywordtype">int</span> NSample){
<a name="l01147"></a>01147   <span class="keywordtype">int</span> SubDiv[3] = {NSample,NSample,1};
<a name="l01148"></a>01148   <span class="keywordtype">int</span> <a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a> = (SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]);
<a name="l01149"></a>01149   <span class="comment">//mean StdDev Area*StdDev/Mean^2</span>
<a name="l01150"></a>01150   <span class="keywordtype">double</span> *ChainPArea = (<span class="keywordtype">double</span> *)calloc(3*NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01151"></a>01151   <span class="keywordtype">double</span> *Plot = (<span class="keywordtype">double</span> *)calloc(NEdge,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01152"></a>01152   <span class="keywordtype">double</span> *Area = (<span class="keywordtype">double</span> *)calloc(NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01153"></a>01153   <span class="keywordtype">double</span> *NDiv = (<span class="keywordtype">double</span> *)calloc(NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01154"></a>01154   <span class="keywordtype">char</span> FileName[256];
<a name="l01155"></a>01155   <span class="comment">//for the simulation in NPtT a smaller box is used</span>
<a name="l01156"></a>01156   <span class="keywordtype">double</span> Edge[3] = {<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(0)-1.,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(1)-1.,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(2)};
<a name="l01157"></a>01157   <span class="keywordtype">double</span> InvEdge[3] = {1./Edge[0],1./Edge[1],1./Edge[2]};
<a name="l01158"></a>01158   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l01159"></a>01159     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l01160"></a>01160     <a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_CHAIN);
<a name="l01161"></a>01161     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;NSample;t++){
<a name="l01162"></a>01162       SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>] = NSample-t;
<a name="l01163"></a>01163       SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>] = NSample-t;
<a name="l01164"></a>01164       <span class="keywordflow">if</span>(t == NSample -1) SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>] = 2;
<a name="l01165"></a>01165       NDiv[t] = SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>];
<a name="l01166"></a>01166       Area[t] = Edge[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*Edge[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]/(SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]);
<a name="l01167"></a>01167       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;n&lt;<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>;n++) Plot[n] = 0.;
<a name="l01168"></a>01168       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++){
<a name="l01169"></a>01169    <span class="keywordtype">double</span> Posx = <a class="code" href="classVarData.html#a65d27f4def5d4f78e90663334bd50e1e" title="Return back folded position.">pChPos</a>(c,<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>) - floor(<a class="code" href="classVarData.html#a65d27f4def5d4f78e90663334bd50e1e" title="Return back folded position.">pChPos</a>(c,<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>);
<a name="l01170"></a>01170    <span class="keywordtype">double</span> Posy = <a class="code" href="classVarData.html#a65d27f4def5d4f78e90663334bd50e1e" title="Return back folded position.">pChPos</a>(c,<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>) - floor(<a class="code" href="classVarData.html#a65d27f4def5d4f78e90663334bd50e1e" title="Return back folded position.">pChPos</a>(c,<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>);
<a name="l01171"></a>01171    <span class="keywordtype">int</span> vx = (int)(Posx*InvEdge[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]);
<a name="l01172"></a>01172    <span class="keywordtype">int</span> vy = (int)(Posy*InvEdge[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]*SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]);
<a name="l01173"></a>01173    <span class="keywordflow">if</span>(vx &lt; 0 || vx &gt;= SubDiv[CLat1]) <span class="keywordflow">continue</span>;
<a name="l01174"></a>01174    <span class="keywordflow">if</span>(vy &lt; 0 || vy &gt;= SubDiv[CLat2]) <span class="keywordflow">continue</span>;
<a name="l01175"></a>01175    Plot[vx*NSample+vy] += 1.;
<a name="l01176"></a>01176       }
<a name="l01177"></a>01177       <span class="keywordtype">double</span> SumX = 0.;
<a name="l01178"></a>01178       <span class="keywordtype">double</span> SumX2 = 0.;
<a name="l01179"></a>01179       <span class="keywordtype">double</span> Count = 0.;
<a name="l01180"></a>01180       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx = 0;sx&lt;SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>];sx++){
<a name="l01181"></a>01181    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy = 0;sy&lt;SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>];sy++){
<a name="l01182"></a>01182      <span class="keywordtype">int</span> n = sx*NSample+sy;
<a name="l01183"></a>01183      Plot[n] /= Area[t];
<a name="l01184"></a>01184      SumX += Plot[n];
<a name="l01185"></a>01185      Count += 1.;
<a name="l01186"></a>01186    }
<a name="l01187"></a>01187       }
<a name="l01188"></a>01188       <span class="keywordtype">double</span> NInv = Count &gt; 0. ? 1./Count : 1.;
<a name="l01189"></a>01189       <span class="keywordtype">double</span> MeanVal = SumX*NInv;
<a name="l01190"></a>01190       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx = 0;sx &lt; SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>];sx++){
<a name="l01191"></a>01191    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy = 0;sy &lt; SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>];sy++){
<a name="l01192"></a>01192      <span class="keywordtype">int</span> n = sx*NSample+sy;
<a name="l01193"></a>01193      SumX2 += SQR(Plot[n] - MeanVal);
<a name="l01194"></a>01194    }
<a name="l01195"></a>01195       }
<a name="l01196"></a>01196       ChainPArea[3*t  ] += MeanVal;
<a name="l01197"></a>01197       ChainPArea[3*t+1] += SumX2/(Count - 1.);
<a name="l01198"></a>01198       ChainPArea[3*t+2] += 1.;
<a name="l01199"></a>01199       <span class="keywordflow">if</span>(1==0){<span class="comment">//writes the single distribution files</span>
<a name="l01200"></a>01200    sprintf(FileName,<span class="stringliteral">&quot;Distr%.0fKappa%02d.dat&quot;</span>,<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>(),t);
<a name="l01201"></a>01201    FILE *FileToWrite = fopen(FileName,<span class="stringliteral">&quot;a&quot;</span>);
<a name="l01202"></a>01202    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l1=0;l1&lt;SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>];l1++){
<a name="l01203"></a>01203      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l2=0;l2&lt;SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>];l2++){
<a name="l01204"></a>01204        fprintf(FileToWrite,<span class="stringliteral">&quot;%lf\n&quot;</span>,Plot[l1*NSample+l2]);
<a name="l01205"></a>01205      }
<a name="l01206"></a>01206    }
<a name="l01207"></a>01207    fclose(FileToWrite);
<a name="l01208"></a>01208       }
<a name="l01209"></a>01209     }
<a name="l01210"></a>01210   }
<a name="l01211"></a>01211 <span class="preprocessor">#ifdef OMPI_MPI_H</span>
<a name="l01212"></a>01212 <span class="preprocessor"></span>  MPI_Allreduce(MPI_IN_PLACE,ChainPArea,3*NSample, MPI_DOUBLE, MPI_SUM, Proc-&gt;CommGrid);
<a name="l01213"></a>01213   <span class="keywordtype">int</span> Rank=0;
<a name="l01214"></a>01214   MPI_Comm_rank(Proc-&gt;CommGrid, &amp;Rank);
<a name="l01215"></a>01215   <span class="keywordflow">if</span>(Rank==0){
<a name="l01216"></a>01216 <span class="preprocessor">#endif</span>
<a name="l01217"></a>01217 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01218"></a>01218     free(Plot);
<a name="l01219"></a>01219     <span class="comment">//--------normalizing--------------------</span>
<a name="l01220"></a>01220     <span class="keywordtype">double</span> Norm = 1./(double)(NFile[1]-NFile[0]);
<a name="l01221"></a>01221     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;NSample;t++){
<a name="l01222"></a>01222       ChainPArea[3*t  ] *= Norm;
<a name="l01223"></a>01223       ChainPArea[3*t+1] *= Norm;
<a name="l01224"></a>01224       ChainPArea[3*t+2] *= Norm;
<a name="l01225"></a>01225     }
<a name="l01226"></a>01226     sprintf(FileName,<span class="stringliteral">&quot;ChainPArea%.0fRho%.0fChiN%.0fKappa.dat&quot;</span>,<a class="code" href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9" title="Density coexistence.">prho</a>(),<a class="code" href="classVarData.html#a8def89edf23019d700fdbadb476e4c0a" title="Incompatibility.">pchiN</a>(),<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>());
<a name="l01227"></a>01227     FILE *FileToWrite = fopen(FileName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01228"></a>01228     <span class="keywordtype">char</span> cSystem[STRSIZE];
<a name="l01229"></a>01229     <a class="code" href="classVarData.html#aa415b42b89dfba2ab8189be4e86b41ad" title="Print a string with the system definitions.">SysDef</a>(cSystem);
<a name="l01230"></a>01230     fprintf(FileToWrite,<span class="stringliteral">&quot;# %s&quot;</span>,cSystem);
<a name="l01231"></a>01231     fprintf(FileToWrite,<span class="stringliteral">&quot;# Area MeanChPArea SDeviation Area*Dev/MeanChPArea\n&quot;</span>);
<a name="l01232"></a>01232     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;NSample;t++){
<a name="l01233"></a>01233       <span class="keywordtype">double</span> Compr = Area[t]*ChainPArea[3*t+1]/SQR(ChainPArea[3*t  ]);
<a name="l01234"></a>01234       fprintf(FileToWrite,<span class="stringliteral">&quot;%lf %lf %lf %lf\n&quot;</span>,Area[t],(ChainPArea[3*t  ]),ChainPArea[3*t+1],Compr);
<a name="l01235"></a>01235       <span class="comment">//fprintf(FileToWrite,&quot;%lf %lf %lf %lf\n&quot;,ChainPArea[3*t+0],Area[t]*ChainPArea[3*t+1],ChainPArea[3*t+1],ChainPArea[3*t+2]);</span>
<a name="l01236"></a>01236     }
<a name="l01237"></a>01237     fclose(FileToWrite);
<a name="l01238"></a>01238 <span class="preprocessor">#ifdef OMPI_MPI_H</span>
<a name="l01239"></a>01239 <span class="preprocessor"></span>  }
<a name="l01240"></a>01240 <span class="preprocessor">#endif</span>
<a name="l01241"></a>01241 <span class="preprocessor"></span>  free(ChainPArea);
<a name="l01242"></a>01242 }
<a name="l01248"></a><a class="code" href="classElPoly.html#a48968ddc44376e55852e9720b3827ebe">01248</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a48968ddc44376e55852e9720b3827ebe" title="Measure the elastic coupling between the two sheets.">ElPoly::ElasticCoupling</a>(<span class="keywordtype">int</span> NSample){
<a name="l01249"></a>01249   <span class="keywordtype">double</span> Edge[3] = {<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(0)-1.,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(1)-1.,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(2)};
<a name="l01250"></a>01250   <span class="keywordtype">int</span> SubDiv[3] = {NSample,NSample,1};
<a name="l01251"></a>01251   <span class="comment">//mean StdDev Area*StdDev/Mean^2</span>
<a name="l01252"></a>01252   <span class="keywordtype">double</span> *ElCoup = (<span class="keywordtype">double</span> *)calloc(3*(NSample+1),<span class="keyword">sizeof</span>(double));
<a name="l01253"></a>01253   <span class="keywordtype">double</span> *Area = (<span class="keywordtype">double</span> *)calloc((NSample+1),<span class="keyword">sizeof</span>(double));
<a name="l01254"></a>01254   <span class="keywordtype">double</span> *NDiv = (<span class="keywordtype">double</span> *)calloc((NSample+1),<span class="keyword">sizeof</span>(double));
<a name="l01255"></a>01255   <span class="keywordtype">double</span> MeanSigma = 0.;
<a name="l01256"></a>01256   <span class="keywordtype">char</span> FileName[256];
<a name="l01257"></a>01257   <span class="comment">//for the simulation in NPtT a smaller box is used</span>
<a name="l01258"></a>01258   <span class="keywordtype">double</span> InvEdge[3] = {1./Edge[0],1./Edge[1],1./Edge[2]};
<a name="l01259"></a>01259   <span class="keywordtype">double</span> *PosUp   = (<span class="keywordtype">double</span> *)calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l01260"></a>01260   <span class="keywordtype">double</span> *PosDown = (<span class="keywordtype">double</span> *)calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l01261"></a>01261   <span class="keywordtype">double</span> *CountUp  = (<span class="keywordtype">double</span> *)calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l01262"></a>01262   <span class="keywordtype">double</span> *CountDown= (<span class="keywordtype">double</span> *)calloc(SQR(NSample),<span class="keyword">sizeof</span>(double));
<a name="l01263"></a>01263   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l01264"></a>01264     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l01265"></a>01265     <a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_CHAIN);
<a name="l01266"></a>01266     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;NSample+1;t++){
<a name="l01267"></a>01267       <span class="comment">//defining the partitions</span>
<a name="l01268"></a>01268       <span class="comment">// SubDiv[CLat1] = (int)pow(2.,t);</span>
<a name="l01269"></a>01269       <span class="comment">// SubDiv[CLat2] = (int)pow(2.,t);</span>
<a name="l01270"></a>01270       SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>] = NSample - t;
<a name="l01271"></a>01271       SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>] = NSample - t;
<a name="l01272"></a>01272       <span class="keywordflow">if</span>(t == NSample-1) SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>] = 2;
<a name="l01273"></a>01273       <span class="keywordflow">if</span>(t == NSample){
<a name="l01274"></a>01274    SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>] = 1;
<a name="l01275"></a>01275    SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>] = 1;
<a name="l01276"></a>01276       }  
<a name="l01277"></a>01277       NDiv[t] = SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>];
<a name="l01278"></a>01278       Area[t] = Edge[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*Edge[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]/(double)(SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]);
<a name="l01279"></a>01279       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;n&lt;SQR(NSample);n++){
<a name="l01280"></a>01280    PosUp[n] = 0.;
<a name="l01281"></a>01281    PosDown[n] = 0.;
<a name="l01282"></a>01282    CountUp[n] = 0.;
<a name="l01283"></a>01283    CountDown[n] = 0.;
<a name="l01284"></a>01284       }
<a name="l01285"></a>01285       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l01286"></a>01286    <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c" title="Return the type.">pType</a>(p) != 1) <span class="keywordflow">continue</span>;
<a name="l01287"></a>01287    <span class="keywordtype">double</span> x = <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>) - floor(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>);
<a name="l01288"></a>01288    <span class="keywordtype">double</span> y = <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,CLat2) - floor(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,CLat2)*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(CLat2))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(CLat2);
<a name="l01289"></a>01289    <span class="keywordtype">int</span> sx = (int)(x*InvEdge[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]);
<a name="l01290"></a>01290    <span class="keywordflow">if</span>(sx &lt; 0 || sx &gt;= SubDiv[CLat1]) <span class="keywordflow">continue</span>;
<a name="l01291"></a>01291    <span class="keywordtype">int</span> sy = (int)(y*InvEdge[CLat2]*SubDiv[CLat2]);
<a name="l01292"></a>01292    <span class="keywordflow">if</span>(sy &lt; 0 || sy &gt;= SubDiv[CLat2]) <span class="keywordflow">continue</span>;
<a name="l01293"></a>01293    <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[<a class="code" href="classVarData.html#ab7c7c0a0081da25f3d4624ae61dc9d68" title="Return the chain.">pChain</a>(p)].<a class="code" href="structCHAIN.html#ae011432eaca3858364b05a111f4011d3" title="Type of the chain (see list CHAIN_)">Type</a>,CHAIN_UP)){
<a name="l01294"></a>01294      PosUp[sx*NSample+sy] += <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);
<a name="l01295"></a>01295      CountUp[sx*NSample+sy] += 1.;
<a name="l01296"></a>01296    }
<a name="l01297"></a>01297    <span class="keywordflow">else</span> {
<a name="l01298"></a>01298      PosDown[sx*NSample+sy] += <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);
<a name="l01299"></a>01299      CountDown[sx*NSample+sy] += 1.;
<a name="l01300"></a>01300    }
<a name="l01301"></a>01301       }
<a name="l01302"></a>01302       <span class="keywordtype">double</span> SumX = 0.;
<a name="l01303"></a>01303       <span class="keywordtype">double</span> SumX2 = 0.;
<a name="l01304"></a>01304       <span class="keywordtype">double</span> Count = 0.;
<a name="l01305"></a>01305       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx = 0;sx&lt;SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>];sx++){
<a name="l01306"></a>01306    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy = 0;sy&lt;SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>];sy++){
<a name="l01307"></a>01307      <span class="keywordtype">int</span> n = sx*NSample+sy;
<a name="l01308"></a>01308      PosUp[n] /= CountUp[n] &gt; 1. ? CountUp[n] : 1.;
<a name="l01309"></a>01309      PosDown[n] /= CountDown[n] &gt; 1. ? CountDown[n] : 1.;
<a name="l01310"></a>01310      <span class="keywordtype">double</span> Val = (PosUp[n]-PosDown[n]);
<a name="l01311"></a>01311      SumX += Val;
<a name="l01312"></a>01312      Count += 1.;
<a name="l01313"></a>01313      ElCoup[3*t+2] += 1.;
<a name="l01314"></a>01314    }
<a name="l01315"></a>01315       }
<a name="l01316"></a>01316       <span class="keywordtype">double</span> NInv = Count &gt; 0. ? 1./Count : 1.;
<a name="l01317"></a>01317       <span class="keywordtype">double</span> MeanVal = SumX*NInv;
<a name="l01318"></a>01318       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx = 0;sx &lt; SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>];sx++){
<a name="l01319"></a>01319    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy = 0;sy &lt; SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>];sy++){
<a name="l01320"></a>01320      <span class="keywordtype">int</span> n = sx*NSample+sy;
<a name="l01321"></a>01321      <span class="keywordtype">double</span> Val = (PosUp[n]-PosDown[n]);
<a name="l01322"></a>01322      SumX2 += SQR(Val - MeanVal);
<a name="l01323"></a>01323    }
<a name="l01324"></a>01324       }
<a name="l01325"></a>01325       ElCoup[3*t  ] += MeanVal;
<a name="l01326"></a>01326       ElCoup[3*t+1] += SumX2/(Count - 1.);
<a name="l01327"></a>01327       <span class="keywordflow">if</span>(1==0){<span class="comment">//writes the single distribution files</span>
<a name="l01328"></a>01328    sprintf(FileName,<span class="stringliteral">&quot;Distr%.0fKappa%02d.dat&quot;</span>,<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>(),t);
<a name="l01329"></a>01329    FILE *FileToWrite = fopen(FileName,<span class="stringliteral">&quot;a&quot;</span>);
<a name="l01330"></a>01330    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l1=0;l1&lt;SubDiv[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>];l1++){
<a name="l01331"></a>01331      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l2=0;l2&lt;SubDiv[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>];l2++){
<a name="l01332"></a>01332        <span class="keywordtype">int</span> n = l1*NSample+l2;
<a name="l01333"></a>01333        fprintf(FileToWrite,<span class="stringliteral">&quot;%lf\n&quot;</span>,(PosUp[n]-PosDown[n]));
<a name="l01334"></a>01334      }
<a name="l01335"></a>01335    }
<a name="l01336"></a>01336    fclose(FileToWrite);
<a name="l01337"></a>01337       }
<a name="l01338"></a>01338     }
<a name="l01339"></a>01339   }
<a name="l01340"></a>01340 <span class="preprocessor"> #ifdef OMPI_MPI_H</span>
<a name="l01341"></a>01341 <span class="preprocessor"></span>  MPI_Allreduce(MPI_IN_PLACE,ElCoup,3*NSample, MPI_DOUBLE, MPI_SUM, Proc-&gt;CommGrid);
<a name="l01342"></a>01342   <span class="keywordtype">int</span> Rank=0;
<a name="l01343"></a>01343   MPI_Comm_rank(Proc-&gt;CommGrid, &amp;Rank);
<a name="l01344"></a>01344   <span class="keywordflow">if</span>(Rank==0){
<a name="l01345"></a>01345 <span class="preprocessor">#endif</span>
<a name="l01346"></a>01346 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01347"></a>01347     <span class="comment">//--------normalizing--------------------</span>
<a name="l01348"></a>01348     <span class="keywordtype">double</span> Norm = 1./(double)(NFile[1]-NFile[0]);
<a name="l01349"></a>01349     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;NSample+1;t++){
<a name="l01350"></a>01350       ElCoup[3*t  ] *= Norm;
<a name="l01351"></a>01351       ElCoup[3*t+1] *= Norm;
<a name="l01352"></a>01352       ElCoup[3*t+2] *= Norm;
<a name="l01353"></a>01353     }
<a name="l01354"></a>01354     ElCoup[3*NSample+1] = 0.;
<a name="l01355"></a>01355     sprintf(FileName,<span class="stringliteral">&quot;ElasticCoupling%.0fRho%.0fChiN%.0fKappa.dat&quot;</span>,<a class="code" href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9" title="Density coexistence.">prho</a>(),<a class="code" href="classVarData.html#a8def89edf23019d700fdbadb476e4c0a" title="Incompatibility.">pchiN</a>(),<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>());
<a name="l01356"></a>01356     FILE *FileToWrite = fopen(FileName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01357"></a>01357     <span class="keywordtype">char</span> cSystem[STRSIZE];
<a name="l01358"></a>01358     <a class="code" href="classVarData.html#aa415b42b89dfba2ab8189be4e86b41ad" title="Print a string with the system definitions.">SysDef</a>(cSystem);
<a name="l01359"></a>01359     fprintf(FileToWrite,<span class="stringliteral">&quot;# %s&quot;</span>,cSystem);
<a name="l01360"></a>01360     fprintf(FileToWrite,<span class="stringliteral">&quot;# Area Thickness ThickStdDev Area*ThickStdDev\n&quot;</span>);
<a name="l01361"></a>01361     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;NSample+1;t++){
<a name="l01362"></a>01362       fprintf(FileToWrite,<span class="stringliteral">&quot;%lf %lf %lf %lf \n&quot;</span>,Area[t],ElCoup[3*t  ],ElCoup[3*t+1],Area[t]*ElCoup[3*t+1]/SQR(ElCoup[3*t  ]));
<a name="l01363"></a>01363     }
<a name="l01364"></a>01364     fclose(FileToWrite);
<a name="l01365"></a>01365 <span class="preprocessor">#ifdef OMPI_MPI_H</span>
<a name="l01366"></a>01366 <span class="preprocessor"></span>  }
<a name="l01367"></a>01367 <span class="preprocessor">#endif</span>
<a name="l01368"></a>01368 <span class="preprocessor"></span>  free(ElCoup);
<a name="l01369"></a>01369   free(PosUp);
<a name="l01370"></a>01370   free(PosDown);
<a name="l01371"></a>01371   free(CountUp);
<a name="l01372"></a>01372   free(CountDown);
<a name="l01373"></a>01373 }
<a name="l01377"></a><a class="code" href="classElPoly.html#ab88192e9e4e0f11b68ad828d73ff8957">01377</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#ab88192e9e4e0f11b68ad828d73ff8957" title="Measure the elastic coupling between the two sheets.">ElPoly::ElasticCouplingNVT</a>(){
<a name="l01378"></a>01378   <span class="comment">//mean StdDev Area*StdDev/Mean^2</span>
<a name="l01379"></a>01379   <span class="keywordtype">double</span> ElCoup[3] = {0.,0.,0.};
<a name="l01380"></a>01380   <span class="keywordtype">char</span> FileName[256];
<a name="l01381"></a>01381   <span class="keywordtype">char</span> cSystem[STRSIZE];
<a name="l01382"></a>01382   <span class="comment">//for the simulation in NPtT a smaller box is used</span>
<a name="l01383"></a>01383   sprintf(FileName,<span class="stringliteral">&quot;ElCoupNVT%.0fRho%.0fChiN%.0fKappa.dat&quot;</span>,<a class="code" href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9" title="Density coexistence.">prho</a>(),<a class="code" href="classVarData.html#a8def89edf23019d700fdbadb476e4c0a" title="Incompatibility.">pchiN</a>(),<a class="code" href="classVarData.html#af410b05a34ef11ae5d26090a7706493b" title="Incompressibility.">pkappaN</a>());
<a name="l01384"></a>01384   FILE *FileToWrite = fopen(FileName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01385"></a>01385   <a class="code" href="classVarData.html#aa415b42b89dfba2ab8189be4e86b41ad" title="Print a string with the system definitions.">SysDef</a>(cSystem);
<a name="l01386"></a>01386   fprintf(FileToWrite,<span class="stringliteral">&quot;# %s&quot;</span>,cSystem);
<a name="l01387"></a>01387   fprintf(FileToWrite,<span class="stringliteral">&quot;# step Thickness ThickStdDev\n&quot;</span>);
<a name="l01388"></a>01388   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l01389"></a>01389     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l01390"></a>01390     <a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_CHAIN);
<a name="l01391"></a>01391     <span class="keywordtype">double</span> PosUp = 0.;
<a name="l01392"></a>01392     <span class="keywordtype">double</span> PosDown = 0.;
<a name="l01393"></a>01393     <span class="keywordtype">double</span> CountUp = 0.;
<a name="l01394"></a>01394     <span class="keywordtype">double</span> CountDown = 0.;
<a name="l01395"></a>01395     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l01396"></a>01396       <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c" title="Return the type.">pType</a>(p) != 1) <span class="keywordflow">continue</span>;
<a name="l01397"></a>01397       <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[<a class="code" href="classVarData.html#ab7c7c0a0081da25f3d4624ae61dc9d68" title="Return the chain.">pChain</a>(p)].Type,CHAIN_UP)){
<a name="l01398"></a>01398    PosUp += <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);
<a name="l01399"></a>01399    CountUp += 1.;
<a name="l01400"></a>01400       }
<a name="l01401"></a>01401       <span class="keywordflow">else</span> {
<a name="l01402"></a>01402    PosDown += <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);
<a name="l01403"></a>01403    CountDown += 1.;
<a name="l01404"></a>01404       }
<a name="l01405"></a>01405     }
<a name="l01406"></a>01406     PosUp /= CountUp &gt; 1. ? CountUp : 1.;
<a name="l01407"></a>01407     PosDown /= CountDown &gt; 1. ? CountDown : 1.;
<a name="l01408"></a>01408     ElCoup[0] += (PosUp-PosDown);
<a name="l01409"></a>01409     ElCoup[1] += SQR(PosUp-PosDown);
<a name="l01410"></a>01410     fprintf(FileToWrite,<span class="stringliteral">&quot;%d %lf\n&quot;</span>,f,PosUp-PosDown);
<a name="l01411"></a>01411   }
<a name="l01412"></a>01412   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01413"></a>01413   ElCoup[1] = sqrt((ElCoup[1] - SQR(ElCoup[0])*(NFile[1]-NFile[1]))/((<span class="keywordtype">double</span>)(NFile[0]-NFile[1])-1.));
<a name="l01414"></a>01414   fprintf(FileToWrite,<span class="stringliteral">&quot;# %lf %lf %lf\n&quot;</span>,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>),ElCoup[0],ElCoup[1]);
<a name="l01415"></a>01415   fclose(FileToWrite);
<a name="l01416"></a>01416 }
<a name="l01417"></a><a class="code" href="classElPoly.html#a6f1477b110e5ee0e7e027466dac51b69">01417</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a6f1477b110e5ee0e7e027466dac51b69" title="Measure the elastic coupling between the two sheets.">ElPoly::BilayerDistance</a>(<span class="keywordtype">char</span> *OutFile,<span class="keywordtype">int</span> NSample){
<a name="l01418"></a>01418   FILE *File2Write = fopen(OutFile,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01419"></a>01419   <span class="keywordtype">int</span> NLayer = 2;
<a name="l01420"></a>01420   <span class="keywordtype">double</span> PosBf[3];
<a name="l01421"></a>01421   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l01422"></a>01422     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l01423"></a>01423     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_CHAIN))<span class="keywordflow">return</span>;
<a name="l01424"></a>01424     <span class="keywordtype">double</span> *PosLay   = (<span class="keywordtype">double</span> *)calloc(4*NSample*NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01425"></a>01425     <span class="keywordtype">double</span> *CountLay = (<span class="keywordtype">double</span> *)calloc(4*NSample*NSample,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01426"></a>01426     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0,cOff=0,pOff=0;b&lt;<a class="code" href="classVarData.html#a474ffd5306304ac53eb7ef48a18e511d" title="Number of blocks.">pNBlock</a>();cOff+=<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>(b++)){
<a name="l01427"></a>01427       <span class="keywordtype">int</span> Level = 0;
<a name="l01428"></a>01428       <span class="keywordflow">if</span>(!strcmp(<a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[b].Name,<span class="stringliteral">&quot;LIPID1&quot;</span>)) Level = 2;
<a name="l01429"></a>01429       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=cOff;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>(b)+cOff;c++,pOff+=<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>(b)){
<a name="l01430"></a>01430    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l01431"></a>01431      PosBf[d] = <a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[c].<a class="code" href="structCHAIN.html#ac00d29ea47aa8845638961a34cb3ec0e" title="xyzr Postion of the chain">Pos</a>[d] - floor(<a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[c].Pos[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d);
<a name="l01432"></a>01432    }
<a name="l01433"></a>01433    <span class="keywordtype">int</span> cLevel = Level;
<a name="l01434"></a>01434    <span class="keywordflow">if</span>(CHAIN_IF_TYPE(<a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[c].Type,CHAIN_UP)) cLevel += 1;
<a name="l01435"></a>01435    <span class="keywordtype">int</span> sx = (int)(PosBf[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f" title="lateral coordinate">CLat1</a>)*NSample);
<a name="l01436"></a>01436    <span class="keywordtype">int</span> sy = (int)(PosBf[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86" title="lateral coordinate">CLat2</a>)*NSample);
<a name="l01437"></a>01437    <span class="keywordflow">if</span>(sx &lt; 0 || sx &gt;= NSample) <span class="keywordflow">continue</span>;
<a name="l01438"></a>01438    <span class="keywordflow">if</span>(sy &lt; 0 || sy &gt;= NSample) <span class="keywordflow">continue</span>;
<a name="l01439"></a>01439    PosLay[(sx*NSample+sy)*4+cLevel] += <a class="code" href="classVarData.html#af2deb35998deb81dc9ef4ae6f65cc27d" title="Information on all chains.">Ch</a>[c].Pos[<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>];<span class="comment">//PosBf[CNorm];</span>
<a name="l01440"></a>01440    CountLay[(sx*NSample+sy)*4+cLevel] += 1.;
<a name="l01441"></a>01441       }
<a name="l01442"></a>01442     }
<a name="l01443"></a>01443     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx = 0;sx &lt; NSample;sx++){
<a name="l01444"></a>01444       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy = 0;sy &lt; NSample;sy++){
<a name="l01445"></a>01445    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0;l&lt;4;l++){
<a name="l01446"></a>01446      PosLay[(sx*NSample+sy)*4+l] /= CountLay[(sx*NSample+sy)*4+l] &gt; 0. ? CountLay[(sx*NSample+sy)*4+l] : 1.;
<a name="l01447"></a>01447    }
<a name="l01448"></a>01448    <span class="keywordtype">double</span> h1 = PosLay[(sx*NSample+sy)*4+2]-PosLay[(sx*NSample+sy)*4+1];
<a name="l01449"></a>01449    <span class="keywordtype">double</span> h2 = PosLay[(sx*NSample+sy)*4+3]-PosLay[(sx*NSample+sy)*4+0];
<a name="l01450"></a>01450    h2 -= floor(h2*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e" title="Normal coordinate.">CNorm</a>);
<a name="l01451"></a>01451    <span class="comment">//if(PosLay[(sx*NSample+sy)*4+0]*PosLay[(sx*NSample+sy)*4+1]*PosLay[(sx*NSample+sy)*4+2]*PosLay[(sx*NSample+sy)*4+3] &lt;= 0.) continue;</span>
<a name="l01452"></a>01452    fprintf(File2Write,<span class="stringliteral">&quot;%lf %lf %lf %lf %lf\n&quot;</span>,MIN(h1,h2),PosLay[(sx*NSample+sy)*4+0],PosLay[(sx*NSample+sy)*4+1],PosLay[(sx*NSample+sy)*4+2],PosLay[(sx*NSample+sy)*4+3]);
<a name="l01453"></a>01453       }
<a name="l01454"></a>01454     }
<a name="l01455"></a>01455     free(PosLay);
<a name="l01456"></a>01456     free(CountLay);
<a name="l01457"></a>01457   }
<a name="l01458"></a>01458   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01459"></a>01459   fclose(File2Write);
<a name="l01460"></a>01460 }
<a name="l01461"></a><a class="code" href="classElPoly.html#af5a6c502bd65553e3f5e98577081ec66">01461</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a932a57ab32bd20f60bce8b498ca3095d" title="Distribution of the bond lengths.">ElPoly::BondDistr</a>(<span class="keywordtype">char</span> *OutFile,<span class="keywordtype">int</span> NBin){
<a name="l01462"></a>01462   FILE *File2Write = fopen(OutFile,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01463"></a>01463   <span class="comment">// double **Histo = (double **)calloc(3,sizeof(double));</span>
<a name="l01464"></a>01464   <span class="comment">// double **Raw = (double **)calloc(3,sizeof(double));</span>
<a name="l01465"></a>01465   <span class="comment">// for(int d=0;d&lt;3;d++){</span>
<a name="l01466"></a>01466   <span class="comment">//   Histo[d] = (double *)calloc(NBin,sizeof(double));</span>
<a name="l01467"></a>01467   <span class="comment">//   Raw[d] = (double *)calloc(pNPart,sizeof(double));</span>
<a name="l01468"></a>01468   <span class="comment">// }</span>
<a name="l01469"></a>01469   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l01470"></a>01470     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l01471"></a>01471     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_NO)) <span class="keywordflow">return</span>;
<a name="l01472"></a>01472     <span class="keywordtype">double</span> Dist[3];
<a name="l01473"></a>01473     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++){
<a name="l01474"></a>01474       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>()-1;p++){
<a name="l01475"></a>01475    <span class="keywordtype">int</span> p1 = p + c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();
<a name="l01476"></a>01476    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l01477"></a>01477      Dist[d] = remainder(<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p1,d) - <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p1+1,d),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d));
<a name="l01478"></a>01478    }
<a name="l01479"></a>01479    fprintf(File2Write,<span class="stringliteral">&quot;%lf %lf %lf %lf\n&quot;</span>,Dist[0],Dist[1],Dist[2],sqrt(SQR(Dist[0])+SQR(Dist[1])+SQR(Dist[2])));
<a name="l01480"></a>01480       }
<a name="l01481"></a>01481     }
<a name="l01482"></a>01482   }
<a name="l01483"></a>01483   <span class="comment">// MOMENTI Mom[3];</span>
<a name="l01484"></a>01484   <span class="comment">// int xMin = Raw[0][0];</span>
<a name="l01485"></a>01485   <span class="comment">// int xMax = Raw[0][0];</span>
<a name="l01486"></a>01486   <span class="comment">// for(int d=0;d&lt;3;d++){</span>
<a name="l01487"></a>01487   <span class="comment">//   Mom[d] = Mat-&gt;Distribuzione(Raw[d],pNPart-pNChain,Histo[d],NBin);</span>
<a name="l01488"></a>01488   <span class="comment">//   Mat-&gt;Normalize(Histo[d],NBin);</span>
<a name="l01489"></a>01489   <span class="comment">//   if(xMin &gt; Mom[d].Minimo) xMin = Mom[d].Minimo;</span>
<a name="l01490"></a>01490   <span class="comment">//   if(xMax &gt; Mom[d].Massimo) xMax = Mom[d].Massimo;</span>
<a name="l01491"></a>01491   <span class="comment">// }</span>
<a name="l01492"></a>01492   <span class="comment">// for(int v=0;v&lt;NBin;v++){</span>
<a name="l01493"></a>01493   <span class="comment">//   double x = v/(double)(NBin)*(xMax-xMin)+xMin;</span>
<a name="l01494"></a>01494   <span class="comment">//   fprintf(File2Write,&quot;%lf %lf %lf %lf\n&quot;,x,Histo[0][v],Histo[1][v],Histo[2][v]);</span>
<a name="l01495"></a>01495   <span class="comment">// }</span>
<a name="l01496"></a>01496   <span class="comment">// for(int d=0;d&lt;3;d++){</span>
<a name="l01497"></a>01497   <span class="comment">//   free(Histo[d]);</span>
<a name="l01498"></a>01498   <span class="comment">//   free(Raw[d]);</span>
<a name="l01499"></a>01499   <span class="comment">// }</span>
<a name="l01500"></a>01500   <span class="comment">// free(Histo);</span>
<a name="l01501"></a>01501   <span class="comment">// free(Raw);</span>
<a name="l01502"></a>01502   fclose(File2Write);
<a name="l01503"></a>01503 }
<a name="l01504"></a><a class="code" href="classElPoly.html#a9152ea7044fdfac4a1def898c1c21a9d">01504</a> <span class="keywordtype">void</span> <a class="code" href="classElPoly.html#a9152ea7044fdfac4a1def898c1c21a9d" title="Distribution of the end to end distances.">ElPoly::EndToEndDist</a>(){
<a name="l01505"></a>01505   <span class="keywordtype">double</span> *EndToEnd = (<span class="keywordtype">double</span> *) calloc(<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>()*(<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1]-<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0]),<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01506"></a>01506   <span class="keywordtype">double</span> *Distr = (<span class="keywordtype">double</span> *) calloc((<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1]-<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0]),<span class="keyword">sizeof</span>(double));
<a name="l01507"></a>01507   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[0];f&lt;<a class="code" href="classElPoly.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>[1];f++){
<a name="l01508"></a>01508     <a class="code" href="classElPoly.html#a02045f98c00a6ef6af607bc27fc3e82a" title="Information on the current file elaborated.">Processing</a>(f);
<a name="l01509"></a>01509     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a385ea4b67d94de234204940ef8da368d" title="Opens a file without reallocationg.">OpenRisk</a>(cFile[f],BF_NO))<span class="keywordflow">return</span>;
<a name="l01510"></a>01510     
<a name="l01511"></a>01511 
<a name="l01512"></a>01512   }
<a name="l01513"></a>01513 
<a name="l01514"></a>01514 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu Mar 27 2014 22:02:19 for Allink by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
