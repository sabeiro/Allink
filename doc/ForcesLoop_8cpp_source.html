<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Allink: src/Addyn/ForcesLoop.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Allink
   &#160;<span id="projectnumber">v0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_8e9a8b7e3c72bcc96dd64e909190dc02.html">src</a>      </li>
      <li class="navelem"><a class="el" href="dir_9eb7b934b0b571f03e95a80abda3221c.html">Addyn</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">ForcesLoop.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;Forces.h&quot;</span>
<a name="l00003"></a><a class="code" href="classForces.html#a111835c2cd5d392591f9e32ea6d9cf19">00003</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a111835c2cd5d392591f9e32ea6d9cf19" title="Choose the simulation method.">Forces::ChooseSimMode</a>(){
<a name="l00004"></a>00004   <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_2D)){
<a name="l00005"></a>00005     <span class="comment">//CalcUpdate = &amp;Forces::Sim2d;</span>
<a name="l00006"></a>00006   }
<a name="l00007"></a>00007 }
<a name="l00009"></a><a class="code" href="classForces.html#a941bab4d0655ea3e774cd525e664be52">00009</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a941bab4d0655ea3e774cd525e664be52" title="Solve a system of four oder differential equation.">Forces::Solve</a>(){
<a name="l00010"></a>00010   <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_2D))
<a name="l00011"></a>00011     <a class="code" href="classForces.html#abcac13d7754b73f6f22b2900a0d46d7d" title="Solve a system of four oder differential equation of particles connected by links.">SolveLinksIterative</a>();
<a name="l00012"></a>00012   <span class="comment">//SolveLinks();</span>
<a name="l00013"></a>00013   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_LEAVES))
<a name="l00014"></a>00014     <a class="code" href="classForces.html#a7a03a3d52f5a114cbbc22e60af60c049" title="Solve a system of four oder differential equation of particles in a line.">SolveLeaves</a>();
<a name="l00015"></a>00015   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_PORE))
<a name="l00016"></a>00016     <a class="code" href="classForces.html#a7a03a3d52f5a114cbbc22e60af60c049" title="Solve a system of four oder differential equation of particles in a line.">SolveLeaves</a>();
<a name="l00017"></a>00017   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_ROD))
<a name="l00018"></a>00018     <a class="code" href="classForces.html#a3953ee74479102530a979e3cd447d174" title="Solve a system of four oder differential equation of particles connected by links.">SolveRod</a>();
<a name="l00019"></a>00019 }
<a name="l00020"></a><a class="code" href="classForces.html#a338adbdaecf3f72150ce3e88ec710bf1">00020</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a338adbdaecf3f72150ce3e88ec710bf1" title="Sum up all the forces and update the positions.">Forces::Dynamics</a>(){
<a name="l00021"></a>00021   <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_MD)){
<a name="l00022"></a>00022     <a class="code" href="classForces.html#a7a55d93047438c9c5f5f9145a995e8d0" title="First step of the velocity Verlet.">VelVerlet1</a>();
<a name="l00023"></a>00023   }
<a name="l00024"></a>00024   <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_2D)){
<a name="l00025"></a>00025     <a class="code" href="classForces.html#aea3ac235b677278906db133f4cfd54f4" title="Sinusoidal surface wave.">Wave</a>();
<a name="l00026"></a>00026   }
<a name="l00027"></a>00027   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_LEAVES)){
<a name="l00028"></a>00028     <a class="code" href="classForces.html#aed97e42cbfeb918574e91a90719864ab" title="Helfrich Hamiltonian with an elastic coupling.">ForceFieldLeaves</a>();
<a name="l00029"></a>00029   }
<a name="l00030"></a>00030   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_1D)){
<a name="l00031"></a>00031     <a class="code" href="classForces.html#abe46a6cf819d53f35747565f9276854f" title="Helfrich Hamiltonian for a line.">ForceFieldLine</a>();
<a name="l00032"></a>00032   }
<a name="l00033"></a>00033   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_3D)){
<a name="l00034"></a>00034     <a class="code" href="classForces.html#aa57796d41906bf35c6a79225ecda6f98" title="Armonic potential on a lattice.">ForceFieldBulk</a>();
<a name="l00035"></a>00035   }
<a name="l00036"></a>00036   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_ROD)){
<a name="l00037"></a>00037     <a class="code" href="classForces.html#ae35380222f8a3cacfa4a4df6d1742ffb" title="Bending potential on a rod.">ForceFieldRod</a>();
<a name="l00038"></a>00038   }
<a name="l00039"></a>00039   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_RIGID)){
<a name="l00040"></a>00040     <a class="code" href="classForces.html#a8f12492ed75d05c816d8f14bbeaf71be" title="Interaction between rigid bodies.">ForceFieldRigid</a>();
<a name="l00041"></a>00041     <a class="code" href="classForces.html#a050e80ecdb61ccf749649d6ec6542ee7" title="Velocity Verlet for a rigid body, first step.">VelVerletRigid</a>();
<a name="l00042"></a>00042   }
<a name="l00043"></a>00043   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_MC)){
<a name="l00044"></a>00044     <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ae7fd260630480928a069e7e536739df1" title="Calculation mode.">CalcMode</a>,CALC_NVT)){
<a name="l00045"></a>00045       <span class="comment">//for(int p=0;p&lt;2*pNPCh();p++) </span>
<a name="l00046"></a>00046       <a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a> += <a class="code" href="classForces.html#ad69656acc46a08f2361dbe5b1067dffa" title="Trial movement.">TryMove</a>();
<a name="l00047"></a>00047     }
<a name="l00048"></a>00048     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ae7fd260630480928a069e7e536739df1" title="Calculation mode.">CalcMode</a>,CALC_NcVT)){
<a name="l00049"></a>00049       <a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a> += <a class="code" href="classForces.html#aa30016ca75ff4d48a905a9dad7da023f" title="Trial desplacement of a chain.">TryMoveCh</a>();
<a name="l00050"></a>00050     }
<a name="l00051"></a>00051     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ae7fd260630480928a069e7e536739df1" title="Calculation mode.">CalcMode</a>,CALC_mVT)){
<a name="l00052"></a>00052       <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#a953e8be14f6a9c259f192683f3a5a970" title="Random uniform number.">Casuale</a>() &lt; .5) 
<a name="l00053"></a>00053    <a class="code" href="classForces.html#aeeef7711986a24838884d8ef8c12f4ae" title="Count accepted moves.">NRemoval</a> += <a class="code" href="classForces.html#a0658783c2d6dcab7a875f938747255a6" title="Trial removal.">TryRemove</a>();
<a name="l00054"></a>00054       <span class="keywordflow">else</span> 
<a name="l00055"></a>00055    <a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a> += <a class="code" href="classForces.html#a56709cda842db1c6f3813acc5bca5237" title="Trial insertion.">TryInsert</a>();
<a name="l00056"></a>00056     }
<a name="l00057"></a>00057     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ae7fd260630480928a069e7e536739df1" title="Calculation mode.">CalcMode</a>,CALC_mcVT)){
<a name="l00058"></a>00058       <span class="keywordflow">if</span>(!VAR_IF_TYPE(<a class="code" href="classForces.html#ae7fd260630480928a069e7e536739df1" title="Calculation mode.">CalcMode</a>,CALC_CONF_BIAS)){
<a name="l00059"></a>00059    <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#a953e8be14f6a9c259f192683f3a5a970" title="Random uniform number.">Casuale</a>() &lt; .5) <a class="code" href="classForces.html#aeeef7711986a24838884d8ef8c12f4ae" title="Count accepted moves.">NRemoval</a> += <a class="code" href="classForces.html#aefc3ccff8a9805e952ddc49194595844" title="Trial removal of a chain.">TryRemoveCh</a>();
<a name="l00060"></a>00060    <span class="keywordflow">else</span> <a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a> += <a class="code" href="classForces.html#ab7bfa9d7122c69b311f666740653bd0b" title="Trial insertion of a chain.">TryInsertCh</a>();
<a name="l00061"></a>00061       }
<a name="l00062"></a>00062       <span class="keywordflow">else</span> {
<a name="l00063"></a>00063    <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#a953e8be14f6a9c259f192683f3a5a970" title="Random uniform number.">Casuale</a>() &lt; .5) 
<a name="l00064"></a>00064      <a class="code" href="classForces.html#aeeef7711986a24838884d8ef8c12f4ae" title="Count accepted moves.">NRemoval</a> += <a class="code" href="classForces.html#a32c3f4b656bce2cf73370ce605f53113" title="Trial biased removal of a chain.">TryRemoveChBias</a>();
<a name="l00065"></a>00065    <span class="keywordflow">else</span> 
<a name="l00066"></a>00066      <a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a> += <a class="code" href="classForces.html#a949d9de0a157e4258f88d5b5f322f74e" title="Trial biased insertion of a chain.">TryInsertChBias</a>();
<a name="l00067"></a>00067       }
<a name="l00068"></a>00068     }
<a name="l00069"></a>00069   }
<a name="l00070"></a>00070   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_ELECTRO)){
<a name="l00071"></a>00071     <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ae7fd260630480928a069e7e536739df1" title="Calculation mode.">CalcMode</a>,CALC_NVT)){
<a name="l00072"></a>00072       <a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a> += <a class="code" href="classForces.html#ad69656acc46a08f2361dbe5b1067dffa" title="Trial movement.">TryMove</a>();
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ae7fd260630480928a069e7e536739df1" title="Calculation mode.">CalcMode</a>,CALC_mVT)){
<a name="l00075"></a>00075       <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#a953e8be14f6a9c259f192683f3a5a970" title="Random uniform number.">Casuale</a>() &lt; .5) 
<a name="l00076"></a>00076    <a class="code" href="classForces.html#aeeef7711986a24838884d8ef8c12f4ae" title="Count accepted moves.">NRemoval</a> += <a class="code" href="classForces.html#a0658783c2d6dcab7a875f938747255a6" title="Trial removal.">TryRemove</a>();
<a name="l00077"></a>00077       <span class="keywordflow">else</span> 
<a name="l00078"></a>00078    <a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a> += <a class="code" href="classForces.html#a56709cda842db1c6f3813acc5bca5237" title="Trial insertion.">TryInsert</a>();
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080   }
<a name="l00081"></a>00081   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_MD)){
<a name="l00082"></a>00082     OldNrgSys = <a class="code" href="classForces.html#a791c1d5f301eb9c0d39c43a180eaf737" title="Iterate all over the particles and calculate the forces.">SumForcesMD</a>();
<a name="l00083"></a>00083     <a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051" title="Pair list.">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a98ae2e78109ea826eea71da14c37ce95" title="Erase the pairlist.">Erase</a>();
<a name="l00084"></a>00084     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00085"></a>00085       <a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051" title="Pair list.">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a9a64ea1512bb8d62f9f6a7a80a2bfec9" title="Add a particle to the cell c.">AddPart</a>(p,<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Pos);
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087   }
<a name="l00088"></a>00088   <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a>,SYS_MD)){
<a name="l00089"></a>00089     <a class="code" href="classForces.html#a0ccf73fded29832c9d6c8edad5a51b76" title="Pointer to the energy function.">ApplyTherm</a>();
<a name="l00090"></a>00090     <a class="code" href="classForces.html#a7965b2207a6253f8215b96a7195cb5bc" title="Second step of the velocity Verlet.">VelVerlet2</a>();
<a name="l00091"></a>00091   }
<a name="l00092"></a>00092   <a class="code" href="classForces.html#af51ff88ae9c6c4b9907f516c09ebf68f" title="Total time.">Time</a> += <a class="code" href="classVarData.html#af6622c9e9e57aae3faf756b7faa73e29" title="Delta t.">pDeltat</a>();
<a name="l00093"></a>00093   <a class="code" href="classVarData.html#aaa11921d5205a7db714c4f733065b710" title="Increment Step.">IncrStep</a>();
<a name="l00094"></a>00094   <a class="code" href="classVarData.html#a983f1e3e595a21568bec4d2852011a56" title="Set Time.">SetTime</a>(<a class="code" href="classForces.html#af51ff88ae9c6c4b9907f516c09ebf68f" title="Total time.">Time</a>);
<a name="l00095"></a>00095   <a class="code" href="classForces.html#af662b8c150e7cdd3983066e8dab609be" title="Perform a operation every time step.">Task</a>();
<a name="l00096"></a>00096 }
<a name="l00097"></a><a class="code" href="classForces.html#a49654bba62557156b6599f4875484078">00097</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a49654bba62557156b6599f4875484078" title="Find the minimun bilayer thickness for different peptide sizes.">Forces::ExplorePepSize</a>(){
<a name="l00098"></a>00098   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Explore pep size\n&quot;</span>);
<a name="l00099"></a>00099   <span class="keywordflow">if</span>(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a> != SYS_LEAVES) return ;
<a name="l00100"></a>00100   <span class="keywordtype">char</span> FName[120];
<a name="l00101"></a>00101   <span class="keywordtype">double</span> HeiMin = .15;
<a name="l00102"></a>00102   <span class="keywordtype">double</span> HeiMax = .4;
<a name="l00103"></a>00103   <span class="keywordtype">double</span> HeiStep = (HeiMax-HeiMin)/(<span class="keywordtype">double</span>)NGrid;
<a name="l00104"></a>00104   <span class="keywordtype">double</span> AngMin = 5.;
<a name="l00105"></a>00105   <span class="keywordtype">double</span> AngMax = 35.;
<a name="l00106"></a>00106   <span class="keywordtype">double</span> AngStep = (AngMax-AngMin)/(<span class="keywordtype">double</span>)NGrid;
<a name="l00107"></a>00107   <span class="keywordtype">double</span> SLapMin = 0.001;
<a name="l00108"></a>00108   <span class="keywordtype">double</span> SLapMax = 10.0;
<a name="l00109"></a>00109   <span class="keywordtype">double</span> SLapStep = 10.;
<a name="l00110"></a>00110   <span class="keywordflow">for</span>(<span class="keywordtype">double</span> SLap=SLapMin;SLap&lt;SLapMax;SLap*=SLapStep){
<a name="l00111"></a>00111     sprintf(FName,<span class="stringliteral">&quot;PepHeiElThickSLap%lf.dat&quot;</span>,SLap);
<a name="l00112"></a>00112     FILE *FWrite = fopen(FName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00113"></a>00113     <span class="keywordflow">for</span>(<span class="keywordtype">double</span> Hei=HeiMin;Hei&lt;HeiMax;Hei+=HeiStep){
<a name="l00114"></a>00114       <span class="keywordflow">for</span>(<span class="keywordtype">double</span> Angle=AngMin;Angle&lt;AngMax;Angle+=AngStep){
<a name="l00115"></a>00115    fprintf(stderr,<span class="stringliteral">&quot;%lf %lf %lf\r&quot;</span>,SLap,Hei,Angle);
<a name="l00116"></a>00116    <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a18ece2127f70c26ead73bc24856a5c57" title="Height of the cylinder.">Height</a> = Hei;
<a name="l00117"></a>00117    <a class="code" href="classForces.html#a774d65ef8685d2859fae66bad8c9b435" title="Prefactor of the forces.">Kf</a>.<a class="code" href="structKFORCES.html#a348745786658bd8382be1fd25066a309" title="Prefactor of the square laplacian.">SLap</a> = SLap;
<a name="l00118"></a>00118    <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a2c39c1efe4f21bf1103d46b0a4e8f5a9" title="Strength of the interaction.">Hamaker</a> = Angle;
<a name="l00119"></a>00119    <a class="code" href="classForces.html#a941bab4d0655ea3e774cd525e664be52" title="Solve a system of four oder differential equation.">Solve</a>();
<a name="l00120"></a>00120    <span class="keywordtype">int</span> c = 0;
<a name="l00121"></a>00121    <span class="keywordtype">double</span> Min = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(2);
<a name="l00122"></a>00122    <span class="keywordtype">double</span> Max = 0.;
<a name="l00123"></a>00123    <span class="keywordtype">double</span> xMin = 0.;
<a name="l00124"></a>00124    <span class="keywordtype">double</span> xMax = 0.;
<a name="l00125"></a>00125    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p = c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();p&lt;(c+1)*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();p++){
<a name="l00126"></a>00126      <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Pos[2] &gt; Max &amp;&amp; <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Typ == 0){
<a name="l00127"></a>00127        Max = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[2];
<a name="l00128"></a>00128        xMax = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[0];
<a name="l00129"></a>00129      }
<a name="l00130"></a>00130    }
<a name="l00131"></a>00131    c = 1;
<a name="l00132"></a>00132    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p = c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();p&lt;(c+1)*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();p++){
<a name="l00133"></a>00133      <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Pos[2] &lt; Min &amp;&amp; <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Typ == 0){
<a name="l00134"></a>00134        Min = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[2];
<a name="l00135"></a>00135        xMin = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[0];
<a name="l00136"></a>00136      }
<a name="l00137"></a>00137    }
<a name="l00138"></a>00138    fprintf(FWrite,<span class="stringliteral">&quot;%lf %lf %lf %lf %lf\n&quot;</span>,Hei/.2,Angle,(Min-Max)/.2,SLap,.5*(xMin+xMax)/.2);
<a name="l00139"></a>00139       }
<a name="l00140"></a>00140     }
<a name="l00141"></a>00141     fclose(FWrite);
<a name="l00142"></a>00142   }
<a name="l00143"></a>00143   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00144"></a>00144 }
<a name="l00145"></a><a class="code" href="classForces.html#a9ebbcc00e2ef112a3739e90118698f80">00145</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a9ebbcc00e2ef112a3739e90118698f80" title="Find the minimun bilayer thickness for different peptide sizes.">Forces::ExplorePepSize2d</a>(){
<a name="l00146"></a>00146   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Explore pep size 2d\n&quot;</span>);
<a name="l00147"></a>00147   <span class="keywordflow">if</span>(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a> != SYS_2D) return ;
<a name="l00148"></a>00148   <a class="code" href="classVarData.html#ac659e9234deb7729483b32fd9d6b5b30" title="Set Edge.">SetEdge</a>(.5*MIN(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(0),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(1)),3);
<a name="l00149"></a>00149   <span class="keywordtype">char</span> FName[120];
<a name="l00150"></a>00150   <span class="keywordtype">double</span> HeiMin = 0.2;
<a name="l00151"></a>00151   <span class="keywordtype">double</span> HeiMax = 4.2;
<a name="l00152"></a>00152   <span class="keywordtype">double</span> HeiStep = (HeiMax-HeiMin)/(<span class="keywordtype">double</span>)NGrid;
<a name="l00153"></a>00153   <span class="keywordtype">double</span> AngMin = 0.;
<a name="l00154"></a>00154   <span class="keywordtype">double</span> AngMax = 80.;
<a name="l00155"></a>00155   <span class="keywordtype">double</span> AngStep = (AngMax-AngMin)/(<span class="keywordtype">double</span>)NGrid;
<a name="l00156"></a>00156   <span class="keywordtype">double</span> InvNBin = 1./(double)NBin;
<a name="l00157"></a>00157   <a class="code" href="classVarData.html#acefa5842862d4587442db05af40e7490" title="Contains the definition of the file format.">SysFormat</a> = VAR_SYS_TXVL;
<a name="l00158"></a>00158   <span class="keywordflow">for</span>(<span class="keywordtype">double</span> Angle=AngMin;Angle&lt;AngMax;Angle+=AngStep){
<a name="l00159"></a>00159     <span class="keywordflow">for</span>(<span class="keywordtype">double</span> Hei=HeiMin;Hei&lt;HeiMax;Hei+=HeiStep){
<a name="l00160"></a>00160       fprintf(stderr,<span class="stringliteral">&quot;%lf %lf\r&quot;</span>,Hei,Angle);
<a name="l00161"></a>00161       <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a18ece2127f70c26ead73bc24856a5c57" title="Height of the cylinder.">Height</a> = Hei;
<a name="l00162"></a>00162       <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>-&gt;<a class="code" href="structNANO.html#a2c39c1efe4f21bf1103d46b0a4e8f5a9" title="Strength of the interaction.">Hamaker</a> = Angle;
<a name="l00163"></a>00163       <a class="code" href="classForces.html#a941bab4d0655ea3e774cd525e664be52" title="Solve a system of four oder differential equation.">Solve</a>();
<a name="l00164"></a>00164       sprintf(FName,<span class="stringliteral">&quot;Sol2dHei%.1fAng%02d.dat&quot;</span>,Hei,(<span class="keywordtype">int</span>)Angle);
<a name="l00165"></a>00165       <a class="code" href="classVarData.html#a054aab836dcf7735720ef32e0b8f7ecb" title="Writes a &quot;system-file&quot; or a &quot;x y z&quot; file".">Write</a>(FName);
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167   }
<a name="l00168"></a>00168   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00169"></a>00169 }
<a name="l00170"></a><a class="code" href="classForces.html#a3efc71eff5d768421c05dc9f9ef801d1">00170</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a3efc71eff5d768421c05dc9f9ef801d1" title="Find the minimum for different interpeptide distances.">Forces::ExploreDoubleMin</a>(){
<a name="l00171"></a>00171   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Explore pep size\n&quot;</span>);
<a name="l00172"></a>00172   <span class="keywordtype">char</span> String[120];
<a name="l00173"></a>00173   <span class="keywordflow">if</span>(<a class="code" href="classForces.html#abb0374374d00777fe085e4a163a0e9c5" title="Shape of system.">SysShape</a> != SYS_2D) <span class="keywordflow">return</span>;
<a name="l00174"></a>00174   <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#aef94681f570cacf1a76aac1512563f17" title="Number of nanoparticles.">pNNano</a>() &lt; 2) <span class="keywordflow">return</span>;
<a name="l00175"></a>00175   <span class="keywordtype">double</span> DistMin = <a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(1,0);
<a name="l00176"></a>00176   <span class="keywordtype">double</span> DistDelta = (<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(0)-<a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(1,0))/(<span class="keywordtype">double</span>)NGrid;
<a name="l00177"></a>00177   <span class="keywordtype">double</span> DeltaGrid = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(0)/(double)<a class="code" href="classForces.html#adcf19dc278dd27f0bba8cc1ae9375b4f" title="Number of particle per edge.">nEdge</a>[0];
<a name="l00178"></a>00178   <span class="comment">// DistDelta = floor(2.*DistDelta/DeltaGrid)*DeltaGrid;</span>
<a name="l00179"></a>00179   <span class="comment">// SigErr(DistDelta &lt;= 0.,&quot;The grid step is too short for %d distances &quot;,NGrid);</span>
<a name="l00180"></a>00180   <span class="keywordtype">char</span> FName[60];
<a name="l00181"></a>00181   FILE *FProf = fopen(<span class="stringliteral">&quot;DistThinMin.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00182"></a>00182   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;NGrid;i++){
<a name="l00183"></a>00183     fprintf(stderr,<span class="stringliteral">&quot;done %.2f %%\r&quot;</span>,100.*i/(<span class="keywordtype">double</span>)NGrid);
<a name="l00184"></a>00184     <a class="code" href="classForces.html#a1d4b4e62a626434fc48475224ab89dca" title="If the matrix has to be changed.">IfFillMatrix</a> = 1;
<a name="l00185"></a>00185     <a class="code" href="classForces.html#a941bab4d0655ea3e774cd525e664be52" title="Solve a system of four oder differential equation.">Solve</a>();
<a name="l00186"></a>00186     sprintf(FName,<span class="stringliteral">&quot;MinProf%03d.dat&quot;</span>,i);
<a name="l00187"></a>00187     FILE *FWrite = fopen(FName,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00188"></a>00188     <a class="code" href="classVarData.html#ab0cc3088657341d2696949515927e91c" title="String for the rigid inclusion in the header file.">StringNano</a>(String,0);
<a name="l00189"></a>00189     fprintf(FWrite,String);
<a name="l00190"></a>00190     <a class="code" href="classVarData.html#ab0cc3088657341d2696949515927e91c" title="String for the rigid inclusion in the header file.">StringNano</a>(String,1);
<a name="l00191"></a>00191     fprintf(FWrite,String);
<a name="l00192"></a>00192     <span class="keywordtype">double</span> Min = 100000.;
<a name="l00193"></a>00193     <span class="keywordtype">double</span> Dist = 0.;
<a name="l00194"></a>00194     <span class="keywordtype">double</span> zOld = 100000.;
<a name="l00195"></a>00195     <span class="keywordtype">int</span> IfContinue = 0;
<a name="l00196"></a>00196     <span class="keywordtype">int</span> nBin = 0;
<a name="l00197"></a>00197     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=<a class="code" href="classForces.html#adcf19dc278dd27f0bba8cc1ae9375b4f" title="Number of particle per edge.">nEdge</a>[1]/2+1;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p+=<a class="code" href="classForces.html#adcf19dc278dd27f0bba8cc1ae9375b4f" title="Number of particle per edge.">nEdge</a>[1]){
<a name="l00198"></a>00198       <span class="keywordtype">double</span> x = <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,0) - <a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(0,0);
<a name="l00199"></a>00199       <span class="keywordtype">double</span> z = <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,2);
<a name="l00200"></a>00200       <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c" title="Return the type.">pType</a>(p) == 1) z = <a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(0,2) + .5*<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[0].<a class="code" href="structNANO.html#a18ece2127f70c26ead73bc24856a5c57" title="Height of the cylinder.">Height</a>;
<a name="l00201"></a>00201       <span class="keywordflow">if</span>( x &gt; (<a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(1,0) - <a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(0,0) )) <span class="keywordflow">continue</span>;
<a name="l00202"></a>00202       fprintf(FWrite,<span class="stringliteral">&quot;%lf %lf\n&quot;</span>,x,z);
<a name="l00203"></a>00203       <span class="keywordflow">if</span>( x &gt; .6*(<a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(1,0) - <a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3" title="Return back folded nano position.">pNanoPos</a>(0,0) )) <span class="keywordflow">continue</span>;
<a name="l00204"></a>00204       <span class="keywordflow">if</span>(Min &gt; z){<span class="comment">// &amp;&amp; IfContinue){</span>
<a name="l00205"></a>00205    Min = z;
<a name="l00206"></a>00206    Dist = x;
<a name="l00207"></a>00207    nBin = p;
<a name="l00208"></a>00208       }
<a name="l00209"></a>00209       <span class="comment">// if(z &gt; zOld){IfContinue = 1;}</span>
<a name="l00210"></a>00210       <span class="comment">// zOld = z;</span>
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212     fprintf(FProf,<span class="stringliteral">&quot;%lf %lf %lf\n&quot;</span>,<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[1].Pos[0]-<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[0].Pos[0],Dist,Min);
<a name="l00213"></a>00213     fflush(FProf);
<a name="l00214"></a>00214     fclose(FWrite);
<a name="l00215"></a>00215     sprintf(FName,<span class="stringliteral">&quot;Sol2dDist%.3f.dat&quot;</span>,<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[1].Pos[0]-<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[0].Pos[0]);
<a name="l00216"></a>00216     <a class="code" href="classVarData.html#a76873542f36c8e36b790c90273c95cf1" title="Writes a &quot;system-file&quot; or a &quot;x y z&quot; file".">WriteTxvl</a>(FName);
<a name="l00217"></a>00217     <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[1].<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d" title="Position.">Pos</a>[0] += DistDelta;
<a name="l00218"></a>00218     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b" title="Extra particle.">Nano</a>[1].Pos[0] &gt; <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(0)) <span class="keywordflow">return</span>;
<a name="l00219"></a>00219   }
<a name="l00220"></a>00220   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00221"></a>00221   fclose(FProf);
<a name="l00222"></a>00222 }
<a name="l00223"></a><a class="code" href="classForces.html#abfa5f0b075c87a5ae914d91c5481c359">00223</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#abfa5f0b075c87a5ae914d91c5481c359" title="Build the widom histograms.">Forces::RunWidom</a>(<span class="keywordtype">char</span> *File2Open,<span class="keywordtype">int</span> f){
<a name="l00224"></a>00224   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Widom on particles\n&quot;</span>);
<a name="l00225"></a>00225   <span class="keywordtype">int</span> NInt = 10000;
<a name="l00226"></a>00226   <span class="keywordtype">double</span> NrgDiff = 0.;
<a name="l00227"></a>00227   <span class="keywordtype">char</span> File2Write[60];
<a name="l00228"></a>00228   sprintf(File2Write,<span class="stringliteral">&quot;WidomOut%05d.dat&quot;</span>,f);
<a name="l00229"></a>00229   <a class="code" href="classForces.html#a3f36144668126bc6bb1c682c5b10b300" title="Open a new file.">ReOpen</a>(File2Open,BF_PART);
<a name="l00230"></a>00230   FILE *WidomOut = fopen(File2Write,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00231"></a>00231   SigErr(WidomOut==NULL,<span class="stringliteral">&quot;Cannot allocate %s\n&quot;</span>,File2Write);
<a name="l00232"></a>00232   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00233"></a>00233     <a class="code" href="classForces.html#a85d825b7b4af29d476abbf098ce630e3" title="Widom removal.">WidomRemove</a>(&amp;NrgDiff,p);
<a name="l00234"></a>00234     fprintf(WidomOut,<span class="stringliteral">&quot;%lf\n&quot;</span>,NrgDiff);
<a name="l00235"></a>00235   }
<a name="l00236"></a>00236   fclose(WidomOut);
<a name="l00237"></a>00237   sprintf(File2Write,<span class="stringliteral">&quot;WidomIn%05d.dat&quot;</span>,f);
<a name="l00238"></a>00238   FILE *WidomIn = fopen(File2Write,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00239"></a>00239   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;NInt;p++){
<a name="l00240"></a>00240     <a class="code" href="classForces.html#af9eda9a781eabd31a8813c9a64f2d5ec" title="Widom insertion.">WidomInsert</a>(&amp;NrgDiff);
<a name="l00241"></a>00241     fprintf(WidomIn,<span class="stringliteral">&quot;%lf\n&quot;</span>,NrgDiff);
<a name="l00242"></a>00242   }
<a name="l00243"></a>00243   fclose(WidomIn);
<a name="l00244"></a>00244 }
<a name="l00245"></a><a class="code" href="classForces.html#a3f16bbc64bdd8ac4835e6a4702e30678">00245</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a3f16bbc64bdd8ac4835e6a4702e30678" title="Rosenbluth weights for insertion.">Forces::RosenIn</a>(FILE *WidomIn){
<a name="l00246"></a>00246   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Widom insertion biased/Rosenbluth\n&quot;</span>);
<a name="l00247"></a>00247   <span class="keywordtype">int</span> NInt = 10000;
<a name="l00248"></a>00248   <span class="keywordtype">double</span> Weight = 0.;
<a name="l00249"></a>00249   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;NInt;p++){
<a name="l00250"></a>00250     <a class="code" href="classForces.html#af07ae7761f13798c6de1391b10c5856d" title="Widom with Rosenbluth weight.">WidomBiasChIn</a>(&amp;Weight);
<a name="l00251"></a>00251     fprintf(WidomIn,<span class="stringliteral">&quot;%g\n&quot;</span>,Weight);
<a name="l00252"></a>00252   }
<a name="l00253"></a>00253 }
<a name="l00254"></a><a class="code" href="classForces.html#a7a1566050eaabfebba82e0b6002d797b">00254</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a7a1566050eaabfebba82e0b6002d797b" title="Rosenbluth histograms for deletion.">Forces::RosenOut</a>(FILE *WidomIn){
<a name="l00255"></a>00255   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Widom deletion biased/Rosenbluth\n&quot;</span>);
<a name="l00256"></a>00256   <span class="keywordtype">int</span> NInt = 10000;
<a name="l00257"></a>00257   <span class="keywordtype">double</span> Weight = 0.;
<a name="l00258"></a>00258   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++){
<a name="l00259"></a>00259     <a class="code" href="classForces.html#ab249c91e15e3611167002159ef6d5b60" title="Widom with Rosenbluth weight.">WidomBiasChOut</a>(&amp;Weight,c);
<a name="l00260"></a>00260     fprintf(WidomIn,<span class="stringliteral">&quot;%g\n&quot;</span>,Weight);
<a name="l00261"></a>00261   }
<a name="l00262"></a>00262 }
<a name="l00263"></a><a class="code" href="classForces.html#ac313c324785f5c7c044e2e94ea39c01c">00263</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#ac313c324785f5c7c044e2e94ea39c01c" title="Build the widom histograms.">Forces::RunWidomChIn</a>(<span class="keywordtype">char</span> *File2Open,<span class="keywordtype">int</span> f){
<a name="l00264"></a>00264   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Widom chain in\n&quot;</span>);
<a name="l00265"></a>00265   <span class="keywordtype">int</span> NInt = 5*<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();
<a name="l00266"></a>00266   <span class="keywordtype">double</span> NrgDiff[3];
<a name="l00267"></a>00267   <span class="keywordtype">char</span> File2Write[60];
<a name="l00268"></a>00268   <a class="code" href="classForces.html#a3f36144668126bc6bb1c682c5b10b300" title="Open a new file.">ReOpen</a>(File2Open,BF_PART);
<a name="l00269"></a>00269   sprintf(File2Write,<span class="stringliteral">&quot;WidomIn%05d.dat&quot;</span>,f);
<a name="l00270"></a>00270   FILE *WidomIn = fopen(File2Write,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00271"></a>00271   <span class="comment">//StudySys();</span>
<a name="l00272"></a>00272   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;NInt;p++){
<a name="l00273"></a>00273     <a class="code" href="classVarData.html#aaa11921d5205a7db714c4f733065b710" title="Increment Step.">IncrStep</a>();
<a name="l00274"></a>00274     <a class="code" href="classForces.html#acffb530559d4e3ebfac6481a46468f52" title="Widom insertion.">WidomInsertCh</a>(NrgDiff);
<a name="l00275"></a>00275     fprintf(WidomIn ,<span class="stringliteral">&quot;%lf\n&quot;</span>,NrgDiff[2]);
<a name="l00276"></a>00276   }
<a name="l00277"></a>00277   fclose(WidomIn);
<a name="l00278"></a>00278 }
<a name="l00279"></a><a class="code" href="classForces.html#a6c88528ae5cf46ad5cc7080ca47ef1fb">00279</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a6c88528ae5cf46ad5cc7080ca47ef1fb" title="Build the widom histograms.">Forces::RunWidomChOut</a>(<span class="keywordtype">char</span> *File2Open,<span class="keywordtype">int</span> f){
<a name="l00280"></a>00280   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Widom chain out\n&quot;</span>);
<a name="l00281"></a>00281   <span class="keywordtype">double</span> NrgDiff[3];
<a name="l00282"></a>00282   <span class="keywordtype">char</span> File2Write[60];
<a name="l00283"></a>00283   sprintf(File2Write,<span class="stringliteral">&quot;WidomOut%05d.dat&quot;</span>,f);
<a name="l00284"></a>00284   <a class="code" href="classForces.html#a3f36144668126bc6bb1c682c5b10b300" title="Open a new file.">ReOpen</a>(File2Open,BF_PART);
<a name="l00285"></a>00285   FILE *WidomOut = fopen(File2Write,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00286"></a>00286   <a class="code" href="classForces.html#a59c5e973ca9b852115683c3cc2fc6035" title="Calculate and sum up the energy of the chains.">CalcTotNrgCh</a>();
<a name="l00287"></a>00287   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++){
<a name="l00288"></a>00288     <a class="code" href="classForces.html#a0ab84cf7b372ab5ae21966ed671ee4c3" title="Widom removal.">WidomRemoveCh</a>(NrgDiff,c);
<a name="l00289"></a>00289     fprintf(WidomOut,<span class="stringliteral">&quot;%lf\n&quot;</span>,NrgDiff[2]);
<a name="l00290"></a>00290   }
<a name="l00291"></a>00291   fclose(WidomOut);
<a name="l00292"></a>00292 }
<a name="l00293"></a><a class="code" href="classForces.html#aa82709db8e55cc620cfbfb483489f5b6">00293</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#aa82709db8e55cc620cfbfb483489f5b6" title="Total energy of the system.">Forces::CalcTotNrg</a>(<span class="keywordtype">char</span> *File2Open,<span class="keywordtype">int</span> f){
<a name="l00294"></a>00294   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Calculating total energy\n&quot;</span>);
<a name="l00295"></a>00295   <a class="code" href="classForces.html#a3f36144668126bc6bb1c682c5b10b300" title="Open a new file.">ReOpen</a>(File2Open,BF_PART);
<a name="l00296"></a>00296   <span class="keywordtype">double</span> NrgNb = 0.;
<a name="l00297"></a>00297   <span class="keywordtype">double</span> NrgSpr = 0.;
<a name="l00298"></a>00298   <span class="keywordtype">double</span> NrgSpr2 = 0.;
<a name="l00299"></a>00299   <span class="keywordtype">double</span> NrgBend = 0.;
<a name="l00300"></a>00300   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++){
<a name="l00301"></a>00301     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>();p&lt;(c+1)*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>()-1;p++){
<a name="l00302"></a>00302       <span class="keywordtype">double</span> DistBA[3];
<a name="l00303"></a>00303       <span class="keywordtype">double</span> DistCB[3];
<a name="l00304"></a>00304       <span class="keywordtype">double</span> DistBA2 = 0.;
<a name="l00305"></a>00305       <span class="keywordtype">double</span> DistCB2 = 0.;
<a name="l00306"></a>00306       <span class="keywordtype">double</span> CosAngle = 0.;
<a name="l00307"></a>00307       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00308"></a>00308    DistBA[d] = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d] - <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p-1].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d];
<a name="l00309"></a>00309    DistBA[d] -= floor(DistBA[d]/(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d)) + .5)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d);
<a name="l00310"></a>00310    DistCB[d] = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p+1].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d] - <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d];
<a name="l00311"></a>00311    DistCB[d] -= floor(DistCB[d]/(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d)) + .5)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d);
<a name="l00312"></a>00312    DistBA2 += SQR(DistBA[d]);
<a name="l00313"></a>00313    DistCB2 += SQR(DistCB[d]);
<a name="l00314"></a>00314    CosAngle += DistBA[d]*DistCB[d];
<a name="l00315"></a>00315       }
<a name="l00316"></a>00316       DistCB2 = sqrt(DistCB2);
<a name="l00317"></a>00317       NrgSpr += .5*<a class="code" href="classVarData.html#a16f3b01ba84886cbaf53fa1238c434f3" title="Spring coupling.">pkSpr</a>()*SQR(DistCB2 - <a class="code" href="classVarData.html#ad180facca71ad48ae3ce77052bf22957" title="Rest distance of the harmonic potential.">pSprRest</a>());
<a name="l00318"></a>00318       <span class="keywordflow">if</span>(p == c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>()) <span class="keywordflow">continue</span>;
<a name="l00319"></a>00319       DistBA2 = sqrt(DistBA2);
<a name="l00320"></a>00320       CosAngle /= (DistBA2*DistCB2);
<a name="l00321"></a>00321       NrgBend += <a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371" title="Bending coupling.">pkBen</a>()*(1.-CosAngle);
<a name="l00322"></a>00322    }
<a name="l00323"></a>00323   }
<a name="l00324"></a>00324   <span class="keywordtype">double</span> NrgNano = 0.;
<a name="l00325"></a>00325   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00326"></a>00326     NrgNano += <a class="code" href="classForces.html#a7ab5c0bcf11c3f33530a25984720b424" title="Exchange energy with the nano.">NanoNrg</a>(p);
<a name="l00327"></a>00327   }
<a name="l00328"></a>00328   <a class="code" href="classForces.html#a59c5e973ca9b852115683c3cc2fc6035" title="Calculate and sum up the energy of the chains.">CalcTotNrgCh</a>();
<a name="l00329"></a>00329   printf(<span class="stringliteral">&quot;Nb %lf + Nano %lf = %lf Spr %lf + Ben %lf = %lf\n&quot;</span>,OldNrgSys,NrgNano,OldNrgSys+NrgNano,NrgSpr,NrgBend,NrgSpr+NrgBend);
<a name="l00330"></a>00330   fprintf(StatFile1,<span class="stringliteral">&quot;%d %lf %lf %lf %lf\n&quot;</span>,f,OldNrgSys,NrgSpr,NrgBend,NrgNano);
<a name="l00331"></a>00331   fflush(StatFile1);
<a name="l00332"></a>00332 }
<a name="l00333"></a><a class="code" href="classForces.html#a6a491826bd0df50e5d4941710783a54c">00333</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a6a491826bd0df50e5d4941710783a54c" title="Exchange energy of the protein.">Forces::CalcNrgPep</a>(<span class="keywordtype">char</span> *File2Open,<span class="keywordtype">int</span> f){
<a name="l00334"></a>00334   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Calculating total energy\n&quot;</span>);
<a name="l00335"></a>00335   <a class="code" href="classForces.html#a3f36144668126bc6bb1c682c5b10b300" title="Open a new file.">ReOpen</a>(File2Open,BF_PART);
<a name="l00336"></a>00336   <a class="code" href="classForces.html#a9d4e2ba1cf8ce2142f50a1b7e8bf4f7b" title="Add the densities connected with the particles between pInit and pEnd.">AddDens</a>(0,<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>());
<a name="l00337"></a>00337   OldNrgSys = <a class="code" href="classForces.html#a0449e9410bf23ad4d073f1eab66c2a68" title="Sum the local density for the particles between pInit and pEnd and multiply the factors by the virial...">SumDens</a>(0,<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>());  
<a name="l00338"></a>00338   <a class="code" href="classForces.html#a0390d97ed1665851fb6175342d1c598b" title="Set the local densities to zero.">ClearDens</a>();
<a name="l00339"></a>00339   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0,NPep=0,cOff=0,pOff=0;b&lt;<a class="code" href="classVarData.html#a474ffd5306304ac53eb7ef48a18e511d" title="Number of blocks.">pNBlock</a>();cOff+=<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>(b++)){
<a name="l00340"></a>00340     <span class="keywordflow">if</span>(!strncmp(<a class="code" href="classVarData.html#ab8ead2169b1b4894b78fd3c264b6009e" title="Information for every block.">Block</a>[b].Name,<span class="stringliteral">&quot;PEP&quot;</span>,3)){
<a name="l00341"></a>00341       <span class="keywordflow">continue</span>;
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=cOff;c&lt;cOff+<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>(b);c++,pOff+=<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>(b)){
<a name="l00344"></a>00344       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=pOff,link=0;p&lt;MIN(pOff+<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f" title="Number of particle per chain.">pNPCh</a>(b),<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>());p++){
<a name="l00345"></a>00345    <a class="code" href="classForces.html#a9d4e2ba1cf8ce2142f50a1b7e8bf4f7b" title="Add the densities connected with the particles between pInit and pEnd.">AddDens</a>(p,p+1);
<a name="l00346"></a>00346       }
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348   }
<a name="l00349"></a>00349   <span class="keywordtype">double</span> NrgPep = OldNrgSys - <a class="code" href="classForces.html#a0449e9410bf23ad4d073f1eab66c2a68" title="Sum the local density for the particles between pInit and pEnd and multiply the factors by the virial...">SumDens</a>(0,<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>());  
<a name="l00350"></a>00350   printf(<span class="stringliteral">&quot;Nrg pep %lf\n&quot;</span>,NrgPep);
<a name="l00351"></a>00351   fprintf(StatFile1,<span class="stringliteral">&quot;%d %lf %lf\n&quot;</span>,f,NrgPep,OldNrgSys);
<a name="l00352"></a>00352   fflush(StatFile1);
<a name="l00353"></a>00353 }
<a name="l00354"></a><a class="code" href="classForces.html#aac83d4bd108ccaa2c52289f05ea0d009">00354</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a69a4a0318fb6e0382d6e2288a40c9e98" title="Calculate the forces for the tension profile.">Forces::CalcTens</a>(<span class="keywordtype">char</span> **argv,<span class="keywordtype">int</span> *FilePos,<span class="keywordtype">int</span> NFile){
<a name="l00355"></a>00355   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Calculating tension\n&quot;</span>);
<a name="l00356"></a>00356   <a class="code" href="classForces.html#ac6a2e2465107cd1b6eea81aeb80646c2" title="Alloc the pressure profile.">AllocTens</a>();
<a name="l00357"></a>00357   <span class="keywordtype">char</span> FName[60];
<a name="l00358"></a>00358   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=0;f&lt;<a class="code" href="classForces.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>;f++){
<a name="l00359"></a>00359     fprintf(stderr,<span class="stringliteral">&quot;Elaborating file %s %.3f %%\r&quot;</span>,argv[FilePos[f]],f/(<span class="keywordtype">double</span>)NFile*100.);
<a name="l00360"></a>00360     <a class="code" href="classForces.html#a3f36144668126bc6bb1c682c5b10b300" title="Open a new file.">ReOpen</a>(argv[FilePos[f]],BF_PART);
<a name="l00361"></a>00361     <a class="code" href="classForces.html#a69a4a0318fb6e0382d6e2288a40c9e98" title="Calculate the forces for the tension profile.">CalcTens</a>();
<a name="l00362"></a>00362     <a class="code" href="classForces.html#a44c4bed1843e51f20f252a5dd05f64fe" title="Calculate the densities.">CalcDens</a>();
<a name="l00363"></a>00363     <span class="keywordflow">if</span>( !(f%(<a class="code" href="classForces.html#adcaf21deb47f48c1e25997f52ebd09d6" title="How many timesteps before write the snapshot.">NWrite</a>)) ){
<a name="l00364"></a>00364       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a" title="Structure for the pressure calculation.">Tens</a>.<a class="code" href="structTENS.html#a5a9396ca53c5306c34eb62ef4f02593b" title="# of components">NComp</a>;c++){
<a name="l00365"></a>00365    <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a" title="Structure for the pressure calculation.">Tens</a>.<a class="code" href="structTENS.html#ae7fd260630480928a069e7e536739df1" title="Calculation mode.">CalcMode</a>,CALC_2d))
<a name="l00366"></a>00366      sprintf(FName,<span class="stringliteral">&quot;Tension2d%05dL%d.dat&quot;</span>,f,c);
<a name="l00367"></a>00367    <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a" title="Structure for the pressure calculation.">Tens</a>.<a class="code" href="structTENS.html#ae7fd260630480928a069e7e536739df1" title="Calculation mode.">CalcMode</a>,CALC_3d))
<a name="l00368"></a>00368      sprintf(FName,<span class="stringliteral">&quot;Tension3d%05dL%d.dat&quot;</span>,f,c);
<a name="l00369"></a>00369    <a class="code" href="classForces.html#a0bd0430e9512fea0edf8d3cc157f6e7f" title="Write the pressure and density profile.">WriteTens</a>(FName,c,1./(<span class="keywordtype">double</span>)NFile);
<a name="l00370"></a>00370       }
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372   }
<a name="l00373"></a>00373   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00374"></a>00374 }
<a name="l00375"></a><a class="code" href="classForces.html#acf39045486a7e38d437f191e2a845d83">00375</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#acf39045486a7e38d437f191e2a845d83" title="Average of the forces.">Forces::AvForces</a>(<span class="keywordtype">char</span> **argv,<span class="keywordtype">int</span> *FilePos,<span class="keywordtype">int</span> NFile){
<a name="l00376"></a>00376   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;Calculating force field/average force\n&quot;</span>);
<a name="l00377"></a>00377   <a class="code" href="classForces.html#ac6a2e2465107cd1b6eea81aeb80646c2" title="Alloc the pressure profile.">AllocTens</a>();
<a name="l00378"></a>00378   <span class="keywordtype">char</span> FName[60];
<a name="l00379"></a>00379   <span class="keyword">const</span> <span class="keywordtype">int</span> NBin = 120;
<a name="l00380"></a>00380   <span class="keywordtype">double</span> *Profile = (<span class="keywordtype">double</span> *)calloc(3*NBin,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00381"></a>00381   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> f=0;f&lt;<a class="code" href="classForces.html#afc36f5ebb0ee5c1be5fc2161e1fa3959" title="First and last file of the list.">NFile</a>;f++){
<a name="l00382"></a>00382     fprintf(stderr,<span class="stringliteral">&quot;Elaborating file %s %.3f %%\r&quot;</span>,argv[FilePos[f]],f/(<span class="keywordtype">double</span>)NFile*100.);
<a name="l00383"></a>00383     <a class="code" href="classForces.html#a3f36144668126bc6bb1c682c5b10b300" title="Open a new file.">ReOpen</a>(argv[FilePos[f]],BF_PART);
<a name="l00384"></a>00384     <a class="code" href="classForces.html#a5c32ef207ba714e72e72de3063860b39" title="Calculate the forces for the density functional.">CalcForcesDensFunc</a>();
<a name="l00385"></a>00385     FILE *FForce = fopen(<span class="stringliteral">&quot;ForceProfile.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00386"></a>00386     <span class="keywordtype">double</span> Force[3] = {0.,0.,0.};
<a name="l00387"></a>00387     <span class="keywordtype">int</span> cBin[3];
<a name="l00388"></a>00388     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00389"></a>00389       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00390"></a>00390    cBin[d] = (int)(<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Pos[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(d)*NBin);
<a name="l00391"></a>00391    <span class="keywordflow">if</span>(cBin[d] &lt; 0 || cBin[d] &gt;= NBin) <span class="keywordflow">continue</span>;
<a name="l00392"></a>00392    Profile[cBin[d]*3+d] += <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3" title="Array containing the forces for each particle.">Fm</a>[p].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba" title="Direction.">Dir</a>[d];
<a name="l00393"></a>00393    Force[d] += <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3" title="Array containing the forces for each particle.">Fm</a>[p].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba" title="Direction.">Dir</a>[d];
<a name="l00394"></a>00394    fprintf(FForce,<span class="stringliteral">&quot;%d %g %g %g\n&quot;</span>,p,Force[0],Force[1],Force[2]);
<a name="l00395"></a>00395       }
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397     printf(<span class="stringliteral">&quot;%g %g %g\n&quot;</span>,Force[0],Force[1],Force[2]);
<a name="l00398"></a>00398     fclose(FForce);
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400   FILE *FProf = fopen(<span class="stringliteral">&quot;ForceProfile.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00401"></a>00401   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0;b&lt;NBin;b++){
<a name="l00402"></a>00402     fprintf(FProf,<span class="stringliteral">&quot;%d %lf %lf %lf\n&quot;</span>,b,Profile[b*3],Profile[b*3+1],Profile[b*3+2]);
<a name="l00403"></a>00403   }
<a name="l00404"></a>00404   FILE *FField = fopen(<span class="stringliteral">&quot;ForceField.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00405"></a>00405   <span class="keywordtype">double</span> Delta = sqrt(<a class="code" href="classForces.html#a774d65ef8685d2859fae66bad8c9b435" title="Prefactor of the forces.">Kf</a>.<a class="code" href="structKFORCES.html#ac448df5dbfd256324893075200dace49" title="CutOff of the lennard jones.">CutOff2</a>)/(double)NTab;
<a name="l00406"></a>00406   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0;b&lt;NTab;b++){
<a name="l00407"></a>00407     <span class="keywordtype">double</span> x = b*Delta;
<a name="l00408"></a>00408     fprintf(FField,<span class="stringliteral">&quot;%lf &quot;</span>,x);
<a name="l00409"></a>00409     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t1=0;t1&lt;<a class="code" href="classVarData.html#a6496acd0cba8289e8306507336dd2f88" title="# of types of the particle">pNType</a>();t1++){
<a name="l00410"></a>00410       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t2=0;t2&lt;<a class="code" href="classVarData.html#a6496acd0cba8289e8306507336dd2f88" title="# of types of the particle">pNType</a>();t2++){
<a name="l00411"></a>00411    fprintf(FField,<span class="stringliteral">&quot;%lf &quot;</span>,FTab[(b*<a class="code" href="classVarData.html#a6496acd0cba8289e8306507336dd2f88" title="# of types of the particle">pNType</a>()+t1)*<a class="code" href="classVarData.html#a6496acd0cba8289e8306507336dd2f88" title="# of types of the particle">pNType</a>()+t2]);
<a name="l00412"></a>00412       }
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414     fprintf(FField,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00415"></a>00415   }
<a name="l00416"></a>00416   free(Profile);
<a name="l00417"></a>00417   fclose(FProf);
<a name="l00418"></a>00418   fclose(FField);
<a name="l00419"></a>00419   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00420"></a>00420 }
<a name="l00421"></a><a class="code" href="classForces.html#af662b8c150e7cdd3983066e8dab609be">00421</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#af662b8c150e7cdd3983066e8dab609be" title="Perform a operation every time step.">Forces::Task</a>(){
<a name="l00422"></a>00422   <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ab3f89c2d946d9c242d3d6061ae17ae78" title="Which arrays are allocated.">SysAlloc</a>,ALL_MC)){
<a name="l00423"></a>00423     <span class="keywordflow">return</span>;
<a name="l00424"></a>00424     <span class="keywordflow">if</span>((<a class="code" href="classVarData.html#acf2e386d659b56caeceb504cd74e90e0" title="Number of steps.">pStep</a>()%<a class="code" href="classForces.html#ab8c3546f48b68bd8fa59174d8a5afa97" title="How many timesteps before redrawing.">NUpdate</a>)!=0) <span class="keywordflow">return</span>;
<a name="l00425"></a>00425     OldNrgSys = 0.;
<a name="l00426"></a>00426     <span class="keywordtype">double</span> Pot[3];
<a name="l00427"></a>00427     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2" title="Number of chain.">pNChain</a>();c++) OldNrgSys += <a class="code" href="classForces.html#ac028948e0862f18bf805f23078ebf7fa" title="Pointer to the chain energy function.">CalcNrgCh</a>(c,Pot);
<a name="l00428"></a>00428     <span class="comment">//fprintf(TempFile,&quot;%d %d %lf \n&quot;,pStep(),pNChain(),NrgSys/(double)pNChain());</span>
<a name="l00429"></a>00429     <span class="comment">//fprintf(StatFile1,&quot;%d %d %lf \n&quot;,pStep(),pNChain(),OldNrgSys/(double)pNChain());</span>
<a name="l00430"></a>00430     <span class="comment">//fflush(StatFile1);</span>
<a name="l00431"></a>00431     <span class="comment">// int c = 0;//p%pNPCh();</span>
<a name="l00432"></a>00432     <span class="comment">// double Pot[3];</span>
<a name="l00433"></a>00433     <span class="comment">// CalcNrgCh(c,Pot);</span>
<a name="l00434"></a>00434     <span class="comment">// for(int e=0;e&lt;3;e++) OldNrgCh[c*3+e] = Pot[e];</span>
<a name="l00435"></a>00435     <span class="comment">// double Dist[4];</span>
<a name="l00436"></a>00436     <span class="comment">// TwoPartDist(0,pNPCh()-1,Dist);</span>
<a name="l00437"></a>00437     <span class="comment">// fprintf(TempFile,&quot;%d %lf %lf %lf %lf\n&quot;,pStep(),OldNrgCh[3*0],OldNrgCh[3*0+1],OldNrgCh[3*0+2],Dist[3]);</span>
<a name="l00438"></a>00438   }
<a name="l00439"></a>00439   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ab3f89c2d946d9c242d3d6061ae17ae78" title="Which arrays are allocated.">SysAlloc</a>,ALL_MD)){
<a name="l00440"></a>00440     <span class="keywordflow">if</span>( !(<a class="code" href="classVarData.html#acf2e386d659b56caeceb504cd74e90e0" title="Number of steps.">pStep</a>()%<a class="code" href="classForces.html#ab8c3546f48b68bd8fa59174d8a5afa97" title="How many timesteps before redrawing.">NUpdate</a>) ){
<a name="l00441"></a>00441       <span class="keywordtype">double</span> v2 = 0.;
<a name="l00442"></a>00442       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00443"></a>00443    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00444"></a>00444      v2 += SQR(<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Vel[d]);
<a name="l00445"></a>00445    }
<a name="l00446"></a>00446       }
<a name="l00447"></a>00447       <span class="comment">//fprintf(StatFile1,&quot;%d %lf %lf\n&quot;,pStep(),v2/(double)(3*pNPart()),OldNrgSys);</span>
<a name="l00448"></a>00448       <span class="comment">//fflush(StatFile1);</span>
<a name="l00449"></a>00449     }
<a name="l00450"></a>00450   }
<a name="l00451"></a>00451 }
<a name="l00452"></a><a class="code" href="classForces.html#a38ef42f2e70e5ed764a0fa0d56757a57">00452</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a38ef42f2e70e5ed764a0fa0d56757a57" title="Trial loop.">Forces::Trial</a>(){
<a name="l00453"></a>00453   <a class="code" href="classForces.html#a419ca9dee6d5e955abe44cf409e24d66" title="Check the pair list.">CheckPairList</a>();
<a name="l00454"></a>00454 }
<a name="l00455"></a><a class="code" href="classForces.html#aadef342da0e2abb136031d2df4c264bf">00455</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#aadef342da0e2abb136031d2df4c264bf" title="Run a step further.">Forces::RunDynamics</a>(){
<a name="l00456"></a>00456   <a class="code" href="classForces.html#ac11429f7ec42e6eb4806e77f8aa24e7f" title="Internal message.">Shout</a>(<span class="stringliteral">&quot;run dynamics\n&quot;</span>);
<a name="l00457"></a>00457   <span class="keywordtype">double</span> NLoopSec = 0.;
<a name="l00458"></a>00458   <span class="keywordtype">char</span> FileName[60];
<a name="l00459"></a>00459   <a class="code" href="classForces.html#ad7e01b1bd04ce252d991ae872eaa5270" title="Define the parameters for calculating the force.">DefForceParam</a>();
<a name="l00460"></a>00460   <span class="comment">//MinimalNrg();</span>
<a name="l00461"></a>00461   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0;s&lt;<a class="code" href="classForces.html#afa426c87de325a8eb41e1f2a29485003" title="Maximum number of time steps.">SimLimit</a>;s++){
<a name="l00462"></a>00462     <a class="code" href="classForces.html#a338adbdaecf3f72150ce3e88ec710bf1" title="Sum up all the forces and update the positions.">Dynamics</a>();
<a name="l00463"></a>00463     <span class="comment">//MinimalMD();</span>
<a name="l00464"></a>00464     <span class="keywordflow">if</span>( !(s%<a class="code" href="classForces.html#ab8c3546f48b68bd8fa59174d8a5afa97" title="How many timesteps before redrawing.">NUpdate</a>) ){
<a name="l00465"></a>00465       CurrTime = time(NULL);
<a name="l00466"></a>00466       NLoopSec += (s)/(<span class="keywordtype">double</span>)(CurrTime-InitTime);
<a name="l00467"></a>00467       <span class="keywordtype">double</span> Temp = 0.;
<a name="l00468"></a>00468       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00469"></a>00469    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00470"></a>00470      Temp += SQR(<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Vel[d]);
<a name="l00471"></a>00471    }
<a name="l00472"></a>00472       }
<a name="l00473"></a>00473       Temp = Temp/(double)(3*<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>());
<a name="l00474"></a>00474       fprintf(stderr,<span class="stringliteral">&quot;NPart %d loop/ms %.3g acc/step %.3f in/out %.4f T %.4f accomplished %.3f %% Nrg %lf\n&quot;</span>,<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>(),NLoopSec,(<a class="code" href="classForces.html#aeeef7711986a24838884d8ef8c12f4ae" title="Count accepted moves.">NRemoval</a>+<a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a>)/(<span class="keywordtype">double</span>)s,<a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a>/(<span class="keywordtype">double</span>)<a class="code" href="classForces.html#aeeef7711986a24838884d8ef8c12f4ae" title="Count accepted moves.">NRemoval</a>,Temp,s/(<span class="keywordtype">double</span>)(SimLimit)*100.,OldNrgSys);
<a name="l00475"></a>00475       fprintf(StatFile1,<span class="stringliteral">&quot;%d %lf %lf\n&quot;</span>,s,OldNrgSys,Temp);
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477     <span class="keywordflow">if</span>( !(s%(<a class="code" href="classForces.html#adcaf21deb47f48c1e25997f52ebd09d6" title="How many timesteps before write the snapshot.">NWrite</a>)) ){
<a name="l00478"></a>00478       sprintf(FileName,<span class="stringliteral">&quot;Trajectory%09d.dat&quot;</span>,<a class="code" href="classVarData.html#acf2e386d659b56caeceb504cd74e90e0" title="Number of steps.">pStep</a>());
<a name="l00479"></a>00479       <a class="code" href="classVarData.html#a054aab836dcf7735720ef32e0b8f7ecb" title="Writes a &quot;system-file&quot; or a &quot;x y z&quot; file".">Write</a>(FileName);
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481   }
<a name="l00482"></a>00482   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00483"></a>00483   CurrTime = time(NULL);
<a name="l00484"></a>00484   NLoopSec += (<a class="code" href="classForces.html#afa426c87de325a8eb41e1f2a29485003" title="Maximum number of time steps.">SimLimit</a>)/(<span class="keywordtype">double</span>)(CurrTime-InitTime);
<a name="l00485"></a>00485   <span class="keywordtype">double</span> v2 = 0.;
<a name="l00486"></a>00486   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00487"></a>00487     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00488"></a>00488       v2 += SQR(<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Vel[d]);
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490   }
<a name="l00491"></a>00491   fprintf(StatFile1,<span class="stringliteral">&quot;##NPart %d loop/ms %.3g acc/step %.3f in/out %.4f T %.4f accomplished Nrg %lf\r&quot;</span>,<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>(),NLoopSec,(<a class="code" href="classForces.html#aeeef7711986a24838884d8ef8c12f4ae" title="Count accepted moves.">NRemoval</a>+<a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a>)/(<span class="keywordtype">double</span>)<a class="code" href="classVarData.html#acf2e386d659b56caeceb504cd74e90e0" title="Number of steps.">pStep</a>(),<a class="code" href="classForces.html#ae1da38d5d966b9236ebd3641d103546d" title="Count accepted moves.">NInsertion</a>/(<span class="keywordtype">double</span>)<a class="code" href="classForces.html#aeeef7711986a24838884d8ef8c12f4ae" title="Count accepted moves.">NRemoval</a>,v2/(<span class="keywordtype">double</span>)(3*<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>()),OldNrgSys);
<a name="l00492"></a>00492 }
<a name="l00493"></a><a class="code" href="classForces.html#a8f18498c3494e8fe2476f90f9631c6a8">00493</a> <span class="keywordtype">double</span> <a class="code" href="classForces.html#a8f18498c3494e8fe2476f90f9631c6a8" title="Minmal nrg.">Forces::MinimalNrg</a>(){
<a name="l00494"></a>00494   <span class="keywordtype">double</span> Pos[3];
<a name="l00495"></a>00495   <span class="keywordtype">double</span> Pot[3];
<a name="l00496"></a>00496   <span class="keywordtype">double</span> DistRel[4];
<a name="l00497"></a>00497   OldNrgSys = 0.;
<a name="l00498"></a>00498   <a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051" title="Pair list.">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a98ae2e78109ea826eea71da14c37ce95" title="Erase the pairlist.">Erase</a>();
<a name="l00499"></a>00499   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){<a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5" title="Return back folded position.">pPos</a>(p,Pos);<a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051" title="Pair list.">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a9a64ea1512bb8d62f9f6a7a80a2bfec9" title="Add a particle to the cell c.">AddPart</a>(p,Pos);}
<a name="l00500"></a>00500   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p1=0;p1&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p1++){
<a name="l00501"></a>00501     <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ab3f89c2d946d9c242d3d6061ae17ae78" title="Which arrays are allocated.">SysAlloc</a>,ALL_FORCES)){
<a name="l00502"></a>00502       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++) <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3" title="Array containing the forces for each particle.">Fm</a>[p1].Dir[d] = 0.;
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504     <span class="keywordflow">for</span>(<a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051" title="Pair list.">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a74b7b0d716684a7d46993c83795fd9e7" title="Gather information of the neighbouring cells.">SetCurr</a>(p1);<a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051" title="Pair list.">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a63c5d18d3a487d1a8ab2a5881c6acb38" title="Tell when the curr loop is over.">IfCurr</a>();<a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051" title="Pair list.">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a42eeb7049c078ca89057fbc08726eded" title="Increase the iterator to the next couple.">NextCurr</a>()){
<a name="l00505"></a>00505       <span class="keywordtype">int</span> p2 = <a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051" title="Pair list.">Pc</a>-&gt;<a class="code" href="classDomDecBasics.html#a28d65a777a97b96280ca0f9173c76c93" title="Current particle.">p2Curr</a>;
<a name="l00506"></a>00506       <span class="keywordflow">if</span>(p2 &lt;= p1) <span class="keywordflow">continue</span>;
<a name="l00507"></a>00507       <a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051" title="Pair list.">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#ad4860e7b4a26d4b424e5c98b7c6bae09" title="Retrun the squared current interparticle distance.">Dist2Curr</a>(DistRel);
<a name="l00508"></a>00508       <span class="keywordflow">if</span>(DistRel[3] &gt; <a class="code" href="classForces.html#a774d65ef8685d2859fae66bad8c9b435" title="Prefactor of the forces.">Kf</a>.<a class="code" href="structKFORCES.html#ac448df5dbfd256324893075200dace49" title="CutOff of the lennard jones.">CutOff2</a>) <span class="keywordflow">continue</span>;
<a name="l00509"></a>00509       <span class="keywordtype">double</span> Cons = <a class="code" href="classForces.html#ac5ef477f97601b779392b8622ac6b1fe" title="Pointer to a potential.">Potential</a>(DistRel[3],<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c" title="Return the type.">pType</a>(p1),<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c" title="Return the type.">pType</a>(p2),Pot);
<a name="l00510"></a>00510       <span class="keywordtype">double</span> InvDist = DistRel[3];
<a name="l00511"></a>00511       <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ab3f89c2d946d9c242d3d6061ae17ae78" title="Which arrays are allocated.">SysAlloc</a>,ALL_FORCES)){
<a name="l00512"></a>00512    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00513"></a>00513      <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3" title="Array containing the forces for each particle.">Fm</a>[p1].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba" title="Direction.">Dir</a>[d] += Cons*DistRel[d]*InvDist;
<a name="l00514"></a>00514      <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3" title="Array containing the forces for each particle.">Fm</a>[p2].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba" title="Direction.">Dir</a>[d] -= Cons*DistRel[d]*InvDist;
<a name="l00515"></a>00515    }
<a name="l00516"></a>00516       }
<a name="l00517"></a>00517       OldNrgSys += Pot[0];
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519   }
<a name="l00520"></a>00520 }
<a name="l00521"></a><a class="code" href="classForces.html#a3ee2891acdfca29fc27e89883f2a2df4">00521</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a3ee2891acdfca29fc27e89883f2a2df4" title="Minmal md.">Forces::MinimalMD</a>(){
<a name="l00522"></a>00522   <span class="keywordtype">double</span> Sigma = sqrt(<a class="code" href="classVarData.html#a495c5b182109864eb1db337d49a53999" title="Temperature.">pTemp</a>());
<a name="l00523"></a>00523   <span class="keywordtype">double</span> Pos[3];
<a name="l00524"></a>00524   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00525"></a>00525     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00526"></a>00526       <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#afd1b3747170c238c06ba3420cbc5c2a2" title="xyzr Velocity of the particle">Vel</a>[d] += .5*<a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3" title="Array containing the forces for each particle.">Fm</a>[p].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba" title="Direction.">Dir</a>[d]*<a class="code" href="classVarData.html#af6622c9e9e57aae3faf756b7faa73e29" title="Delta t.">pDeltat</a>();
<a name="l00527"></a>00527       <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d] += <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#afd1b3747170c238c06ba3420cbc5c2a2" title="xyzr Velocity of the particle">Vel</a>[d]*<a class="code" href="classVarData.html#af6622c9e9e57aae3faf756b7faa73e29" title="Delta t.">pDeltat</a>();
<a name="l00528"></a>00528       <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[d] -= floor(<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Pos[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d" title="xyzr edges of the simulation box">pEdge</a>(d);
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530   }
<a name="l00531"></a>00531   <a class="code" href="classForces.html#a8f18498c3494e8fe2476f90f9631c6a8" title="Minmal nrg.">MinimalNrg</a>();
<a name="l00532"></a>00532   <span class="comment">//vv2</span>
<a name="l00533"></a>00533   <span class="keywordtype">double</span> Temp = 0.;
<a name="l00534"></a>00534   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00535"></a>00535     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00536"></a>00536       <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#afd1b3747170c238c06ba3420cbc5c2a2" title="xyzr Velocity of the particle">Vel</a>[d] += .5*<a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3" title="Array containing the forces for each particle.">Fm</a>[p].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba" title="Direction.">Dir</a>[d]*<a class="code" href="classVarData.html#af6622c9e9e57aae3faf756b7faa73e29" title="Delta t.">pDeltat</a>();
<a name="l00537"></a>00537       Temp += SQR(<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].Vel[d]);
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539   }
<a name="l00540"></a>00540   <span class="comment">//Andersen</span>
<a name="l00541"></a>00541   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00542"></a>00542     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#a953e8be14f6a9c259f192683f3a5a970" title="Random uniform number.">Casuale</a>() &lt; <a class="code" href="classVarData.html#af6622c9e9e57aae3faf756b7faa73e29" title="Delta t.">pDeltat</a>()){
<a name="l00543"></a>00543       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){
<a name="l00544"></a>00544    <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#afd1b3747170c238c06ba3420cbc5c2a2" title="xyzr Velocity of the particle">Vel</a>[d] = <a class="code" href="classVarData.html#aab4995eedc5bb0d45d86f0e2a5d0e869" title="Implementation of all usefull algorythms.">Mat</a>-&gt;<a class="code" href="classMatematica.html#ad14013038c5963ed49ca1236e681db10" title="Gaussian random number.">Gaussiano</a>(0.,Sigma);<span class="comment">//Mat-&gt;Gaussiano(0.,Sigma);</span>
<a name="l00545"></a>00545       }
<a name="l00546"></a>00546     }
<a name="l00547"></a>00547   }
<a name="l00548"></a>00548   Temp = Temp/(3*<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>());
<a name="l00549"></a>00549   <span class="keywordtype">double</span> Norm = 1./sqrt(Temp);
<a name="l00550"></a>00550   <span class="comment">// for(int p=0;p&lt;pNPart();p++){</span>
<a name="l00551"></a>00551   <span class="comment">//   for(int d=0;d&lt;3;d++){</span>
<a name="l00552"></a>00552   <span class="comment">//     Pm[p].Vel[d] *= Norm;</span>
<a name="l00553"></a>00553   <span class="comment">//   }</span>
<a name="l00554"></a>00554   <span class="comment">// }</span>
<a name="l00555"></a>00555 }
<a name="l00556"></a><a class="code" href="classForces.html#a4a0ed3bb2c5155bda06158b0e918cd34">00556</a> <span class="keywordtype">void</span> <a class="code" href="classForces.html#a4a0ed3bb2c5155bda06158b0e918cd34" title="Iterative process to approach to the solution.">Forces::MinimizeSol</a>(){
<a name="l00557"></a>00557   <span class="keywordtype">double</span> *Sol2d = (<span class="keywordtype">double</span> *)calloc(SQR(<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>),<span class="keyword">sizeof</span>(double));
<a name="l00558"></a>00558   <span class="keywordtype">double</span> *Count = (<span class="keywordtype">double</span> *)calloc(SQR(<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>),<span class="keyword">sizeof</span>(double));
<a name="l00559"></a>00559   <span class="keywordtype">double</span> NInvEdge = 1./(double)<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>;
<a name="l00560"></a>00560   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f" title="Number of particle.">pNPart</a>();p++){
<a name="l00561"></a>00561     <span class="keywordflow">if</span>(<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c" title="Return the type.">pType</a>(p) != 0) <span class="keywordflow">continue</span>;
<a name="l00562"></a>00562     <span class="keywordtype">int</span> vx = (<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[0]*<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(0));
<a name="l00563"></a>00563     <span class="keywordflow">if</span>(vx &lt; 0 || vx &gt;= <a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>) <span class="keywordflow">continue</span>;
<a name="l00564"></a>00564     <span class="keywordtype">int</span> vy = (<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[1]*<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac" title="Inverted xyzr edges of the simulation box.">pInvEdge</a>(1));
<a name="l00565"></a>00565     <span class="keywordflow">if</span>(vy &lt; 0 || vy &gt;= <a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>) <span class="keywordflow">continue</span>;
<a name="l00566"></a>00566     Sol2d[vx*<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>+vx] = <a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7" title="Particle information of all particle.">Pm</a>[p].<a class="code" href="structPART.html#a863738e46f14b3bfc674ad87d35f143d" title="xyz Position of the particle">Pos</a>[2];
<a name="l00567"></a>00567     Count[vx*<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>+vx] = 1.;
<a name="l00568"></a>00568   }
<a name="l00569"></a>00569   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> vx=0;vx&lt;SQR(<a class="code" href="classVarData.html#ae2e67b49132b33a026b19c647cbf4f3c" title="Number of particles per edge.">NEdge</a>);vx++){
<a name="l00570"></a>00570     <span class="keywordtype">double</span> Norm = Count[vx] &gt; 0. ?  1./Count[vx] : 1.;
<a name="l00571"></a>00571     Sol2d[vx] *= Norm;
<a name="l00572"></a>00572   }
<a name="l00573"></a>00573   <a class="code" href="classForces.html#a9e66d18b6b637a388161c4310deb71e9" title="Create a plane of connected beads.">Create2d</a>();
<a name="l00574"></a>00574   <span class="keywordtype">int</span> NInt = 1000;
<a name="l00575"></a>00575   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;n&lt;NInt;n++){
<a name="l00576"></a>00576     
<a name="l00577"></a>00577   }
<a name="l00578"></a>00578 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu Mar 27 2014 22:02:17 for Allink by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
