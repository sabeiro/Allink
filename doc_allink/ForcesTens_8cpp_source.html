<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Allink: src/Addyn/ForcesTens.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Allink
   &#160;<span id="projectnumber">v0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_ed615368fd5ab0766bfe5b479d2a7e4e.html">Addyn</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ForcesTens.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;Forces.h&quot;</span></div><div class="line"><a name="l00002"></a><span class="lineno"><a class="line" href="classForces.html#ac6a2e2465107cd1b6eea81aeb80646c2">    2</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classForces.html#ac6a2e2465107cd1b6eea81aeb80646c2">Forces::AllocTens</a>(){</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#ab3f89c2d946d9c242d3d6061ae17ae78">SysAlloc</a>,ALL_TENS)) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[d] = <a class="code" href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3">pNanoPos</a>(0,d);<span class="comment">//.5*pEdge(d);</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  }</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a> = (<span class="keywordtype">double</span> **)calloc(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a5a9396ca53c5306c34eb62ef4f02593b">NComp</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a> = (<span class="keywordtype">double</span> **)calloc(2,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  <span class="comment">//   2d</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#ae7fd260630480928a069e7e536739df1">CalcMode</a>,CALC_2d)){</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    <a class="code" href="classForces.html#ac399a421f2e2ac8c1af8b456ce4d6e5c">Tens_Ref</a> = &amp;<a class="code" href="classForces.html#a8d63955572a8c5888a8a305fb56ada48">Forces::TensRefPol</a>;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <a class="code" href="classVarData.html#ac659e9234deb7729483b32fd9d6b5b30">SetEdge</a>(.5*MIN(<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>)),3);</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[0] = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(3);</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[1] = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>);</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[2] = 1.;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#af7ac0af936a90fda61fc97028cc7a2fc">Wrap</a>[0] = 0;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#af7ac0af936a90fda61fc97028cc7a2fc">Wrap</a>[1] = 1;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8deae0979f1ffa0ff0b1976cee071f39">EdgeInv</a>[d] = 1./<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[d];</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a5a9396ca53c5306c34eb62ef4f02593b">NComp</a>;c++){</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[c] = (<span class="keywordtype">double</span> *)calloc(SQR(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>),<span class="keyword">sizeof</span>(double));</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    }</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;2;c++){</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[c] = (<span class="keywordtype">double</span> *)calloc(SQR(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>),<span class="keyword">sizeof</span>(double));</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    }</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  }</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="comment">//  3d</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#ae7fd260630480928a069e7e536739df1">CalcMode</a>,CALC_3d)){</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <a class="code" href="classForces.html#ac399a421f2e2ac8c1af8b456ce4d6e5c">Tens_Ref</a> = &amp;<a class="code" href="classForces.html#afad21f344bdeced26172aaf70d26e844">Forces::TensRefCart</a>;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[d] = <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#af7ac0af936a90fda61fc97028cc7a2fc">Wrap</a>[d] = 1;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8deae0979f1ffa0ff0b1976cee071f39">EdgeInv</a>[d] = <a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(d);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    }</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a5a9396ca53c5306c34eb62ef4f02593b">NComp</a>;c++){</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[c] = (<span class="keywordtype">double</span> *)calloc(CUBE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>),<span class="keyword">sizeof</span>(double));</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;2;c++){</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[c] = (<span class="keywordtype">double</span> *)calloc(CUBE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>),<span class="keyword">sizeof</span>(double));</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    }</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  }</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  VAR_ADD_TYPE(<a class="code" href="classForces.html#ab3f89c2d946d9c242d3d6061ae17ae78">SysAlloc</a>,ALL_TENS);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classForces.html#a44c4bed1843e51f20f252a5dd05f64fe">   45</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classForces.html#a44c4bed1843e51f20f252a5dd05f64fe">Forces::CalcDens</a>(){</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="comment">// 3d</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#ae7fd260630480928a069e7e536739df1">CalcMode</a>,CALC_3d)){</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">double</span> PosRel[3];</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f">pNPart</a>();p++){</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   PosRel[d] = <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5">pPos</a>(p,d) - (<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d)*.5 - <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[d]);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;   PosRel[d] -= floor(PosRel[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <span class="keywordtype">int</span> sx = (int)(PosRel[0]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(0)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="keywordtype">int</span> sy = (int)(PosRel[1]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(1)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <span class="keywordtype">int</span> sz = (int)(PosRel[2]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(2)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keywordtype">int</span> v = (sx*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+sy)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+sz;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <span class="keywordtype">int</span> t = <a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c">pType</a>(p);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordflow">if</span>(t &gt; 1) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[t][v] += 1.;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  }</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// 2d</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#ae7fd260630480928a069e7e536739df1">CalcMode</a>,CALC_2d)){</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">double</span> PosRel[3];</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f">pNPart</a>();p++){</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      PosRel[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>] = <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5">pPos</a>(p,<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>) - <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>];</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      PosRel[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>] = <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5">pPos</a>(p,<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>) - <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>];</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      PosRel[<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>] = <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5">pPos</a>(p,<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>) + (<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>)*.5 - <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>]);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   PosRel[d] -= floor(PosRel[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordtype">int</span> sr = (int)(hypot(PosRel[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>],PosRel[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>])*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8deae0979f1ffa0ff0b1976cee071f39">EdgeInv</a>[0]*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordtype">int</span> sz = (int)(PosRel[<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="keywordflow">if</span>(sr &lt; 0 || sr &gt;= <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <span class="keywordflow">if</span>(sz &lt; 0 || sz &gt;= <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="keywordtype">int</span> v = (sr*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+sz);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      <span class="keywordtype">int</span> t = <a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c">pType</a>(p);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="keywordflow">if</span>(t &gt; 1) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[t][v] += 1.;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="comment">//printf(&quot;%d %d %d %lf\n&quot;,sr,sz,v,Tens.Dens[t][v]);</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="classForces.html#a69a4a0318fb6e0382d6e2288a40c9e98">   85</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classForces.html#a69a4a0318fb6e0382d6e2288a40c9e98">Forces::CalcTens</a>(){</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">if</span>(!VAR_IF_TYPE(<a class="code" href="classForces.html#ab3f89c2d946d9c242d3d6061ae17ae78">SysAlloc</a>,ALL_FORCES)){</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    printf(<span class="stringliteral">&quot;Forces not allocated\n&quot;</span>);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="classForces.html#a0390d97ed1665851fb6175342d1c598b">ClearDens</a>();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="classForces.html#a9d4e2ba1cf8ce2142f50a1b7e8bf4f7b">AddDens</a>(0,<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f">pNPart</a>());</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="classForces.html#a0449e9410bf23ad4d073f1eab66c2a68">SumDens</a>(0,<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f">pNPart</a>());</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordtype">double</span> Dist = 0.;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordtype">double</span> DistRelBA[4];</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f">pNPart</a>();p++){</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] = 0.;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// non bonded</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordtype">double</span> Pos[3];</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p1=0;p1&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f">pNPart</a>();p1++){</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a74b7b0d716684a7d46993c83795fd9e7">SetCurr</a>(p1);<a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a63c5d18d3a487d1a8ab2a5881c6acb38">IfCurr</a>();<a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#a42eeb7049c078ca89057fbc08726eded">NextCurr</a>()){</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <span class="keywordtype">int</span> p2 = <a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051">Pc</a>-&gt;<a class="code" href="classDomDecBasics.html#a28d65a777a97b96280ca0f9173c76c93">p2Curr</a>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="keywordflow">if</span>(p2 &lt;= p1) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <a class="code" href="classForces.html#a5d8052dd63b08f01b581aeffa8506051">Pc</a>-&gt;<a class="code" href="classDdLinkedList.html#ad4860e7b4a26d4b424e5c98b7c6bae09">Dist2Curr</a>(DistRelBA);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="keywordflow">if</span>(DistRelBA[3] &gt; <a class="code" href="classForces.html#a774d65ef8685d2859fae66bad8c9b435">Kf</a>.<a class="code" href="structKFORCES.html#ac448df5dbfd256324893075200dace49">CutOff2</a>) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="keywordtype">double</span> Dist = sqrt(DistRelBA[3]);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordtype">double</span> Force = 0.;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;<a class="code" href="classVarData.html#a6496acd0cba8289e8306507336dd2f88">pNType</a>();t++){</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   Force += <a class="code" href="classVarData.html#a7bb96647a8e4b53477394d2538fdfb3f">MInt</a>-&gt;<a class="code" href="classMatInt.html#a1c5a9c480e688013bf93d9d5409319e5">Coeff</a>(<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c">pType</a>(p1),<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c">pType</a>(p2),t)*(Dens3[p1*<a class="code" href="classVarData.html#a6496acd0cba8289e8306507336dd2f88">pNType</a>()+t]+Dens3[p2*<a class="code" href="classVarData.html#a6496acd0cba8289e8306507336dd2f88">pNType</a>()+t]);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      Force *= <a class="code" href="classForces.html#a3d44e49e6ced82a300d6071060b72c48">DerWei3</a>(Dist,<a class="code" href="classVarData.html#aa5c40af319c1dda726271b9fe4059443">pWei3Par</a>())*2./3.;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      Force += <a class="code" href="classForces.html#a5c07d0e26deb83592ec816a9d6dfd05b">DerWei2</a>(Dist,<a class="code" href="classVarData.html#a217f00c8faf9ba6bb022913df51e5f24">pWei2Par</a>())*<a class="code" href="classVarData.html#a7bb96647a8e4b53477394d2538fdfb3f">MInt</a>-&gt;<a class="code" href="classMatInt.html#a1c5a9c480e688013bf93d9d5409319e5">Coeff</a>(<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c">pType</a>(p1),<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c">pType</a>(p2));</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">SumTens</a>(p1,p2,Force,DistRelBA);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      Force /= -Dist;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      SigErr(Force &gt; 5000.,<span class="stringliteral">&quot;Forces over the limit %lf\n&quot;</span>,Force);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p1].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] += Force*DistRelBA[d];</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p2].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] -= Force*DistRelBA[d];</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// bonded</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordtype">double</span> DistRelBC[4];</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordtype">double</span> Pre[12];</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0;b&lt;<a class="code" href="classVarData.html#a474ffd5306304ac53eb7ef48a18e511d">pNBlock</a>();b++){</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2">pNChain</a>(b);c++){</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=c*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f">pNPCh</a>(b);p&lt;(c+1)*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f">pNPCh</a>(b)-1;p++){</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;   <a class="code" href="classVarData.html#a19886baf2914ac46bc50f333254a4e57">TwoPartDist</a>(p+1,p,DistRelBA);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   <span class="keywordtype">double</span> ForceSp = <a class="code" href="classVarData.html#a16f3b01ba84886cbaf53fa1238c434f3">pkSpr</a>()*(1. - <a class="code" href="classVarData.html#ad180facca71ad48ae3ce77052bf22957">pSprRest</a>()/DistRelBA[3]);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">SumTens</a>(p,p+1,ForceSp,DistRelBA);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;     <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] += ForceSp*DistRelBA[d];</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;     <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p+1].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] -= ForceSp*DistRelBA[d];</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;   <span class="keywordflow">if</span>(p &lt; (c+1)*<a class="code" href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f">pNPCh</a>(b)-2){</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;     <a class="code" href="classVarData.html#a19886baf2914ac46bc50f333254a4e57">TwoPartDist</a>(p+2,p+1,DistRelBC);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;     <span class="keywordtype">double</span> CosAngle = 0.;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;       DistRelBA[d] /= DistRelBA[3];</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;       DistRelBC[d] /= DistRelBC[3];</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;       CosAngle += DistRelBA[d]*DistRelBC[d];</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;     }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;     <span class="keywordtype">double</span> PreFactBA = <a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()/DistRelBA[3];</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;     <span class="keywordtype">double</span> PreFactBC = <a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()/DistRelBC[3];</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;       <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p+0].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] += PreFactBA*(DistRelBC[d]-DistRelBA[d]*CosAngle);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;       <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p+1].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] -= PreFactBA*(DistRelBC[d]-DistRelBA[d]*CosAngle);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;       <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p+1].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] += PreFactBC*(DistRelBA[d]-DistRelBC[d]*CosAngle);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;       <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p+2].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] -= PreFactBC*(DistRelBA[d]-DistRelBC[d]*CosAngle);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;       Pre[d  ] = DistRelBA[d]*<a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()*(DistRelBC[d]-DistRelBA[d]*CosAngle);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;       Pre[d+6] = DistRelBC[d]*<a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()*(DistRelBA[d]-DistRelBC[d]*CosAngle);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;     }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;     Pre[ 3] = DistRelBA[0]*<a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()*(DistRelBC[1]-DistRelBA[1]*CosAngle);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;     Pre[ 4] = DistRelBA[0]*<a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()*(DistRelBC[2]-DistRelBA[2]*CosAngle);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;     Pre[ 5] = DistRelBA[1]*<a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()*(DistRelBC[2]-DistRelBA[2]*CosAngle);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;     Pre[ 9] = DistRelBC[0]*<a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()*(DistRelBA[1]-DistRelBC[1]*CosAngle);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;     Pre[10] = DistRelBC[0]*<a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()*(DistRelBA[2]-DistRelBC[2]*CosAngle);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;     Pre[11] = DistRelBC[1]*<a class="code" href="classVarData.html#a395cfa5f68437606051e29df1759e371">pkBen</a>()*(DistRelBA[2]-DistRelBC[2]*CosAngle);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;     <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">SumTens</a>(p,p+1,Pre);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;     <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">SumTens</a>(p+1,p+2,Pre+6);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">//external</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">double</span> Pot[3];</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordtype">double</span> PosBf[3];</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">double</span> dr[4];</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">double</span> NPos[3];</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;n&lt;<a class="code" href="classVarData.html#aef94681f570cacf1a76aac1512563f17">pNNano</a>();n++){</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="classVarData.html#acd4e4b1e648b7d1ca3a169bb176e9f5c">Point2Shape</a>(<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b">Nano</a>[n].Shape);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;<a class="code" href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f">pNPart</a>();p++){</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5">pPos</a>(p,Pos);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keywordtype">double</span> Dr2 = <a class="code" href="classVarData.html#a1dd0baef0ade6f5abcacba0d814f40d8">NanoDist2</a>(Pos,n);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordtype">double</span> InvDist = 1./Dr2;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordtype">double</span> Cons = <a class="code" href="classForces.html#ac5ef477f97601b779392b8622ac6b1fe">Potential</a>(Dr2,0,<a class="code" href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c">pType</a>(p),Pot);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   dr[d] = <a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b">Nano</a>[n].<a class="code" href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d">Pos</a>[d] - <a class="code" href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5">pPos</a>(p,d);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   <span class="keywordflow">if</span>(dr[d] &gt;  .5*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(d)) dr[d] -= <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   <span class="keywordflow">if</span>(dr[d] &lt; -.5*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(d)) dr[d] += <a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="keywordtype">double</span> Norm = SQR(<a class="code" href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b">Nano</a>[n].Rad)/(SQR(dr[0]) + SQR(dr[1]) + SQR(dr[2]));</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      Norm = sqrt(Norm);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   NPos[d] = NPos[d] + dr[d]*Norm;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;   <a class="code" href="classForces.html#afca243db3841bf482910199bdb22e5f3">Fm</a>[p].<a class="code" href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">Dir</a>[d] += Cons*dr[d]*InvDist;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   Pre[d  ] = Cons*dr[d]*dr[d]*InvDist;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      Pre[3] = Cons*dr[0]*dr[1]*InvDist;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      Pre[4] = Cons*dr[0]*dr[2]*InvDist;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      Pre[5] = Cons*dr[1]*dr[2]*InvDist;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">SumTens</a>(NPos,Pos,Pre);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="classForces.html#afad21f344bdeced26172aaf70d26e844">  199</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classForces.html#afad21f344bdeced26172aaf70d26e844">Forces::TensRefCart</a>(<span class="keywordtype">double</span> *Pos1,<span class="keywordtype">double</span> *Pos2,<span class="keywordtype">double</span> *PosP1,<span class="keywordtype">double</span> *PosP2){</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;3;d++){</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    PosP1[d] = Pos1[d] - (<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d)*.5 - <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[d]);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    PosP2[d] = Pos2[d] - (<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d)*.5 - <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[d]);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    PosP1[d] -= floor(PosP1[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    PosP2[d] -= floor(PosP2[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(d))*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="classForces.html#a8d63955572a8c5888a8a305fb56ada48">  207</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classForces.html#a8d63955572a8c5888a8a305fb56ada48">Forces::TensRefPol</a>(<span class="keywordtype">double</span> *PosO1,<span class="keywordtype">double</span> *PosO2,<span class="keywordtype">double</span> *PosP1,<span class="keywordtype">double</span> *PosP2){</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordtype">double</span> Pos1[2] = {PosO1[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>]-<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>],PosO1[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>]-<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>]};</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">double</span> Pos2[2] = {PosO2[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>]-<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>],PosO2[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>]-<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>]};</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;2;d++){</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    Pos1[d] -= floor(Pos1[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(d) + .5)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    Pos2[d] -= floor(Pos2[d]*<a class="code" href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">pInvEdge</a>(d) + .5)*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(d);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  PosP1[0] = hypot(Pos1[0],Pos1[1]);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  PosP2[0] = hypot(Pos2[0],Pos2[1]);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  PosP1[1] = PosO1[<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>] + (<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>)*.5 - <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>]);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  PosP2[1] = PosO2[<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>] + (<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>)*.5 - <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>]);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=1;d&lt;2;d++){</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    PosP1[d] -= floor(PosP1[d]*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8deae0979f1ffa0ff0b1976cee071f39">EdgeInv</a>[d])*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[d];</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    PosP2[d] -= floor(PosP2[d]*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8deae0979f1ffa0ff0b1976cee071f39">EdgeInv</a>[d])*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[d];</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">//printf(&quot;%d %d %lf %lf %lf %lf \n&quot;,p1,p2,PosP1[0],PosP1[1],PosP2[0],PosP2[0]);</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div><div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="classForces.html#a898790f8f00dd994c472c5526c454b77">  224</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">Forces::SumTens</a>(<span class="keywordtype">int</span> p1,<span class="keywordtype">int</span> p2,<span class="keywordtype">double</span> *Pre){</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">SumTens</a>(<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7">Pm</a>[p1].Pos,<a class="code" href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7">Pm</a>[p2].Pos,Pre);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div><div class="line"><a name="l00227"></a><span class="lineno"><a class="line" href="classForces.html#aa4ae1e5942505c407b95ebf6d88156eb">  227</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">Forces::SumTens</a>(<span class="keywordtype">double</span> *Pos1,<span class="keywordtype">double</span> *Pos2,<span class="keywordtype">double</span> *Pre){</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">double</span> PosP1[3];</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">double</span> PosP2[3];</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <a class="code" href="classForces.html#ab49daa22c5de576835d55d185f1a53be">TensRef</a>(Pos1,Pos2,PosP1,PosP2);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordtype">int</span> NPoint = 100;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordtype">double</span> PointInv = 1./(double)NPoint;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">double</span> Deltav[3];</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordtype">double</span> Pos[3];</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordtype">int</span> vCurr[3];</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3b5e7568c0a268ec8bbeef7f29ea111a">NDim</a>;d++){</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// starts from the smallest position</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    Pos[d] = PosP1[d] &lt; PosP2[d] ? PosP1[d] : PosP2[d];</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    Deltav[d] = fabs((PosP2[d]-PosP1[d])*PointInv);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// forward/backward?</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span>( fabs(PosP2[d] - PosP1[d]) &gt; <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[d]*.5){</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      Deltav[d] = -fabs((MAX(PosP1[d],PosP2[d])-<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[d]-Pos[d])*PointInv);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">//printf(&quot;%d %d) [%lf %lf] [%lf %lf] (%lf %lf) (%lf %lf)\n&quot;,p1,p2,PosP1[0],PosP1[1],PosP2[0],PosP2[1],Deltav[0],Deltav[1],Tens.Edge[0],Tens.Edge[1]);</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0;p&lt;NPoint;p++){</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3b5e7568c0a268ec8bbeef7f29ea111a">NDim</a>;d++){</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      vCurr[d] = (int)(Pos[d]*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8deae0979f1ffa0ff0b1976cee071f39">EdgeInv</a>[d]);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="comment">//assert(vCurr[d] &gt;= 0 &amp;&amp; vCurr[d] &lt; Tens.NSlab);</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">if</span>(vCurr[d] &lt; 0 || vCurr[d] &gt;= <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">// update the current position forward/backward</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      Pos[d] += Deltav[d];</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="comment">// wrap the position to the other end</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordflow">if</span>(Pos[d] &gt; <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[d]){</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <span class="keywordflow">if</span>(!<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#af7ac0af936a90fda61fc97028cc7a2fc">Wrap</a>[d]) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   Pos[d] -= floor(Pos[d]*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8deae0979f1ffa0ff0b1976cee071f39">EdgeInv</a>[d])*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[d];</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordtype">int</span> vTot = 0;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0;d&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3b5e7568c0a268ec8bbeef7f29ea111a">NDim</a>;d++){</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      vTot += vCurr[d];</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">if</span>(d &lt; <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3b5e7568c0a268ec8bbeef7f29ea111a">NDim</a>-1)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   vTot *= <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">//printf(&quot;%d %d %d (%lf %lf) %lf\n&quot;,vCurr[0],vCurr[1],vTot,Pos[0],Pos[1],Pre[0]);</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a5a9396ca53c5306c34eb62ef4f02593b">NComp</a>;c++){</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[c][vTot] += Pre[c]*PointInv;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">  271</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">Forces::SumTens</a>(<span class="keywordtype">int</span> p1,<span class="keywordtype">int</span> p2,<span class="keywordtype">double</span> Force,<span class="keywordtype">double</span> *DistRel){</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">if</span>(fabs(Force) &lt; 0.) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">if</span>(fabs(Force) &gt; 5000.) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordtype">double</span> Pre[6];</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordtype">double</span> InvDist = Force/DistRel[3];</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  Pre[0] = DistRel[0]*DistRel[0]*InvDist;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  Pre[1] = DistRel[1]*DistRel[1]*InvDist;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  Pre[2] = DistRel[2]*DistRel[2]*InvDist;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  Pre[3] = DistRel[0]*DistRel[1]*InvDist;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  Pre[4] = DistRel[0]*DistRel[2]*InvDist;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  Pre[5] = DistRel[1]*DistRel[2]*InvDist;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">SumTens</a>(p1,p2,Pre);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div><div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="classForces.html#a7b39177dbabd51bb886537f9674160ba">  284</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classForces.html#a7b39177dbabd51bb886537f9674160ba">Forces::WriteTens2d</a>(FILE *FWrite,<span class="keywordtype">int</span> Comp,<span class="keywordtype">double</span> InvNFile){</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordtype">int</span> link[4] = {0,0,0,0};</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  fprintf(FWrite,<span class="stringliteral">&quot;# l(%.1f %.1f %.1f) r(%.2f %.2f %.2f) v[%d] d[color]\n&quot;</span>,<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[0],<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[1],1.,<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[0],<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[1],<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[2],<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">double</span> *VolContr = (<span class="keywordtype">double</span> *)calloc(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <a class="code" href="classVarData.html#acb9df687ca0683b99bdb00425e9da912">VolumeCircSlab</a>(VolContr,<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sr=1,p=0,c=0;sr&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>;sr++){</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordtype">double</span> r = sr*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[0]/(double)<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sz=0;sz&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>;sz++){</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordtype">double</span> z = sz*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">Edge</a>[1]/(double)<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keywordtype">int</span> v = sr*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+sz;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[0][v] &lt;= 0. &amp;&amp; <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[1][v] &lt;= 0. &amp;&amp; fabs(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[Comp][v]) &lt;= 0.) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordtype">double</span> Press = -<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[Comp][v]*InvNFile/VolContr[sr];</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordtype">double</span> Dens1 = <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[0][v]*InvNFile/VolContr[sr];</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordtype">double</span> Dens2 = <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[1][v]*InvNFile/VolContr[sr];</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      fprintf(FWrite,<span class="stringliteral">&quot;{x(%.3f %.3f %.3f) v( %lf %.2f %.2f)}\n&quot;</span>,r,z,0.,Press,Dens1,Dens2);<span class="keywordflow">continue</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      link[0] = (sr+0)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+(sz+0);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      link[1] = (sr+0)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+(sz+1);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      link[2] = (sr+1)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+(sz+0);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      link[3] = (sr+1)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+(sz+1);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lx=0;lx&lt;2;lx++){</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ly=0;ly&lt;2;ly++){</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;           <span class="keywordtype">int</span> l = 2*lx+ly;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;           <span class="keywordtype">int</span> l1 = p + (p+1)%4;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;           <span class="keywordtype">int</span> l2 = p + (p+2)%4;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;           <span class="keywordtype">int</span> l3 = p + (p+3)%4;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;           fprintf(FWrite,<span class="stringliteral">&quot;{t[%d %d %d]&quot;</span>,p,c,0);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;           fprintf(FWrite,<span class="stringliteral">&quot; x(%.3f %.3f %.3f)&quot;</span>,r,z,Press);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;           fprintf(FWrite,<span class="stringliteral">&quot; v( %lf %.2f %.2f)&quot;</span>,Press,Dens1,Dens2);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;              <span class="comment">// -Tens.Pre[Comp][v]*InvNFile,</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;              <span class="comment">// Tens.Dens[0][v]*InvNFile,</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;              <span class="comment">// Tens.Dens[1][v]*InvNFile);  </span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;           fprintf(FWrite,<span class="stringliteral">&quot; l[%d] l[%d] l[%d]}\n&quot;</span>,l1,l2,l3);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;           p++;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;         }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      c++;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">//free(VolContr);</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div><div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="classForces.html#a0bd0430e9512fea0edf8d3cc157f6e7f">  324</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classForces.html#a0bd0430e9512fea0edf8d3cc157f6e7f">Forces::WriteTens</a>(<span class="keywordtype">char</span> *FTens,<span class="keywordtype">int</span> Comp,<span class="keywordtype">double</span> InvNFile){</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordtype">double</span> InvValues = 1. / <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordtype">double</span> InvVolume = <a class="code" href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9">prho</a>()*CUBE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>)/<a class="code" href="classVarData.html#a3ccdbc4515f1de45728ef36368b9969a">pVol</a>();</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#ae7fd260630480928a069e7e536739df1">CalcMode</a>,CALC_2d)){</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#ifdef OMPI_MPI_H</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  MPI_Allreduce(MPI_IN_PLACE,<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[Comp],SQR(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>),MPI_DOUBLE,MPI_SUM,Proc-&gt;CommGrid);  </div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;2;t++){</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    MPI_Allreduce(MPI_IN_PLACE,<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[t],SQR(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>),MPI_DOUBLE,MPI_SUM,Proc-&gt;CommGrid);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; <span class="keywordtype">int</span> Rank=0;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  MPI_Comm_rank(Proc-&gt;CommGrid, &amp;Rank);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span>(Rank==0){</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    FILE *FWrite = fopen(FTens,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="classForces.html#a7b39177dbabd51bb886537f9674160ba">WriteTens2d</a>(FWrite,Comp,InvNFile);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    fclose(FWrite);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0;s&lt;SQR(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);s++){</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[Comp][s] = 0.;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[0][s] = 0.;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[1][s] = 0.;      </div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="preprocessor">    #ifdef OMPI_MPI_H</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">if</span>(VAR_IF_TYPE(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#ae7fd260630480928a069e7e536739df1">CalcMode</a>,CALC_3d)){</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="preprocessor">#ifdef OMPI_MPI_H</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    MPI_Allreduce(MPI_IN_PLACE,<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[Comp],CUB(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>),MPI_DOUBLE,MPI_SUM,Proc-&gt;CommGrid);  </div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> t=0;t&lt;2;t++){</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      MPI_Allreduce(MPI_IN_PLACE,<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[t],CUB(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>),MPI_DOUBLE,MPI_SUM,Proc-&gt;CommGrid);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordtype">int</span> Rank=0;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    MPI_Comm_rank(Proc-&gt;CommGrid, &amp;Rank);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">if</span>(Rank==0){</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    FILE *FWrite = fopen(FTens,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    fprintf(FWrite,<span class="stringliteral">&quot;# l(%.1f %.1f %.1f) r(%.2f %.2f %.2f) v[%d] d[color]\n&quot;</span>,<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(0),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(1),<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(2),<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[0],<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[1],<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">RefPos</a>[2],<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sx=0;sx&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>;sx++){</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keywordtype">double</span> x = sx*InvValues*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(<a class="code" href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">CLat1</a>);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sy=0;sy&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>;sy++){</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <span class="keywordtype">double</span> y = sy*InvValues*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(<a class="code" href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">CLat2</a>);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sz=0;sz&lt;<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>;sz++){</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;     <span class="keywordtype">double</span> z = sz*InvValues*<a class="code" href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">pEdge</a>(<a class="code" href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">CNorm</a>);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;     <span class="keywordtype">int</span> v = (sx*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+sy)*<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>+sz;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;     <span class="keywordflow">if</span>(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[0][v] &lt;= 0 &amp;&amp; <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[1][v] &lt;= 0 &amp;&amp; ABS(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[Comp][v]) &lt;= 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;     fprintf(FWrite,<span class="stringliteral">&quot;{x(%.3f %.3f %.3f)&quot;</span>,x,y,z);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;     fprintf(FWrite,<span class="stringliteral">&quot; v( %lf %.2f %.2f)}\n&quot;</span>,</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        -<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[Comp][v]*InvNFile*InvVolume,</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;          <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[0][v]*InvNFile*InvVolume,</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[1][v]*InvNFile*InvVolume);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;   }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    }</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    fclose(FWrite);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0;s&lt;CUB(<a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">NSlab</a>);s++){</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a3c45860d199670aae527e40339eb6437">Pre</a>[Comp][s] = 0.;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[0][s] = 0.;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <a class="code" href="classForces.html#a77e000512807ae8da791d650d739299a">Tens</a>.<a class="code" href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">Dens</a>[1][s] = 0.;      </div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor">#ifdef OMPI_MPI_H</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  }</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;}</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="ttc" id="classForces_html_a69a4a0318fb6e0382d6e2288a40c9e98"><div class="ttname"><a href="classForces.html#a69a4a0318fb6e0382d6e2288a40c9e98">Forces::CalcTens</a></div><div class="ttdeci">void CalcTens()</div><div class="ttdoc">Calculate the forces for the tension profile. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesTens_8cpp_source.html#l00085">ForcesTens.cpp:85</a></div></div>
<div class="ttc" id="classForces_html_ac399a421f2e2ac8c1af8b456ce4d6e5c"><div class="ttname"><a href="classForces.html#ac399a421f2e2ac8c1af8b456ce4d6e5c">Forces::Tens_Ref</a></div><div class="ttdeci">TENS_REF Tens_Ref</div><div class="ttdoc">Pointer to a coordinate distance. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00647">Forces.h:647</a></div></div>
<div class="ttc" id="classVarData_html_a395cfa5f68437606051e29df1759e371"><div class="ttname"><a href="classVarData.html#a395cfa5f68437606051e29df1759e371">VarData::pkBen</a></div><div class="ttdeci">double pkBen()</div><div class="ttdoc">Bending coupling. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00932">VarData.h:932</a></div></div>
<div class="ttc" id="classForces_html_a0bd0430e9512fea0edf8d3cc157f6e7f"><div class="ttname"><a href="classForces.html#a0bd0430e9512fea0edf8d3cc157f6e7f">Forces::WriteTens</a></div><div class="ttdeci">void WriteTens(char *TFile, int Comp, double InvNFile)</div><div class="ttdoc">Write the pressure and density profile. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesTens_8cpp_source.html#l00324">ForcesTens.cpp:324</a></div></div>
<div class="ttc" id="classVarData_html_a1dd0baef0ade6f5abcacba0d814f40d8"><div class="ttname"><a href="classVarData.html#a1dd0baef0ade6f5abcacba0d814f40d8">VarData::NanoDist2</a></div><div class="ttdeci">double NanoDist2(double *Pos, int n)</div><div class="ttdoc">Pointer to a generic function. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00764">VarData.h:764</a></div></div>
<div class="ttc" id="classVarData_html_a9b47d9a32db9326bceac9402c94683d9"><div class="ttname"><a href="classVarData.html#a9b47d9a32db9326bceac9402c94683d9">VarData::prho</a></div><div class="ttdeci">double prho()</div><div class="ttdoc">Density coexistence. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00944">VarData.h:944</a></div></div>
<div class="ttc" id="structTENS_html_a3c45860d199670aae527e40339eb6437"><div class="ttname"><a href="structTENS.html#a3c45860d199670aae527e40339eb6437">TENS::Pre</a></div><div class="ttdeci">double ** Pre</div><div class="ttdoc">Pressure array. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00199">Forces.h:199</a></div></div>
<div class="ttc" id="classVarData_html_aee5ea3e3c08ea9745e40192350f5d14b"><div class="ttname"><a href="classVarData.html#aee5ea3e3c08ea9745e40192350f5d14b">VarData::Nano</a></div><div class="ttdeci">NANO * Nano</div><div class="ttdoc">Extra particle. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l01044">VarData.h:1044</a></div></div>
<div class="ttc" id="classForces_html_a7b39177dbabd51bb886537f9674160ba"><div class="ttname"><a href="classForces.html#a7b39177dbabd51bb886537f9674160ba">Forces::WriteTens2d</a></div><div class="ttdeci">void WriteTens2d(FILE *FWrite, int Comp, double InvNFile)</div><div class="ttdoc">Write the 2d pressure profile. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesTens_8cpp_source.html#l00284">ForcesTens.cpp:284</a></div></div>
<div class="ttc" id="structTENS_html_a3b5e7568c0a268ec8bbeef7f29ea111a"><div class="ttname"><a href="structTENS.html#a3b5e7568c0a268ec8bbeef7f29ea111a">TENS::NDim</a></div><div class="ttdeci">int NDim</div><div class="ttdoc">of dimensions</div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00193">Forces.h:193</a></div></div>
<div class="ttc" id="classVarData_html_a33833c025a5c9bf7ad5abab2cf9b1dac"><div class="ttname"><a href="classVarData.html#a33833c025a5c9bf7ad5abab2cf9b1dac">VarData::pInvEdge</a></div><div class="ttdeci">double pInvEdge(int d)</div><div class="ttdoc">Inverted xyzr edges of the simulation box. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00920">VarData.h:920</a></div></div>
<div class="ttc" id="classVarData_html_a75896c37dd78ba0d2da013ad4cf0e87c"><div class="ttname"><a href="classVarData.html#a75896c37dd78ba0d2da013ad4cf0e87c">VarData::pType</a></div><div class="ttdeci">int pType(int p)</div><div class="ttdoc">Return the type. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataComm_8cpp_source.html#l00219">VarDataComm.cpp:219</a></div></div>
<div class="ttc" id="classVarData_html_a14ec5e9f32dac94d5974f23bbba4ff86"><div class="ttname"><a href="classVarData.html#a14ec5e9f32dac94d5974f23bbba4ff86">VarData::CLat2</a></div><div class="ttdeci">int CLat2</div><div class="ttdoc">lateral coordinate </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l01078">VarData.h:1078</a></div></div>
<div class="ttc" id="classForces_html_a5c07d0e26deb83592ec816a9d6dfd05b"><div class="ttname"><a href="classForces.html#a5c07d0e26deb83592ec816a9d6dfd05b">Forces::DerWei2</a></div><div class="ttdeci">double DerWei2(const double r, const double b)</div><div class="ttdoc">Derivative of the quadratic weighting function. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesForceField_8cpp_source.html#l00734">ForcesForceField.cpp:734</a></div></div>
<div class="ttc" id="structFORCES_html_ac77c91979738079508cf3f257a7164ba"><div class="ttname"><a href="structFORCES.html#ac77c91979738079508cf3f257a7164ba">FORCES::Dir</a></div><div class="ttdeci">double Dir[3]</div><div class="ttdoc">Direction. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00178">Forces.h:178</a></div></div>
<div class="ttc" id="classVarData_html_a16f3b01ba84886cbaf53fa1238c434f3"><div class="ttname"><a href="classVarData.html#a16f3b01ba84886cbaf53fa1238c434f3">VarData::pkSpr</a></div><div class="ttdeci">double pkSpr()</div><div class="ttdoc">Spring coupling. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00934">VarData.h:934</a></div></div>
<div class="ttc" id="classVarData_html_ad180facca71ad48ae3ce77052bf22957"><div class="ttname"><a href="classVarData.html#ad180facca71ad48ae3ce77052bf22957">VarData::pSprRest</a></div><div class="ttdeci">double pSprRest()</div><div class="ttdoc">Rest distance of the harmonic potential. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00942">VarData.h:942</a></div></div>
<div class="ttc" id="structTENS_html_af7ac0af936a90fda61fc97028cc7a2fc"><div class="ttname"><a href="structTENS.html#af7ac0af936a90fda61fc97028cc7a2fc">TENS::Wrap</a></div><div class="ttdeci">int Wrap[3]</div><div class="ttdoc">Which coordinate to wrap. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00209">Forces.h:209</a></div></div>
<div class="ttc" id="classForces_html_ab49daa22c5de576835d55d185f1a53be"><div class="ttname"><a href="classForces.html#ab49daa22c5de576835d55d185f1a53be">Forces::TensRef</a></div><div class="ttdeci">double TensRef(double *Pos1, double *Pos2, double *PosP1, double *PosP2)</div><div class="ttdoc">Particle positions back folded on the tension reference point. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00649">Forces.h:649</a></div></div>
<div class="ttc" id="classDdLinkedList_html_ad4860e7b4a26d4b424e5c98b7c6bae09"><div class="ttname"><a href="classDdLinkedList.html#ad4860e7b4a26d4b424e5c98b7c6bae09">DdLinkedList::Dist2Curr</a></div><div class="ttdeci">void Dist2Curr(double *DistRel)</div><div class="ttdoc">Retrun the squared current interparticle distance. </div><div class="ttdef"><b>Definition:</b> <a href="Cubo_8cpp_source.html#l00502">Cubo.cpp:502</a></div></div>
<div class="ttc" id="classForces_html_ab3f89c2d946d9c242d3d6061ae17ae78"><div class="ttname"><a href="classForces.html#ab3f89c2d946d9c242d3d6061ae17ae78">Forces::SysAlloc</a></div><div class="ttdeci">int SysAlloc</div><div class="ttdoc">Which arrays are allocated. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00753">Forces.h:753</a></div></div>
<div class="ttc" id="classVarData_html_a3ccdbc4515f1de45728ef36368b9969a"><div class="ttname"><a href="classVarData.html#a3ccdbc4515f1de45728ef36368b9969a">VarData::pVol</a></div><div class="ttdeci">double pVol()</div><div class="ttdoc">xyzr edges of the simulation box </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00922">VarData.h:922</a></div></div>
<div class="ttc" id="classForces_html_a8d63955572a8c5888a8a305fb56ada48"><div class="ttname"><a href="classForces.html#a8d63955572a8c5888a8a305fb56ada48">Forces::TensRefPol</a></div><div class="ttdeci">double TensRefPol(double *Pos1, double *Pos2, double *PosP1, double *PosP2)</div><div class="ttdoc">Particle positions back folded on the tension reference point (polar coordinates) ...</div><div class="ttdef"><b>Definition:</b> <a href="ForcesTens_8cpp_source.html#l00207">ForcesTens.cpp:207</a></div></div>
<div class="ttc" id="structNANO_html_a863738e46f14b3bfc674ad87d35f143d"><div class="ttname"><a href="structNANO.html#a863738e46f14b3bfc674ad87d35f143d">NANO::Pos</a></div><div class="ttdeci">double Pos[3]</div><div class="ttdoc">Position. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00427">VarData.h:427</a></div></div>
<div class="ttc" id="structTENS_html_a8895c89605e91c6cf7430bad336f77c6"><div class="ttname"><a href="structTENS.html#a8895c89605e91c6cf7430bad336f77c6">TENS::Edge</a></div><div class="ttdeci">double Edge[3]</div><div class="ttdoc">Edges. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00207">Forces.h:207</a></div></div>
<div class="ttc" id="classVarData_html_a0f556f4717568ddf4b1a4b2111b8d8f3"><div class="ttname"><a href="classVarData.html#a0f556f4717568ddf4b1a4b2111b8d8f3">VarData::pNanoPos</a></div><div class="ttdeci">double pNanoPos(int n, int d)</div><div class="ttdoc">Return back folded nano position. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataComm_8cpp_source.html#l00225">VarDataComm.cpp:225</a></div></div>
<div class="ttc" id="classVarData_html_ab1955d8a8a364358ea5cb9b22419941d"><div class="ttname"><a href="classVarData.html#ab1955d8a8a364358ea5cb9b22419941d">VarData::pEdge</a></div><div class="ttdeci">double pEdge(int d)</div><div class="ttdoc">xyzr edges of the simulation box </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00918">VarData.h:918</a></div></div>
<div class="ttc" id="classVarData_html_a0ad300d40b5d4a3391361b4c8875091f"><div class="ttname"><a href="classVarData.html#a0ad300d40b5d4a3391361b4c8875091f">VarData::pNPCh</a></div><div class="ttdeci">int pNPCh()</div><div class="ttdoc">Number of particle per chain. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataComm_8cpp_source.html#l00249">VarDataComm.cpp:249</a></div></div>
<div class="ttc" id="structTENS_html_a9fce28b2676fbd55604124a7ee638964"><div class="ttname"><a href="structTENS.html#a9fce28b2676fbd55604124a7ee638964">TENS::RefPos</a></div><div class="ttdeci">double RefPos[3]</div><div class="ttdoc">Reference point. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00205">Forces.h:205</a></div></div>
<div class="ttc" id="classVarData_html_aa5c40af319c1dda726271b9fe4059443"><div class="ttname"><a href="classVarData.html#aa5c40af319c1dda726271b9fe4059443">VarData::pWei3Par</a></div><div class="ttdeci">double pWei3Par()</div><div class="ttdoc">Parameter of the third order weighting function. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00950">VarData.h:950</a></div></div>
<div class="ttc" id="classVarData_html_a19886baf2914ac46bc50f333254a4e57"><div class="ttname"><a href="classVarData.html#a19886baf2914ac46bc50f333254a4e57">VarData::TwoPartDist</a></div><div class="ttdeci">double TwoPartDist(int p1, int p2, double *RelDist)</div><div class="ttdoc">Return the relative distance between two particles (wrapped) </div><div class="ttdef"><b>Definition:</b> <a href="VarDataEl_8cpp_source.html#l00419">VarDataEl.cpp:419</a></div></div>
<div class="ttc" id="classVarData_html_a474ffd5306304ac53eb7ef48a18e511d"><div class="ttname"><a href="classVarData.html#a474ffd5306304ac53eb7ef48a18e511d">VarData::pNBlock</a></div><div class="ttdeci">int pNBlock()</div><div class="ttdoc">Number of blocks. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataComm_8cpp_source.html#l00254">VarDataComm.cpp:254</a></div></div>
<div class="ttc" id="classForces_html_a1a74ebb3cab127dd10c8d642fb19a537"><div class="ttname"><a href="classForces.html#a1a74ebb3cab127dd10c8d642fb19a537">Forces::SumTens</a></div><div class="ttdeci">void SumTens(int p1, int p2, double Forces, double *DistRel)</div><div class="ttdoc">Sum the forces on the line joining the points p1 and p2. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesTens_8cpp_source.html#l00271">ForcesTens.cpp:271</a></div></div>
<div class="ttc" id="classVarData_html_a7bb96647a8e4b53477394d2538fdfb3f"><div class="ttname"><a href="classVarData.html#a7bb96647a8e4b53477394d2538fdfb3f">VarData::MInt</a></div><div class="ttdeci">MatInt * MInt</div><div class="ttdoc">Matrix of the prefactor of the interactions. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00529">VarData.h:529</a></div></div>
<div class="ttc" id="classForces_html_a774d65ef8685d2859fae66bad8c9b435"><div class="ttname"><a href="classForces.html#a774d65ef8685d2859fae66bad8c9b435">Forces::Kf</a></div><div class="ttdeci">KFORCES Kf</div><div class="ttdoc">Prefactor of the forces. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00779">Forces.h:779</a></div></div>
<div class="ttc" id="classDdLinkedList_html_a42eeb7049c078ca89057fbc08726eded"><div class="ttname"><a href="classDdLinkedList.html#a42eeb7049c078ca89057fbc08726eded">DdLinkedList::NextCurr</a></div><div class="ttdeci">void NextCurr()</div><div class="ttdoc">Increase the iterator to the next couple. </div><div class="ttdef"><b>Definition:</b> <a href="Cubo_8cpp_source.html#l00479">Cubo.cpp:479</a></div></div>
<div class="ttc" id="classVarData_html_acd4e4b1e648b7d1ca3a169bb176e9f5c"><div class="ttname"><a href="classVarData.html#acd4e4b1e648b7d1ca3a169bb176e9f5c">VarData::Point2Shape</a></div><div class="ttdeci">void Point2Shape(int iShape)</div><div class="ttdoc">Point to the shape function. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataEl_8cpp_source.html#l00490">VarDataEl.cpp:490</a></div></div>
<div class="ttc" id="structTENS_html_a8deae0979f1ffa0ff0b1976cee071f39"><div class="ttname"><a href="structTENS.html#a8deae0979f1ffa0ff0b1976cee071f39">TENS::EdgeInv</a></div><div class="ttdeci">double EdgeInv[3]</div><div class="ttdoc">Inverse of the edges. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00211">Forces.h:211</a></div></div>
<div class="ttc" id="classVarData_html_a217f00c8faf9ba6bb022913df51e5f24"><div class="ttname"><a href="classVarData.html#a217f00c8faf9ba6bb022913df51e5f24">VarData::pWei2Par</a></div><div class="ttdeci">double pWei2Par()</div><div class="ttdoc">Parameter of the second order weighting function. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00948">VarData.h:948</a></div></div>
<div class="ttc" id="classVarData_html_aef94681f570cacf1a76aac1512563f17"><div class="ttname"><a href="classVarData.html#aef94681f570cacf1a76aac1512563f17">VarData::pNNano</a></div><div class="ttdeci">int pNNano()</div><div class="ttdoc">Number of nanoparticles. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataComm_8cpp_source.html#l00253">VarDataComm.cpp:253</a></div></div>
<div class="ttc" id="classMatInt_html_a1c5a9c480e688013bf93d9d5409319e5"><div class="ttname"><a href="classMatInt.html#a1c5a9c480e688013bf93d9d5409319e5">MatInt::Coeff</a></div><div class="ttdeci">double Coeff(int t1, int t2)</div><div class="ttdoc">Prefactor of the force. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8cpp_source.html#l00246">VarData.cpp:246</a></div></div>
<div class="ttc" id="classForces_html_ac5ef477f97601b779392b8622ac6b1fe"><div class="ttname"><a href="classForces.html#ac5ef477f97601b779392b8622ac6b1fe">Forces::Potential</a></div><div class="ttdeci">double Potential(double Dist, int t1, int t2, double *Pot)</div><div class="ttdoc">Pointer to a potential. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00504">Forces.h:504</a></div></div>
<div class="ttc" id="structTENS_html_ae7fd260630480928a069e7e536739df1"><div class="ttname"><a href="structTENS.html#ae7fd260630480928a069e7e536739df1">TENS::CalcMode</a></div><div class="ttdeci">int CalcMode</div><div class="ttdoc">Calculation mode. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00197">Forces.h:197</a></div></div>
<div class="ttc" id="structTENS_html_a0041877aa9f9820a1c0506e9aa9403c3"><div class="ttname"><a href="structTENS.html#a0041877aa9f9820a1c0506e9aa9403c3">TENS::Dens</a></div><div class="ttdeci">double ** Dens</div><div class="ttdoc">Density array. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00201">Forces.h:201</a></div></div>
<div class="ttc" id="classForces_html_a0390d97ed1665851fb6175342d1c598b"><div class="ttname"><a href="classForces.html#a0390d97ed1665851fb6175342d1c598b">Forces::ClearDens</a></div><div class="ttdeci">void ClearDens()</div><div class="ttdoc">Set the local densities to zero. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesCalcEnergies_8cpp_source.html#l00401">ForcesCalcEnergies.cpp:401</a></div></div>
<div class="ttc" id="classForces_html_ac6a2e2465107cd1b6eea81aeb80646c2"><div class="ttname"><a href="classForces.html#ac6a2e2465107cd1b6eea81aeb80646c2">Forces::AllocTens</a></div><div class="ttdeci">void AllocTens()</div><div class="ttdoc">Alloc the pressure profile. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesTens_8cpp_source.html#l00002">ForcesTens.cpp:2</a></div></div>
<div class="ttc" id="classVarData_html_a6496acd0cba8289e8306507336dd2f88"><div class="ttname"><a href="classVarData.html#a6496acd0cba8289e8306507336dd2f88">VarData::pNType</a></div><div class="ttdeci">int pNType()</div><div class="ttdoc">of types of the particle</div><div class="ttdef"><b>Definition:</b> <a href="VarDataComm_8cpp_source.html#l00251">VarDataComm.cpp:251</a></div></div>
<div class="ttc" id="structTENS_html_a5a9396ca53c5306c34eb62ef4f02593b"><div class="ttname"><a href="structTENS.html#a5a9396ca53c5306c34eb62ef4f02593b">TENS::NComp</a></div><div class="ttdeci">int NComp</div><div class="ttdoc">of components</div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00191">Forces.h:191</a></div></div>
<div class="ttc" id="classVarData_html_ab70211c3dc01d352727d2052b2c555c5"><div class="ttname"><a href="classVarData.html#ab70211c3dc01d352727d2052b2c555c5">VarData::pPos</a></div><div class="ttdeci">double pPos(int p, int d)</div><div class="ttdoc">Return back folded position. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataComm_8cpp_source.html#l00192">VarDataComm.cpp:192</a></div></div>
<div class="ttc" id="classForces_html_a3d44e49e6ced82a300d6071060b72c48"><div class="ttname"><a href="classForces.html#a3d44e49e6ced82a300d6071060b72c48">Forces::DerWei3</a></div><div class="ttdeci">double DerWei3(const double r, const double a)</div><div class="ttdoc">Derivative of the cubic weighting function. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesForceField_8cpp_source.html#l00722">ForcesForceField.cpp:722</a></div></div>
<div class="ttc" id="classVarData_html_a9f6d9339cabdd81a05bf272c116ceea2"><div class="ttname"><a href="classVarData.html#a9f6d9339cabdd81a05bf272c116ceea2">VarData::pNChain</a></div><div class="ttdeci">int pNChain()</div><div class="ttdoc">Number of chain. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataComm_8cpp_source.html#l00247">VarDataComm.cpp:247</a></div></div>
<div class="ttc" id="classVarData_html_a08e2743fbc74ffadb73bf88a833cd03f"><div class="ttname"><a href="classVarData.html#a08e2743fbc74ffadb73bf88a833cd03f">VarData::CLat1</a></div><div class="ttdeci">int CLat1</div><div class="ttdoc">lateral coordinate </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l01076">VarData.h:1076</a></div></div>
<div class="ttc" id="classDdLinkedList_html_a63c5d18d3a487d1a8ab2a5881c6acb38"><div class="ttname"><a href="classDdLinkedList.html#a63c5d18d3a487d1a8ab2a5881c6acb38">DdLinkedList::IfCurr</a></div><div class="ttdeci">int IfCurr()</div><div class="ttdoc">Tell when the curr loop is over. </div><div class="ttdef"><b>Definition:</b> <a href="Cubo_8cpp_source.html#l00498">Cubo.cpp:498</a></div></div>
<div class="ttc" id="structKFORCES_html_ac448df5dbfd256324893075200dace49"><div class="ttname"><a href="structKFORCES.html#ac448df5dbfd256324893075200dace49">KFORCES::CutOff2</a></div><div class="ttdeci">double CutOff2</div><div class="ttdoc">CutOff of the lennard jones. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00165">Forces.h:165</a></div></div>
<div class="ttc" id="classDomDecBasics_html_a28d65a777a97b96280ca0f9173c76c93"><div class="ttname"><a href="classDomDecBasics.html#a28d65a777a97b96280ca0f9173c76c93">DomDecBasics::p2Curr</a></div><div class="ttdeci">int p2Curr</div><div class="ttdoc">Current particle. </div><div class="ttdef"><b>Definition:</b> <a href="Cubo_8h_source.html#l00051">Cubo.h:51</a></div></div>
<div class="ttc" id="classForces_html_a0449e9410bf23ad4d073f1eab66c2a68"><div class="ttname"><a href="classForces.html#a0449e9410bf23ad4d073f1eab66c2a68">Forces::SumDens</a></div><div class="ttdeci">double SumDens(int pInit, int pEnd)</div><div class="ttdoc">Sum the local density for the particles between pInit and pEnd and multiply the factors by the virial...</div><div class="ttdef"><b>Definition:</b> <a href="ForcesCalcEnergies_8cpp_source.html#l00243">ForcesCalcEnergies.cpp:243</a></div></div>
<div class="ttc" id="structTENS_html_afa1c775c96b6e779b58ff0ff084d8cee"><div class="ttname"><a href="structTENS.html#afa1c775c96b6e779b58ff0ff084d8cee">TENS::NSlab</a></div><div class="ttdeci">int NSlab</div><div class="ttdoc">of slabs</div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00195">Forces.h:195</a></div></div>
<div class="ttc" id="classForces_html_a44c4bed1843e51f20f252a5dd05f64fe"><div class="ttname"><a href="classForces.html#a44c4bed1843e51f20f252a5dd05f64fe">Forces::CalcDens</a></div><div class="ttdeci">void CalcDens()</div><div class="ttdoc">Calculate the densities. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesTens_8cpp_source.html#l00045">ForcesTens.cpp:45</a></div></div>
<div class="ttc" id="classVarData_html_a53eee20378b4a2c61407897d98a4b5d7"><div class="ttname"><a href="classVarData.html#a53eee20378b4a2c61407897d98a4b5d7">VarData::Pm</a></div><div class="ttdeci">PART * Pm</div><div class="ttdoc">Particle information of all particle. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l01046">VarData.h:1046</a></div></div>
<div class="ttc" id="classForces_html_a9d4e2ba1cf8ce2142f50a1b7e8bf4f7b"><div class="ttname"><a href="classForces.html#a9d4e2ba1cf8ce2142f50a1b7e8bf4f7b">Forces::AddDens</a></div><div class="ttdeci">int AddDens(int pInit, int pEnd)</div><div class="ttdoc">Add the densities connected with the particles between pInit and pEnd. </div><div class="ttdef"><b>Definition:</b> <a href="ForcesCalcEnergies_8cpp_source.html#l00218">ForcesCalcEnergies.cpp:218</a></div></div>
<div class="ttc" id="classDdLinkedList_html_a74b7b0d716684a7d46993c83795fd9e7"><div class="ttname"><a href="classDdLinkedList.html#a74b7b0d716684a7d46993c83795fd9e7">DdLinkedList::SetCurr</a></div><div class="ttdeci">void SetCurr(int p)</div><div class="ttdoc">Gather information of the neighbouring cells. </div><div class="ttdef"><b>Definition:</b> <a href="Cubo_8cpp_source.html#l00453">Cubo.cpp:453</a></div></div>
<div class="ttc" id="classForces_html_a77e000512807ae8da791d650d739299a"><div class="ttname"><a href="classForces.html#a77e000512807ae8da791d650d739299a">Forces::Tens</a></div><div class="ttdeci">TENS Tens</div><div class="ttdoc">Structure for the pressure calculation. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00783">Forces.h:783</a></div></div>
<div class="ttc" id="classForces_html_a5d8052dd63b08f01b581aeffa8506051"><div class="ttname"><a href="classForces.html#a5d8052dd63b08f01b581aeffa8506051">Forces::Pc</a></div><div class="ttdeci">DomDec * Pc</div><div class="ttdoc">Pair list. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00785">Forces.h:785</a></div></div>
<div class="ttc" id="classVarData_html_acb9df687ca0683b99bdb00425e9da912"><div class="ttname"><a href="classVarData.html#acb9df687ca0683b99bdb00425e9da912">VarData::VolumeCircSlab</a></div><div class="ttdeci">void VolumeCircSlab(double *VolContr, int NSample)</div><div class="ttdoc">Fill an array of. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataProfile_8cpp_source.html#l00075">VarDataProfile.cpp:75</a></div></div>
<div class="ttc" id="classForces_html_afad21f344bdeced26172aaf70d26e844"><div class="ttname"><a href="classForces.html#afad21f344bdeced26172aaf70d26e844">Forces::TensRefCart</a></div><div class="ttdeci">double TensRefCart(double *Pos1, double *Pos2, double *PosP1, double *PosP2)</div><div class="ttdoc">Particle positions back folded on the tension reference point (Cartesian coordinates) ...</div><div class="ttdef"><b>Definition:</b> <a href="ForcesTens_8cpp_source.html#l00199">ForcesTens.cpp:199</a></div></div>
<div class="ttc" id="classVarData_html_ac659e9234deb7729483b32fd9d6b5b30"><div class="ttname"><a href="classVarData.html#ac659e9234deb7729483b32fd9d6b5b30">VarData::SetEdge</a></div><div class="ttdeci">void SetEdge(double Val, int d)</div><div class="ttdoc">Set Edge. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l00976">VarData.h:976</a></div></div>
<div class="ttc" id="classForces_html_afca243db3841bf482910199bdb22e5f3"><div class="ttname"><a href="classForces.html#afca243db3841bf482910199bdb22e5f3">Forces::Fm</a></div><div class="ttdeci">FORCES * Fm</div><div class="ttdoc">Array containing the forces for each particle. </div><div class="ttdef"><b>Definition:</b> <a href="Forces_8h_source.html#l00781">Forces.h:781</a></div></div>
<div class="ttc" id="classVarData_html_ac5f3674d89bb344da0be11d57eea248e"><div class="ttname"><a href="classVarData.html#ac5f3674d89bb344da0be11d57eea248e">VarData::CNorm</a></div><div class="ttdeci">int CNorm</div><div class="ttdoc">Normal coordinate. </div><div class="ttdef"><b>Definition:</b> <a href="VarData_8h_source.html#l01074">VarData.h:1074</a></div></div>
<div class="ttc" id="classVarData_html_a388622b5e7d2ad20e8ac1a8a951d655f"><div class="ttname"><a href="classVarData.html#a388622b5e7d2ad20e8ac1a8a951d655f">VarData::pNPart</a></div><div class="ttdeci">int pNPart()</div><div class="ttdoc">Number of particle. </div><div class="ttdef"><b>Definition:</b> <a href="VarDataComm_8cpp_source.html#l00246">VarDataComm.cpp:246</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
